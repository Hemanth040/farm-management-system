-e 
===== FILE: ./package.json =====

{
  "name": "frontend",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@date-io/date-fns": "^3.2.1",
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.1",
    "@mui/icons-material": "^7.3.7",
    "@mui/material": "^7.3.7",
    "@mui/x-date-pickers": "^8.26.0",
    "@mui/x-date-pickers-pro": "^8.26.0",
    "@testing-library/dom": "^10.4.1",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.2",
    "@testing-library/user-event": "^13.5.0",
    "axios": "^1.13.4",
    "date-fns": "^4.1.0",
    "react": "^19.2.4",
    "react-dom": "^19.2.4",
    "react-router-dom": "^7.13.0",
    "react-scripts": "5.0.1",
    "recharts": "^3.7.0",
    "web-vitals": "^2.1.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
-e 
===== FILE: ./README.md =====

# Getting Started with Create React App

This project was bootstrapped with [Create React App](https://github.com/facebook/create-react-app).

## Available Scripts

In the project directory, you can run:

### `npm start`

Runs the app in the development mode.\
Open [http://localhost:3000](http://localhost:3000) to view it in your browser.

The page will reload when you make changes.\
You may also see any lint errors in the console.

### `npm test`

Launches the test runner in the interactive watch mode.\
See the section about [running tests](https://facebook.github.io/create-react-app/docs/running-tests) for more information.

### `npm run build`

Builds the app for production to the `build` folder.\
It correctly bundles React in production mode and optimizes the build for the best performance.

The build is minified and the filenames include the hashes.\
Your app is ready to be deployed!

See the section about [deployment](https://facebook.github.io/create-react-app/docs/deployment) for more information.

### `npm run eject`

**Note: this is a one-way operation. Once you `eject`, you can't go back!**

If you aren't satisfied with the build tool and configuration choices, you can `eject` at any time. This command will remove the single build dependency from your project.

Instead, it will copy all the configuration files and the transitive dependencies (webpack, Babel, ESLint, etc) right into your project so you have full control over them. All of the commands except `eject` will still work, but they will point to the copied scripts so you can tweak them. At this point you're on your own.

You don't have to ever use `eject`. The curated feature set is suitable for small and middle deployments, and you shouldn't feel obligated to use this feature. However we understand that this tool wouldn't be useful if you couldn't customize it when you are ready for it.

## Learn More

You can learn more in the [Create React App documentation](https://facebook.github.io/create-react-app/docs/getting-started).

To learn React, check out the [React documentation](https://reactjs.org/).

### Code Splitting

This section has moved here: [https://facebook.github.io/create-react-app/docs/code-splitting](https://facebook.github.io/create-react-app/docs/code-splitting)

### Analyzing the Bundle Size

This section has moved here: [https://facebook.github.io/create-react-app/docs/analyzing-the-bundle-size](https://facebook.github.io/create-react-app/docs/analyzing-the-bundle-size)

### Making a Progressive Web App

This section has moved here: [https://facebook.github.io/create-react-app/docs/making-a-progressive-web-app](https://facebook.github.io/create-react-app/docs/making-a-progressive-web-app)

### Advanced Configuration

This section has moved here: [https://facebook.github.io/create-react-app/docs/advanced-configuration](https://facebook.github.io/create-react-app/docs/advanced-configuration)

### Deployment

This section has moved here: [https://facebook.github.io/create-react-app/docs/deployment](https://facebook.github.io/create-react-app/docs/deployment)

### `npm run build` fails to minify

This section has moved here: [https://facebook.github.io/create-react-app/docs/troubleshooting#npm-run-build-fails-to-minify](https://facebook.github.io/create-react-app/docs/troubleshooting#npm-run-build-fails-to-minify)
-e 
===== FILE: ./public/index.html =====

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
-e 
===== FILE: ./public/manifest.json =====

{
  "short_name": "React App",
  "name": "Create React App Sample",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    },
    {
      "src": "logo192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "logo512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff"
}
-e 
===== FILE: ./public/robots.txt =====

# https://www.robotstxt.org/robotstxt.html
User-agent: *
Disallow:
-e 
===== FILE: ./src/App.css =====

.App {
  text-align: center;
}

.App-logo {
  height: 40vmin;
  pointer-events: none;
}

@media (prefers-reduced-motion: no-preference) {
  .App-logo {
    animation: App-logo-spin infinite 20s linear;
  }
}

.App-header {
  background-color: #282c34;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: calc(10px + 2vmin);
  color: white;
}

.App-link {
  color: #61dafb;
}

@keyframes App-logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
-e 
===== FILE: ./src/App.js =====

import React from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { ThemeProvider, createTheme } from '@mui/material/styles';
import CssBaseline from '@mui/material/CssBaseline';
import CropPlanner from './components/CropPlanner';
import FarmerDashboard from './components/FarmerDashboard';
import SupervisorDashboard from './components/SupervisorDashboard';
import WorkerDashboard from './components/WorkerDashboard';

const theme = createTheme({
  palette: {
    primary: {
      main: '#4CAF50',
    },
    secondary: {
      main: '#FF9800',
    },
  },
});

function App() {
  return (
    <ThemeProvider theme={theme}>
      <CssBaseline />
      <Router>
        <Routes>
          <Route path="/" element={<Navigate to="/dashboard" />} />
          <Route path="/dashboard" element={<FarmerDashboard />} />
          <Route path="/crop-planner" element={<CropPlanner />} />
          <Route path="/supervisor" element={<SupervisorDashboard />} />
          <Route path="/worker" element={<WorkerDashboard />} />
        </Routes>
      </Router>
    </ThemeProvider>
  );
}

export default App;
-e 
===== FILE: ./src/index.css =====

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}
-e 
===== FILE: ./src/index.js =====

import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';
import reportWebVitals from './reportWebVitals';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

// If you want to start measuring performance in your app, pass a function
// to log results (for example: reportWebVitals(console.log))
// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals
reportWebVitals();
-e 
===== FILE: ./src/components/FarmerDashboard.js =====

import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import {
    Container,
    Grid,
    Paper,
    Typography,
    Card,
    CardContent,
    Button,
    List,
    ListItem,
    ListItemText,
    IconButton,
    Chip,
    Table,
    TableBody,
    TableCell,
    TableContainer,
    TableHead,
    TableRow
} from '@mui/material';
import {
    Grass,
    Dashboard as DashboardIcon
} from '@mui/icons-material';
import ActivityTimeline from './ActivityTimeline';
import ResourcesManagement from './ResourcesManagement';
import FinancialDashboard from './FinancialDashboard';
import CropHealthDashboard from './CropHealthDashboard';

const FarmerDashboard = () => {
    const [activeTab, setActiveTab] = useState('overview');
    const [reminders, setReminders] = useState([]);
    const navigate = useNavigate();

    useEffect(() => {
        // Fetch initial data
        fetchReminders();
    }, []);

    const fetchReminders = async () => {
        // API call to fetch reminders
        const mockReminders = [
            { id: 1, title: 'Irrigation', date: '2024-03-20', type: 'irrigation', crop: 'Wheat' },
            { id: 2, title: 'Fertilizer Application', date: '2024-03-22', type: 'fertilizer', crop: 'Rice' },
            { id: 3, title: 'Harvest Wheat', date: '2024-03-25', type: 'harvest', crop: 'Wheat' }
        ];
        setReminders(mockReminders);
    };

    const features = [
        { id: 'reminders', icon: <Notifications />, title: 'Reminders', color: '#4CAF50' },
        { id: 'warnings', icon: <Warning />, title: 'Warnings', color: '#FF9800' },
        { id: 'planner', icon: <CalendarToday />, title: 'Crop Planner', color: '#2196F3' },
        { id: 'timeline', icon: <DashboardIcon />, title: 'Activity Timeline', color: '#9C27B0' },
        { id: 'resources', icon: <Inventory />, title: 'Resources', color: '#795548' },
        { id: 'financial', icon: <Assessment />, title: 'Financial', color: '#607D8B' },
        { id: 'diseases', icon: <Nature />, title: 'Crop Health', color: '#E91E63' },
        { id: 'reports', icon: <Assessment />, title: 'Reports', color: '#00BCD4' },
        { id: 'workers', icon: <Group />, title: 'Workers', color: '#FF5722' },
        { id: 'pesticides', icon: <LocalOffer />, title: 'Pesticide Guide', color: '#8BC34A' },
        { id: 'selling', icon: <Sell />, title: 'Selling', color: '#3F51B5' },
        { id: 'weeds', icon: <Grass />, title: 'Weed Management', color: '#009688' }
    ];

    const renderOverview = () => (
        <Grid container spacing={3}>
            {/* Quick Stats */}
            <Grid item xs={12} md={3}>
                <Card>
                    <CardContent>
                        <Typography color="textSecondary" gutterBottom>
                            Active Crops
                        </Typography>
                        <Typography variant="h5">3</Typography>
                    </CardContent>
                </Card>
            </Grid>
            <Grid item xs={12} md={3}>
                <Card>
                    <CardContent>
                        <Typography color="textSecondary" gutterBottom>
                            Pending Tasks
                        </Typography>
                        <Typography variant="h5">7</Typography>
                    </CardContent>
                </Card>
            </Grid>
            <Grid item xs={12} md={3}>
                <Card>
                    <CardContent>
                        <Typography color="textSecondary" gutterBottom>
                            Low Stock Items
                        </Typography>
                        <Typography variant="h5">2</Typography>
                    </CardContent>
                </Card>
            </Grid>
            <Grid item xs={12} md={3}>
                <Card>
                    <CardContent>
                        <Typography color="textSecondary" gutterBottom>
                            Total Workers
                        </Typography>
                        <Typography variant="h5">12</Typography>
                    </CardContent>
                </Card>
            </Grid>

            {/* Reminders */}
            <Grid item xs={12} md={6}>
                <Paper sx={{ p: 2 }}>
                    <Typography variant="h6" gutterBottom>
                        Upcoming Reminders
                    </Typography>
                    <List>
                        {reminders.map((reminder) => (
                            <ListItem key={reminder.id} secondaryAction={
                                <Chip label={reminder.crop} size="small" />
                            }>
                                <ListItemText
                                    primary={reminder.title}
                                    secondary={`Due: ${reminder.date}`}
                                />
                            </ListItem>
                        ))}
                    </List>
                </Paper>
            </Grid>

            {/* Warnings */}
            <Grid item xs={12} md={6}>
                <Paper sx={{ p: 2 }}>
                    <Typography variant="h6" gutterBottom>
                        Active Warnings
                    </Typography>
                    <List>
                        <ListItem>
                            <ListItemText
                                primary="Heavy Rainfall Expected"
                                secondary="Tomorrow - Take necessary precautions"
                                primaryTypographyProps={{ color: 'warning.main' }}
                            />
                        </ListItem>
                        <ListItem>
                            <ListItemText
                                primary="Pest Alert: Locust Activity"
                                secondary="High activity reported in your region"
                                primaryTypographyProps={{ color: 'error.main' }}
                            />
                        </ListItem>
                    </List>
                </Paper>
            </Grid>

            {/* Features Grid */}
            <Grid item xs={12}>
                <Typography variant="h6" gutterBottom>
                    All Features
                </Typography>
                <Grid container spacing={2}>
                    {features.map((feature) => (
                        <Grid item xs={6} sm={4} md={3} key={feature.id}>
                            <Card 
                                sx={{ 
                                    cursor: 'pointer',
                                    '&:hover': { bgcolor: '#f5f5f5' }
                                }}
                                onClick={() => {
                                    if (feature.id === 'planner') {
                                        navigate('/crop-planner');
                                    } else {
                                        setActiveTab(feature.id);
                                    }
                                }}
                            >
                                <CardContent sx={{ textAlign: 'center' }}>
                                    <IconButton sx={{ color: feature.color, mb: 1 }}>
                                        {feature.icon}
                                    </IconButton>
                                    <Typography variant="subtitle1">
                                        {feature.title}
                                    </Typography>
                                </CardContent>
                            </Card>
                        </Grid>
                    ))}
                </Grid>
            </Grid>
        </Grid>
    );

    const renderReminders = () => (
        <Paper sx={{ p: 3 }}>
            <Typography variant="h5" gutterBottom>
                Reminders Management
            </Typography>
            <Grid container spacing={3}>
                <Grid item xs={12} md={6}>
                    <Typography variant="h6" gutterBottom>
                        Add New Reminder
                    </Typography>
                    {/* Add reminder form would go here */}
                </Grid>
                <Grid item xs={12} md={6}>
                    <Typography variant="h6" gutterBottom>
                        Scheduled Reminders
                    </Typography>
                    <TableContainer>
                        <Table>
                            <TableHead>
                                <TableRow>
                                    <TableCell>Type</TableCell>
                                    <TableCell>Description</TableCell>
                                    <TableCell>Date</TableCell>
                                    <TableCell>Crop</TableCell>
                                    <TableCell>Status</TableCell>
                                </TableRow>
                            </TableHead>
                            <TableBody>
                                <TableRow>
                                    <TableCell>Irrigation</TableCell>
                                    <TableCell>Water Field A</TableCell>
                                    <TableCell>2024-03-20</TableCell>
                                    <TableCell>Wheat</TableCell>
                                    <TableCell><Chip label="Pending" color="warning" size="small" /></TableCell>
                                </TableRow>
                                <TableRow>
                                    <TableCell>Fertilizer</TableCell>
                                    <TableCell>Apply Urea</TableCell>
                                    <TableCell>2024-03-22</TableCell>
                                    <TableCell>Rice</TableCell>
                                    <TableCell><Chip label="Scheduled" color="info" size="small" /></TableCell>
                                </TableRow>
                            </TableBody>
                        </Table>
                    </TableContainer>
                </Grid>
            </Grid>
        </Paper>
    );

    return (
        <Container maxWidth="xl" sx={{ mt: 4, mb: 4 }}>
            <Typography variant="h4" gutterBottom>
                Farmer Dashboard
            </Typography>
            
            {/* Navigation Tabs */}
            <Paper sx={{ mb: 3, p: 1 }}>
                <Grid container spacing={1}>
                    <Grid item>
                        <Button 
                            variant={activeTab === 'overview' ? 'contained' : 'text'}
                            onClick={() => setActiveTab('overview')}
                        >
                            Overview
                        </Button>
                    </Grid>
                    {features.map(feature => (
                        <Grid item key={feature.id}>
                            <Button
                                variant={activeTab === feature.id ? 'contained' : 'text'}
                                onClick={() => {
                                    if (feature.id === 'planner') {
                                        navigate('/crop-planner');
                                    } else {
                                        setActiveTab(feature.id);
                                    }
                                }}
                                startIcon={feature.icon}
                            >
                                {feature.title}
                            </Button>
                        </Grid>
                    ))}
                </Grid>
            </Paper>

            {/* Content Area */}
            {activeTab === 'overview' && renderOverview()}
            {activeTab === 'reminders' && renderReminders()}
            {activeTab === 'timeline' && <ActivityTimeline />}
            {activeTab === 'resources' && <ResourcesManagement />}
            {activeTab === 'financial' && <FinancialDashboard />}
            {activeTab === 'diseases' && <CropHealthDashboard />}
            {/* activeTab === 'planner' is handled by navigation now */}
        </Container>
    );
};

export default FarmerDashboard;-e 
===== FILE: ./src/components/SupervisorDashboard.js =====

import React, { useState } from 'react';
import {
    Container,
    Paper,
    Typography,
    Grid,
    Card,
    CardContent,
    Button,
    List,
    ListItem,
    ListItemText
} from '@mui/material';
import {
    Dashboard,
    Chat,
    Assignment,
    TrendingUp,
    Checklist
} from '@mui/icons-material';

const SupervisorDashboard = () => {
    const [activeTab, setActiveTab] = useState('schemes');

    const schemes = [
        { id: 1, name: 'PM-KISAN', deadline: '2024-04-30', status: 'Open' },
        { id: 2, name: 'Soil Health Card', deadline: '2024-03-31', status: 'Open' },
        { id: 3, name: 'Crop Insurance', deadline: '2024-05-15', status: 'Upcoming' }
    ];

    const farmers = [
        { id: 1, name: 'Rajesh Kumar', location: 'Village A', crops: ['Wheat', 'Rice'], lastVisit: '2024-03-10' },
        { id: 2, name: 'Suresh Patel', location: 'Village B', crops: ['Cotton', 'Maize'], lastVisit: '2024-03-12' }
    ];

    const renderGovernmentSchemes = () => (
        <Grid container spacing={3}>
            <Grid item xs={12}>
                <Typography variant="h5" gutterBottom>
                    Government Schemes & Subsidies
                </Typography>
            </Grid>
            {schemes.map(scheme => (
                <Grid item xs={12} md={4} key={scheme.id}>
                    <Card>
                        <CardContent>
                            <Typography variant="h6" gutterBottom>
                                {scheme.name}
                            </Typography>
                            <Typography color="textSecondary">
                                Deadline: {scheme.deadline}
                            </Typography>
                            <Button 
                                variant="contained" 
                                color={scheme.status === 'Open' ? 'primary' : 'default'}
                                sx={{ mt: 2 }}
                            >
                                View Details
                            </Button>
                        </CardContent>
                    </Card>
                </Grid>
            ))}
        </Grid>
    );

    const renderChatSystem = () => (
        <Paper sx={{ p: 3, height: '70vh' }}>
            <Typography variant="h5" gutterBottom>
                Farmer Communication
            </Typography>
            <Grid container spacing={2} sx={{ height: '100%' }}>
                <Grid item xs={4}>
                    <Typography variant="subtitle1" gutterBottom>
                        Farmers List
                    </Typography>
                    <List>
                        {farmers.map(farmer => (
                            <ListItem key={farmer.id} button>
                                <ListItemText 
                                    primary={farmer.name}
                                    secondary={farmer.location}
                                />
                            </ListItem>
                        ))}
                    </List>
                </Grid>
                <Grid item xs={8}>
                    <Paper sx={{ p: 2, height: '100%' }}>
                        <Typography variant="subtitle1" gutterBottom>
                            Chat with Rajesh Kumar
                        </Typography>
                        {/* Chat messages would go here */}
                    </Paper>
                </Grid>
            </Grid>
        </Paper>
    );

    const renderCropPrediction = () => (
        <Paper sx={{ p: 3 }}>
            <Typography variant="h5" gutterBottom>
                Crop Prediction & Analytics
            </Typography>
            <Grid container spacing={3}>
                <Grid item xs={12} md={6}>
                    <Card>
                        <CardContent>
                            <Typography variant="h6" gutterBottom>
                                Yield Forecast
                            </Typography>
                            {/* Prediction chart would go here */}
                        </CardContent>
                    </Card>
                </Grid>
                <Grid item xs={12} md={6}>
                    <Card>
                        <CardContent>
                            <Typography variant="h6" gutterBottom>
                                Risk Assessment
                            </Typography>
                            {/* Risk factors would go here */}
                        </CardContent>
                    </Card>
                </Grid>
            </Grid>
        </Paper>
    );

    return (
        <Container maxWidth="xl" sx={{ mt: 4, mb: 4 }}>
            <Typography variant="h4" gutterBottom>
                Supervisor Dashboard
            </Typography>
            
            {/* Navigation */}
            <Paper sx={{ mb: 3, p: 1 }}>
                <Grid container spacing={1}>
                    {[
                        { id: 'schemes', label: 'Govt Schemes', icon: <Dashboard /> },
                        { id: 'chat', label: 'Communication', icon: <Chat /> },
                        { id: 'records', label: 'Records', icon: <Assignment /> },
                        { id: 'prediction', label: 'Crop Prediction', icon: <TrendingUp /> },
                        { id: 'todo', label: 'To-Do List', icon: <Checklist /> }
                    ].map(item => (
                        <Grid item key={item.id}>
                            <Button
                                variant={activeTab === item.id ? 'contained' : 'text'}
                                onClick={() => setActiveTab(item.id)}
                                startIcon={item.icon}
                            >
                                {item.label}
                            </Button>
                        </Grid>
                    ))}
                </Grid>
            </Paper>

            {/* Content */}
            {activeTab === 'schemes' && renderGovernmentSchemes()}
            {activeTab === 'chat' && renderChatSystem()}
            {activeTab === 'prediction' && renderCropPrediction()}
        </Container>
    );
};

export default SupervisorDashboard;
-e 
===== FILE: ./src/components/WorkerDashboard.js =====

import React, { useState } from 'react';
import {
    Container,
    Paper,
    Typography,
    Grid,
    Card,
    CardContent,
    Button,
    List,
    ListItem,
    ListItemText,
    Chip,
    TextField
} from '@mui/material';
import {
    CheckCircle,
    Report
} from '@mui/icons-material';

const WorkerDashboard = () => {
    const [attendance, setAttendance] = useState([]);
    const [tasks, setTasks] = useState([
        { id: 1, description: 'Plow Field A', field: 'North Field', status: 'pending', date: '2024-03-20' },
        { id: 2, description: 'Apply Fertilizer', field: 'South Field', status: 'completed', date: '2024-03-19' }
    ]);

    const markAttendance = () => {
        const today = new Date().toISOString().split('T')[0];
        setAttendance([...attendance, { date: today, time: new Date().toLocaleTimeString() }]);
    };

    const completeTask = (taskId) => {
        setTasks(tasks.map(task => 
            task.id === taskId ? { ...task, status: 'completed' } : task
        ));
    };

    return (
        <Container maxWidth="md" sx={{ mt: 4, mb: 4 }}>
            <Typography variant="h4" gutterBottom>
                Worker Dashboard
            </Typography>
            
            <Grid container spacing={3}>
                {/* Attendance */}
                <Grid item xs={12}>
                    <Card>
                        <CardContent>
                            <Typography variant="h6" gutterBottom>
                                Today's Attendance
                            </Typography>
                            <Button 
                                variant="contained" 
                                color="primary"
                                startIcon={<CheckCircle />}
                                onClick={markAttendance}
                                sx={{ mb: 2 }}
                            >
                                Mark Present
                            </Button>
                            {attendance.length > 0 && (
                                <Typography>
                                    Last marked: {attendance[attendance.length - 1].date} at {attendance[attendance.length - 1].time}
                                </Typography>
                            )}
                        </CardContent>
                    </Card>
                </Grid>

                {/* Tasks */}
                <Grid item xs={12}>
                    <Paper sx={{ p: 2 }}>
                        <Typography variant="h6" gutterBottom>
                            Today's Tasks
                        </Typography>
                        <List>
                            {tasks.map(task => (
                                <ListItem 
                                    key={task.id}
                                    secondaryAction={
                                        task.status === 'pending' ? (
                                            <Button 
                                                variant="outlined" 
                                                size="small"
                                                onClick={() => completeTask(task.id)}
                                            >
                                                Mark Complete
                                            </Button>
                                        ) : (
                                            <Chip 
                                                icon={<CheckCircle />} 
                                                label="Completed" 
                                                color="success" 
                                                size="small" 
                                            />
                                        )
                                    }
                                >
                                    <ListItemText
                                        primary={task.description}
                                        secondary={`Field: ${task.field} \u2022 ${task.date}`}
                                    />
                                </ListItem>
                            ))}
                        </List>
                    </Paper>
                </Grid>

                {/* Wages */}
                <Grid item xs={12} md={6}>
                    <Card>
                        <CardContent>
                            <Typography variant="h6" gutterBottom>
                                Wages Overview
                            </Typography>
                            <Typography variant="h4" color="primary">
                                â‚¹12,500
                            </Typography>
                            <Typography color="textSecondary">
                                This month's earnings
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>

                {/* Issue Reporting */}
                <Grid item xs={12} md={6}>
                    <Card>
                        <CardContent>
                            <Typography variant="h6" gutterBottom>
                                Report Issue
                            </Typography>
                            <TextField 
                                label="Issue Description"
                                multiline
                                rows={3}
                                fullWidth
                                sx={{ mb: 2 }}
                            />
                            <Button 
                                variant="contained" 
                                color="warning"
                                startIcon={<Report />}
                                fullWidth
                            >
                                Submit Report
                            </Button>
                        </CardContent>
                    </Card>
                </Grid>
            </Grid>
        </Container>
    );
};

export default WorkerDashboard;
-e 
===== FILE: ./src/components/CropPlanner.js =====

import React, { useState, useEffect, useCallback } from 'react';
import axios from 'axios';
import {
    Container,
    Paper,
    Typography,
    Grid,
    Card,
    CardContent,
    Button,
    TextField,
    Select,
    MenuItem,
    FormControl,
    InputLabel,
    Table,
    TableBody,
    TableCell,
    TableContainer,
    TableHead,
    TableRow,
    Chip,
    Dialog,
    DialogTitle,
    DialogContent,
    DialogActions,
    Stepper,
    Step,
    StepLabel,
    Box,
    Alert,
    Snackbar,
    List
} from '@mui/material';
import {
    Add,
    CalendarToday,
    WaterDrop,
    Grass,
    Spa,
    Timeline,
    CheckCircle,
    Schedule
} from '@mui/icons-material';
import { DatePicker } from '@mui/x-date-pickers/DatePicker';
import { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';
import { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns';
import { ResponsiveContainer, PieChart, Pie, Cell, LineChart, Line, CartesianGrid, XAxis, YAxis, Tooltip as RechartsTooltip, Legend } from 'recharts';
import { format, addDays, startOfYear, endOfYear, eachMonthOfInterval } from 'date-fns';

const CropPlanner = () => {
    const [activeStep, setActiveStep] = useState(0);
    const [crops, setCrops] = useState([]);
    const [newCrop, setNewCrop] = useState({
        name: '',
        variety: '',
        season: '',
        landType: '',
        area: '',
        sowingDate: new Date(),
        expectedHarvestDate: null,
        soilType: 'loam',
        waterSource: 'rainfed'
    });
    const [dialogOpen, setDialogOpen] = useState(false);
    const [selectedSeason, setSelectedSeason] = useState('');
    const [selectedLandType, setSelectedLandType] = useState('');
    const [recommendations, setRecommendations] = useState([]);
    const [planDetails, setPlanDetails] = useState(null);
    const [annualTimeline, setAnnualTimeline] = useState([]);
    const [snackbar, setSnackbar] = useState({ open: false, message: '', severity: 'success' });
    const [loading, setLoading] = useState(false);

    const API_URL = 'http://localhost:5000/api';

    const showSnackbar = useCallback((message, severity = 'success') => {
        setSnackbar({ open: true, message, severity });
    }, []);

    const fetchCrops = useCallback(async () => {
        try {
            const token = localStorage.getItem('token');
            const response = await axios.get(`${API_URL}/crops`, {
                headers: { Authorization: `Bearer ${token}` }
            });
            setCrops(response.data);
        } catch (error) {
            console.error('Error fetching crops:', error);
            showSnackbar('Error loading crops', 'error');
        }
    }, [API_URL, showSnackbar]);

    const fetchAnnualTimeline = useCallback(async () => {
        try {
            const token = localStorage.getItem('token');
            const currentYear = new Date().getFullYear();
            const response = await axios.get(`${API_URL}/crops/timeline`, {
                headers: { Authorization: `Bearer ${token}` },
                params: { year: currentYear }
            });
            setAnnualTimeline(response.data);
        } catch (error) {
            console.error('Error fetching timeline:', error);
        }
    }, [API_URL]);

    // Fetch existing crops and timeline
    useEffect(() => {
        fetchCrops();
        fetchAnnualTimeline();
    }, [fetchCrops, fetchAnnualTimeline]);

    const getCropRecommendations = useCallback(async () => {
        if (!selectedSeason || !selectedLandType) return;

        try {
            const token = localStorage.getItem('token');
            const response = await axios.get(`${API_URL}/crops/recommendations`, {
                headers: { Authorization: `Bearer ${token}` },
                params: { 
                    season: selectedSeason,
                    soilType: selectedLandType 
                }
            });
            setRecommendations(response.data);
        } catch (error) {
            console.error('Error fetching recommendations:', error);
            showSnackbar('Error loading crop recommendations', 'error');
        }
    }, [API_URL, selectedSeason, selectedLandType, showSnackbar]);

    useEffect(() => {
        getCropRecommendations();
    }, [getCropRecommendations]);

    const calculateCropPlan = () => {
        if (!newCrop.name || !newCrop.area || !newCrop.sowingDate) {
            return null;
        }

        // Get crop requirements
        const selectedCrop = recommendations.find(c => c.name === newCrop.name);
        if (!selectedCrop) return null;

        const area = parseFloat(newCrop.area);
        const sowingDate = new Date(newCrop.sowingDate);
        const harvestDate = newCrop.expectedHarvestDate ? 
            new Date(newCrop.expectedHarvestDate) : 
            addDays(sowingDate, parseInt(selectedCrop.duration.split('-')[0]) || 120);

        // Calculate seed required
        const seedRequired = `${(selectedCrop.seedPerAcre * area).toFixed(2)} kg`;

        // Generate operations with dates
        const operations = (selectedCrop.operations || []).map(op => ({
            name: op.name,
            description: op.description || `Perform ${op.name} for ${newCrop.name}`,
            daysAfterSowing: op.daysAfterSowing,
            type: op.type,
            scheduledDate: addDays(sowingDate, op.daysAfterSowing)
        }));

        // Calculate total cost
        const costPerAcre = {
            'Wheat': 15000,
            'Rice': 20000,
            'Cotton': 25000,
            'default': 18000
        };
        const totalCost = (costPerAcre[newCrop.name] || costPerAcre['default']) * area;

        const plan = {
            crop: newCrop.name,
            variety: newCrop.variety,
            area: area,
            sowingDate: sowingDate.toISOString(),
            expectedHarvestDate: harvestDate.toISOString(),
            seedRequired: seedRequired,
            fertilizerRequired: selectedCrop.fertilizer,
            waterRequirement: selectedCrop.water,
            expectedYield: selectedCrop.yield,
            duration: selectedCrop.duration,
            totalCost: totalCost,
            operations: operations
        };

        setPlanDetails(plan);
        return plan;
    };

    const saveCropPlan = async () => {
        const plan = calculateCropPlan();
        if (!plan) {
            showSnackbar('Please complete all fields', 'error');
            return;
        }

        setLoading(true);
        try {
            const token = localStorage.getItem('token');
            await axios.post(`${API_URL}/crops`, {
                ...newCrop,
                area: parseFloat(newCrop.area),
                sowingDate: newCrop.sowingDate.toISOString(),
                expectedHarvestDate: newCrop.expectedHarvestDate?.toISOString(),
                planDetails: plan
            }, {
                headers: { Authorization: `Bearer ${token}` }
            });

            showSnackbar('Crop plan saved successfully! Timeline events created.', 'success');
            
            // Refresh data
            await fetchCrops();
            await fetchAnnualTimeline();
            
            // Close dialog and reset
            setDialogOpen(false);
            resetForm();
            setActiveStep(0);
        } catch (error) {
            console.error('Error saving crop plan:', error);
            showSnackbar('Error saving crop plan', 'error');
        } finally {
            setLoading(false);
        }
    };

    const resetForm = () => {
        setNewCrop({
            name: '',
            variety: '',
            season: '',
            landType: '',
            area: '',
            sowingDate: new Date(),
            expectedHarvestDate: null,
            soilType: 'loam',
            waterSource: 'rainfed'
        });
        setPlanDetails(null);
        setSelectedSeason('');
        setSelectedLandType('');
        setRecommendations([]);
    };

    const handleInputChange = (field, value) => {
        setNewCrop(prev => ({
            ...prev,
            [field]: value
        }));

        // Auto-calculate harvest date
        if (field === 'name' && value && newCrop.sowingDate) {
            const selectedCrop = recommendations.find(c => c.name === value);
            if (selectedCrop) {
                const days = parseInt(selectedCrop.duration.split('-')[0]) || 120;
                const harvestDate = addDays(new Date(newCrop.sowingDate), days);
                setNewCrop(prev => ({
                    ...prev,
                    expectedHarvestDate: harvestDate
                }));
            }
        }
    };

    const renderStepContent = (step) => {
        switch (step) {
            case 0:
                return (
                    <Grid container spacing={3}>
                        <Grid item xs={12} md={6}>
                            <FormControl fullWidth sx={{ mb: 3 }}>
                                <InputLabel>Season</InputLabel>
                                <Select
                                    value={selectedSeason}
                                    label="Season"
                                    onChange={(e) => {
                                        setSelectedSeason(e.target.value);
                                        handleInputChange('season', e.target.value);
                                    }}
                                >
                                    <MenuItem value="rabi">Rabi (Winter: Oct-Mar)</MenuItem>
                                    <MenuItem value="kharif">Kharif (Monsoon: Jun-Nov)</MenuItem>
                                    <MenuItem value="zaid">Zaid (Summer: Mar-Jun)</MenuItem>
                                </Select>
                            </FormControl>
                        </Grid>
                        <Grid item xs={12} md={6}>
                            <FormControl fullWidth sx={{ mb: 3 }}>
                                <InputLabel>Land Type</InputLabel>
                                <Select
                                    value={selectedLandType}
                                    label="Land Type"
                                    onChange={(e) => {
                                        setSelectedLandType(e.target.value);
                                        handleInputChange('landType', e.target.value);
                                    }}
                                >
                                    <MenuItem value="sandy">Sandy Soil</MenuItem>
                                    <MenuItem value="loam">Loam Soil</MenuItem>
                                    <MenuItem value="clay">Clay Soil</MenuItem>
                                </Select>
                            </FormControl>
                        </Grid>
                        {selectedSeason && selectedLandType && recommendations.length > 0 && (
                            <Grid item xs={12}>
                                <Alert severity="info" sx={{ mb: 2 }}>
                                    Recommended crops for {selectedSeason.toUpperCase()} season in {selectedLandType} soil:
                                </Alert>
                                <Grid container spacing={2}>
                                    {recommendations.map((crop, index) => (
                                        <Grid item xs={6} sm={4} md={3} key={index}>
                                            <Card 
                                                sx={{ 
                                                    cursor: 'pointer',
                                                    border: newCrop.name === crop.name ? '2px solid #4CAF50' : '1px solid #e0e0e0',
                                                    '&:hover': { borderColor: '#4CAF50', transform: 'translateY(-2px)' },
                                                    transition: 'all 0.2s'
                                                }}
                                                onClick={() => handleInputChange('name', crop.name)}
                                            >
                                                <CardContent sx={{ textAlign: 'center', p: 2 }}>
                                                    {crop.name === 'Rice' && <WaterDrop sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />}
                                                    {crop.name === 'Wheat' && <Grass sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />}
                                                    {crop.name === 'Cotton' && <Spa sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />}
                                                    <Typography variant="subtitle1" sx={{ fontWeight: 'bold', mb: 0.5 }}>
                                                        {crop.name}
                                                    </Typography>
                                                    <Typography variant="caption" color="textSecondary" sx={{ display: 'block' }}>
                                                        Yield: {crop.yield}
                                                    </Typography>
                                                    <Typography variant="caption" color="textSecondary" sx={{ display: 'block' }}>
                                                        Duration: {crop.duration}
                                                    </Typography>
                                                </CardContent>
                                            </Card>
                                        </Grid>
                                    ))}
                                </Grid>
                            </Grid>
                        )}
                    </Grid>
                );

            case 1:
                return (
                    <Grid container spacing={3}>
                        <Grid item xs={12} md={6}>
                            <TextField
                                fullWidth
                                label="Crop Name"
                                value={newCrop.name}
                                disabled
                                sx={{ mb: 2 }}
                            />
                            <TextField
                                fullWidth
                                label="Variety"
                                value={newCrop.variety}
                                onChange={(e) => handleInputChange('variety', e.target.value)}
                                sx={{ mb: 2 }}
                                placeholder="e.g., HD-2967, Pusa-44"
                            />
                            <TextField
                                fullWidth
                                label="Area (acres)"
                                type="number"
                                value={newCrop.area}
                                onChange={(e) => handleInputChange('area', e.target.value)}
                                sx={{ mb: 2 }}
                                InputProps={{ inputProps: { min: 0.1, step: 0.1 } }}
                            />
                            <FormControl fullWidth sx={{ mb: 2 }}>
                                <InputLabel>Water Source</InputLabel>
                                <Select
                                    value={newCrop.waterSource}
                                    label="Water Source"
                                    onChange={(e) => handleInputChange('waterSource', e.target.value)}
                                >
                                    <MenuItem value="rainfed">Rainfed</MenuItem>
                                    <MenuItem value="canal">Canal Irrigation</MenuItem>
                                    <MenuItem value="tube-well">Tube Well</MenuItem>
                                    <MenuItem value="drip">Drip Irrigation</MenuItem>
                                </Select>
                            </FormControl>
                        </Grid>
                        <Grid item xs={12} md={6}>
                            <LocalizationProvider dateAdapter={AdapterDateFns}>
                                <DatePicker
                                    label="Sowing Date"
                                    value={newCrop.sowingDate}
                                    onChange={(date) => handleInputChange('sowingDate', date)}
                                    renderInput={(params) => <TextField {...params} fullWidth sx={{ mb: 2 }} />}
                                />
                                <DatePicker
                                    label="Expected Harvest Date"
                                    value={newCrop.expectedHarvestDate}
                                    onChange={(date) => handleInputChange('expectedHarvestDate', date)}
                                    minDate={newCrop.sowingDate}
                                    renderInput={(params) => <TextField {...params} fullWidth sx={{ mb: 2 }} />}
                                />
                            </LocalizationProvider>
                            {newCrop.name && recommendations.find(c => c.name === newCrop.name) && (
                                <Alert severity="info" sx={{ mt: 2 }}>
                                    <Typography variant="body2">
                                        <strong>Requirements:</strong><br />
                                        â€¢ {recommendations.find(c => c.name === newCrop.name).fertilizer}<br />
                                        â€¢ Water: {recommendations.find(c => c.name === newCrop.name).water}<br />
                                        â€¢ Duration: {recommendations.find(c => c.name === newCrop.name).duration}
                                    </Typography>
                                </Alert>
                            )}
                        </Grid>
                    </Grid>
                );

            case 2:
                const plan = calculateCropPlan();
                return plan ? (
                    <Grid container spacing={3}>
                        <Grid item xs={12}>
                            <Typography variant="h6" gutterBottom color="primary">
                                Crop Plan Summary
                            </Typography>
                        </Grid>
                        <Grid item xs={12} md={6}>
                            <Card variant="outlined" sx={{ mb: 2 }}>
                                <CardContent>
                                    <Typography variant="subtitle1" gutterBottom>
                                        Basic Information
                                    </Typography>
                                    <Table size="small">
                                        <TableBody>
                                            <TableRow>
                                                <TableCell><strong>Crop</strong></TableCell>
                                                <TableCell>{plan.crop} ({plan.variety})</TableCell>
                                            </TableRow>
                                            <TableRow>
                                                <TableCell><strong>Area</strong></TableCell>
                                                <TableCell>{plan.area} acres</TableCell>
                                            </TableRow>
                                            <TableRow>
                                                <TableCell><strong>Season</strong></TableCell>
                                                <TableCell>{newCrop.season?.toUpperCase()}</TableCell>
                                            </TableRow>
                                            <TableRow>
                                                <TableCell><strong>Sowing Date</strong></TableCell>
                                                <TableCell>{format(new Date(plan.sowingDate), 'dd MMM yyyy')}</TableCell>
                                            </TableRow>
                                            <TableRow>
                                                <TableCell><strong>Harvest Date</strong></TableCell>
                                                <TableCell>{format(new Date(plan.expectedHarvestDate), 'dd MMM yyyy')}</TableCell>
                                            </TableRow>
                                        </TableBody>
                                    </Table>
                                </CardContent>
                            </Card>
                            
                            <Card variant="outlined">
                                <CardContent>
                                    <Typography variant="subtitle1" gutterBottom>
                                        Resource Requirements
                                    </Typography>
                                    <Table size="small">
                                        <TableBody>
                                            <TableRow>
                                                <TableCell><strong>Seed Required</strong></TableCell>
                                                <TableCell>{plan.seedRequired}</TableCell>
                                            </TableRow>
                                            <TableRow>
                                                <TableCell><strong>Fertilizer</strong></TableCell>
                                                <TableCell>{plan.fertilizerRequired}</TableCell>
                                            </TableRow>
                                            <TableRow>
                                                <TableCell><strong>Water Requirement</strong></TableCell>
                                                <TableCell>{plan.waterRequirement}</TableCell>
                                            </TableRow>
                                            <TableRow>
                                                <TableCell><strong>Expected Yield</strong></TableCell>
                                                <TableCell>{plan.expectedYield}</TableCell>
                                            </TableRow>
                                            <TableRow>
                                                <TableCell><strong>Estimated Cost</strong></TableCell>
                                                <TableCell>â‚¹{plan.totalCost.toLocaleString()}</TableCell>
                                            </TableRow>
                                        </TableBody>
                                    </Table>
                                </CardContent>
                            </Card>
                        </Grid>
                        <Grid item xs={12} md={6}>
                            <Card sx={{ height: '100%' }}>
                                <CardContent>
                                    <Typography variant="subtitle1" gutterBottom>
                                        Operation Timeline (Generated Automatically)
                                    </Typography>
                                    <Box sx={{ maxHeight: 300, overflow: 'auto' }}>
                                        {plan.operations.map((op, index) => (
                                            <Card key={index} variant="outlined" sx={{ mb: 1, p: 1 }}>
                                                <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                                    <CalendarToday sx={{ fontSize: 16, mr: 1, color: 'primary.main' }} />
                                                    <Box sx={{ flexGrow: 1 }}>
                                                        <Typography variant="body2" fontWeight="bold">
                                                            {op.name}
                                                        </Typography>
                                                        <Typography variant="caption" color="textSecondary">
                                                            {format(new Date(op.scheduledDate), 'dd MMM yyyy')} â€¢ {op.type}
                                                        </Typography>
                                                    </Box>
                                                    <Chip 
                                                        label="Upcoming" 
                                                        size="small" 
                                                        color="info"
                                                        icon={<Schedule />}
                                                    />
                                                </Box>
                                            </Card>
                                        ))}
                                    </Box>
                                </CardContent>
                            </Card>
                        </Grid>
                        <Grid item xs={12}>
                            <Alert severity="success">
                                <Typography variant="body2">
                                    <strong>Note:</strong> This plan will automatically create {plan.operations.length} timeline events 
                                    in your annual calendar after saving.
                                </Typography>
                            </Alert>
                        </Grid>
                    </Grid>
                ) : (
                    <Alert severity="warning">
                        Please complete all required fields to generate the plan.
                    </Alert>
                );

            default:
                return null;
        }
    };

    // Render Annual Timeline
    const renderAnnualTimeline = () => {
        if (!annualTimeline.monthlyTimeline) return null;

        const months = eachMonthOfInterval({
            start: startOfYear(new Date()),
            end: endOfYear(new Date())
        });

        return (
            <Paper sx={{ p: 3, mt: 3 }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                    <Typography variant="h6">
                        Annual Timeline ({new Date().getFullYear()})
                    </Typography>
                    <Typography variant="caption" color="textSecondary">
                        Total Events: {annualTimeline.stats?.totalEvents || 0}
                    </Typography>
                </Box>
                
                <Grid container spacing={2}>
                    {months.map((month, index) => {
                        const monthKey = format(month, 'MMM');
                        const events = annualTimeline.monthlyTimeline?.[monthKey] || [];
                        
                        return (
                            <Grid item xs={12} sm={6} md={4} lg={2} key={index}>
                                <Card variant="outlined" sx={{ height: '100%' }}>
                                    <CardContent sx={{ p: 2 }}>
                                        <Typography variant="subtitle2" color="primary" gutterBottom>
                                            {monthKey}
                                        </Typography>
                                        {events.length > 0 ? (
                                            <Box>
                                                {events.slice(0, 3).map((event, idx) => (
                                                    <Box key={idx} sx={{ mb: 1 }}>
                                                        <Typography variant="caption" sx={{ fontWeight: 'bold', display: 'block' }}>
                                                            {event.title}
                                                        </Typography>
                                                        <Typography variant="caption" color="textSecondary" sx={{ display: 'block' }}>
                                                            {format(new Date(event.date), 'dd')} â€¢ {event.type}
                                                        </Typography>
                                                    </Box>
                                                ))}
                                                {events.length > 3 && (
                                                    <Typography variant="caption" color="primary">
                                                        +{events.length - 3} more events
                                                    </Typography>
                                                )}
                                            </Box>
                                        ) : (
                                            <Typography variant="caption" color="textSecondary">
                                                No events scheduled
                                            </Typography>
                                        )}
                                    </CardContent>
                                </Card>
                            </Grid>
                        );
                    })}
                </Grid>
                
                {/* Timeline Visualization */}
                {annualTimeline.events && annualTimeline.events.length > 0 && (
                    <Box sx={{ mt: 3 }}>
                        <Typography variant="subtitle1" gutterBottom>
                            Upcoming Events Timeline
                        </Typography>
                        <Box sx={{ height: 300 }}>
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={annualTimeline.events.slice(0, 10)}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis 
                                        dataKey="date" 
                                        tickFormatter={(date) => format(new Date(date), 'dd MMM')}
                                    />
                                    <YAxis />
                                    <RechartsTooltip 
                                        labelFormatter={(date) => format(new Date(date), 'dd MMM yyyy')}
                                    />
                                    <Legend />
                                    <Line 
                                        type="monotone" 
                                        dataKey="status" 
                                        stroke="#8884d8" 
                                        name="Event Status"
                                        dot={{ r: 4 }}
                                    />
                                </LineChart>
                            </ResponsiveContainer>
                        </Box>
                    </Box>
                )}
            </Paper>
        );
    };

    return (
        <Container maxWidth="xl" sx={{ mt: 4, mb: 4 }}>
            <Typography variant="h4" gutterBottom>
                Crop Planner & Timeline Manager
            </Typography>

            <Grid container spacing={3}>
                {/* Main Planning Section */}
                <Grid item xs={12} md={8}>
                    <Paper sx={{ p: 3, mb: 3 }}>
                        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                            <Box>
                                <Typography variant="h5">
                                    Crop Planning
                                </Typography>
                                <Typography variant="caption" color="textSecondary">
                                    Plan your crops and automatically generate farming timeline
                                </Typography>
                            </Box>
                            <Button
                                variant="contained"
                                startIcon={<Add />}
                                onClick={() => setDialogOpen(true)}
                            >
                                New Crop Plan
                            </Button>
                        </Box>

                        {/* Existing Crop Plans */}
                        <Typography variant="h6" gutterBottom>
                            Your Crop Plans ({crops.length})
                        </Typography>
                        <TableContainer component={Paper} variant="outlined">
                            <Table>
                                <TableHead>
                                    <TableRow>
                                        <TableCell>Crop</TableCell>
                                        <TableCell>Season</TableCell>
                                        <TableCell>Area</TableCell>
                                        <TableCell>Sowing Date</TableCell>
                                        <TableCell>Status</TableCell>
                                        <TableCell>Timeline Events</TableCell>
                                    </TableRow>
                                </TableHead>
                                <TableBody>
                                    {crops.map((crop) => (
                                        <TableRow key={crop._id || crop.id}>
                                            <TableCell>
                                                <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                                    {crop.name === 'Rice' && <WaterDrop sx={{ mr: 1, color: 'primary.main' }} />}
                                                    {crop.name === 'Wheat' && <Grass sx={{ mr: 1, color: 'success.main' }} />}
                                                    {crop.name === 'Cotton' && <Spa sx={{ mr: 1, color: 'info.main' }} />}
                                                    <Box>
                                                        <Typography variant="body2" fontWeight="bold">
                                                            {crop.name}
                                                        </Typography>
                                                        <Typography variant="caption" color="textSecondary">
                                                            {crop.variety}
                                                        </Typography>
                                                    </Box>
                                                </Box>
                                            </TableCell>
                                            <TableCell>
                                                <Chip 
                                                    label={crop.season?.toUpperCase()} 
                                                    size="small"
                                                    color={crop.season === 'rabi' ? 'primary' : crop.season === 'kharif' ? 'success' : 'warning'}
                                                />
                                            </TableCell>
                                            <TableCell>{crop.area} acres</TableCell>
                                            <TableCell>
                                                {format(new Date(crop.sowingDate), 'dd MMM yyyy')}
                                            </TableCell>
                                            <TableCell>
                                                <Chip 
                                                    label={crop.status} 
                                                    size="small"
                                                    color={
                                                        crop.status === 'growing' ? 'success' :
                                                        crop.status === 'harvested' ? 'warning' :
                                                        crop.status === 'planned' ? 'info' : 'default'
                                                    }
                                                    icon={crop.status === 'planned' ? <Schedule /> : <CheckCircle />}
                                                />
                                            </TableCell>
                                            <TableCell>
                                                <Button 
                                                    size="small" 
                                                    startIcon={<Timeline />}
                                                    onClick={() => {
                                                        // View timeline events for this crop
                                                    }}
                                                >
                                                    View Events
                                                </Button>
                                            </TableCell>
                                        </TableRow>
                                    ))}
                                </TableBody>
                            </Table>
                        </TableContainer>
                    </Paper>

                    {/* Annual Timeline Section */}
                    {renderAnnualTimeline()}
                </Grid>

                {/* Sidebar - Statistics */}
                <Grid item xs={12} md={4}>
                    <Paper sx={{ p: 3, mb: 3 }}>
                        <Typography variant="h6" gutterBottom>
                            Crop Distribution
                        </Typography>
                        {crops.length > 0 ? (
                            <Box sx={{ height: 300 }}>
                                <ResponsiveContainer width="100%" height="100%">
                                    <PieChart>
                                        <Pie
                                            data={crops.map(crop => ({
                                                name: crop.name,
                                                value: crop.area,
                                                color: crop.status === 'growing' ? '#4CAF50' : 
                                                       crop.status === 'harvested' ? '#FF9800' : '#2196F3'
                                            }))}
                                            cx="50%"
                                            cy="50%"
                                            labelLine={false}
                                            label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}
                                            outerRadius={80}
                                            fill="#8884d8"
                                            dataKey="value"
                                        >
                                            {crops.map((entry, index) => (
                                                <Cell key={`cell-${index}`} 
                                                    fill={
                                                        entry.status === 'growing' ? '#4CAF50' : 
                                                        entry.status === 'harvested' ? '#FF9800' : '#2196F3'
                                                    } 
                                                />
                                            ))}
                                        </Pie>
                                        <RechartsTooltip formatter={(value) => [`${value} acres`, 'Area']} />
                                    </PieChart>
                                </ResponsiveContainer>
                            </Box>
                        ) : (
                            <Alert severity="info">
                                No crops planned yet. Create your first crop plan!
                            </Alert>
                        )}
                    </Paper>

                    <Paper sx={{ p: 3, mb: 3 }}>
                        <Typography variant="h6" gutterBottom>
                            Quick Stats
                        </Typography>
                        <Grid container spacing={2}>
                            <Grid item xs={6}>
                                <Card variant="outlined">
                                    <CardContent sx={{ p: 2 }}>
                                        <Typography color="textSecondary" variant="caption">
                                            Total Area
                                        </Typography>
                                        <Typography variant="h5">
                                            {crops.reduce((sum, crop) => sum + (parseFloat(crop.area) || 0), 0).toFixed(1)} acres
                                        </Typography>
                                    </CardContent>
                                </Card>
                            </Grid>
                            <Grid item xs={6}>
                                <Card variant="outlined">
                                    <CardContent sx={{ p: 2 }}>
                                        <Typography color="textSecondary" variant="caption">
                                            Active Crops
                                        </Typography>
                                        <Typography variant="h5">
                                            {crops.filter(c => c.status === 'growing').length}
                                        </Typography>
                                    </CardContent>
                                </Card>
                            </Grid>
                            <Grid item xs={6}>
                                <Card variant="outlined">
                                    <CardContent sx={{ p: 2 }}>
                                        <Typography color="textSecondary" variant="caption">
                                            Total Cost
                                        </Typography>
                                        <Typography variant="h5">
                                            â‚¹{crops.reduce((sum, crop) => sum + (crop.plan?.totalCost || 0), 0).toLocaleString()}
                                        </Typography>
                                    </CardContent>
                                </Card>
                            </Grid>
                            <Grid item xs={6}>
                                <Card variant="outlined">
                                    <CardContent sx={{ p: 2 }}>
                                        <Typography color="textSecondary" variant="caption">
                                            Timeline Events
                                        </Typography>
                                        <Typography variant="h5">
                                            {annualTimeline.stats?.totalEvents || 0}
                                        </Typography>
                                    </CardContent>
                                </Card>
                            </Grid>
                        </Grid>
                    </Paper>

                    <Paper sx={{ p: 3 }}>
                        <Typography variant="h6" gutterBottom>
                            Crop Rotation Suggestions
                        </Typography>
                        <List dense>
                            {[
                                { crop1: 'Wheat', crop2: 'Rice', crop3: 'Legumes', benefit: 'Improves soil nitrogen' },
                                { crop1: 'Cotton', crop2: 'Wheat', crop3: 'Mustard', benefit: 'Breaks pest cycle' },
                                { crop1: 'Rice', crop2: 'Vegetables', crop3: 'Pulses', benefit: 'Diversifies income' }
                            ].map((rotation, index) => (
                                <Card key={index} variant="outlined" sx={{ mb: 1 }}>
                                    <CardContent sx={{ p: 2 }}>
                                        <Typography variant="caption" fontWeight="bold">
                                            {rotation.crop1} â†’ {rotation.crop2} â†’ {rotation.crop3}
                                        </Typography>
                                        <Typography variant="caption" color="textSecondary" sx={{ display: 'block' }}>
                                            {rotation.benefit}
                                        </Typography>
                                    </CardContent>
                                </Card>
                            ))}
                        </List>
                    </Paper>
                </Grid>
            </Grid>

            {/* Dialog for New Crop Plan */}
            <Dialog 
                open={dialogOpen} 
                onClose={() => {
                    if (!loading) {
                        setDialogOpen(false);
                        resetForm();
                        setActiveStep(0);
                    }
                }}
                maxWidth="md"
                fullWidth
            >
                <DialogTitle>
                    Create New Crop Plan
                    {planDetails && (
                        <Typography variant="caption" color="primary" sx={{ ml: 2 }}>
                            {planDetails.crop} - {planDetails.area} acres
                        </Typography>
                    )}
                </DialogTitle>
                <DialogContent>
                    <Stepper activeStep={activeStep} sx={{ my: 3 }}>
                        {['Select Crop', 'Set Details', 'Review Plan', 'Save'].map((label, index) => (
                            <Step key={label}>
                                <StepLabel>{label}</StepLabel>
                            </Step>
                        ))}
                    </Stepper>

                    {renderStepContent(activeStep)}
                </DialogContent>
                <DialogActions sx={{ p: 3 }}>
                    <Button 
                        onClick={() => {
                            if (activeStep > 0) {
                                setActiveStep(activeStep - 1);
                            } else {
                                setDialogOpen(false);
                                resetForm();
                            }
                        }}
                        disabled={loading}
                    >
                        {activeStep === 0 ? 'Cancel' : 'Back'}
                    </Button>
                    <Button
                        variant="contained"
                        onClick={() => {
                            if (activeStep < 3) {
                                setActiveStep(activeStep + 1);
                            } else {
                                saveCropPlan();
                            }
                        }}
                        disabled={
                            loading || 
                            (activeStep === 2 && !calculateCropPlan()) ||
                            (activeStep === 0 && (!selectedSeason || !selectedLandType))
                        }
                    >
                        {loading ? 'Saving...' : 
                         activeStep === 3 ? 'Save Crop Plan' : 'Next'}
                    </Button>
                </DialogActions>
            </Dialog>

            {/* Snackbar for notifications */}
            <Snackbar
                open={snackbar.open}
                autoHideDuration={6000}
                onClose={() => setSnackbar({ ...snackbar, open: false })}
                anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}
            >
                <Alert 
                    severity={snackbar.severity} 
                    onClose={() => setSnackbar({ ...snackbar, open: false })}
                >
                    {snackbar.message}
                </Alert>
            </Snackbar>
        </Container>
    );
};

export default CropPlanner;-e 
===== FILE: ./src/components/ActivityTimeline.js =====

import React, { useState, useEffect } from 'react';
import {
    Container,
    Paper,
    Typography,
    Grid,
    Card,
    CardContent,
    Button,
    Chip,
    IconButton,
    Dialog,
    DialogTitle,
    DialogContent,
    DialogActions,
    TextField,
    Select,
    MenuItem,
    FormControl,
    InputLabel,
    Box,
    Tabs,
    Tab,
    List,
    ListItem,
    ListItemText,
    ListItemIcon,
    Divider,
    Avatar,
    LinearProgress,
    Stepper,
    Step,
    StepLabel
} from '@mui/material';
import {
    Timeline as TimelineIcon,
    Add,
    Edit,
    Delete,
    CheckCircle,
    PlayArrow,
    Warning,
    Photo,
    AttachFile,
    Today,
    ViewWeek,
    ViewDay,
    ViewAgenda,
    ArrowForward,
    ArrowBack,
    Crop,
    People,
    WaterDrop,
    Grass,
    Spa,
    LocalFlorist,
    Build,
    Paid,
    Report,
    MoreVert
} from '@mui/icons-material';
import { DatePicker } from '@mui/x-date-pickers/DatePicker';
import { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';
import { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns';
import { format, addDays, startOfWeek, endOfWeek, eachDayOfInterval, isToday } from 'date-fns';
import { timelineService } from '../services/api';
import ActivityForm from './ActivityForm';

const ActivityTimeline = () => {
    const [activities, setActivities] = useState([]);
    const [filteredActivities, setFilteredActivities] = useState([]);
    const [stats, setStats] = useState({});
    const [loading, setLoading] = useState(true);
    const [view, setView] = useState('week'); // day, week, month, list
    const [selectedDate, setSelectedDate] = useState(new Date());
    const [filters, setFilters] = useState({
        status: '',
        type: '',
        crop: '',
        priority: ''
    });
    const [showForm, setShowForm] = useState(false);
    const [selectedActivity, setSelectedActivity] = useState(null);
    const [detailsOpen, setDetailsOpen] = useState(false);

    // Activity type icons mapping
    const activityIcons = {
        sowing: <Grass color="success" />,
        transplanting: <LocalFlorist color="primary" />,
        irrigation: <WaterDrop color="info" />,
        fertilizer: <Spa color="warning" />,
        pesticide: <Warning color="error" />,
        harvesting: <Crop color="success" />,
        weeding: <Grass color="action" />,
        maintenance: <Build color="action" />,
        labor: <People color="secondary" />,
        payment: <Paid color="success" />,
        issue: <Report color="error" />
    };

    // Priority colors
    const priorityColors = {
        low: 'default',
        medium: 'primary',
        high: 'warning',
        critical: 'error'
    };

    // Status colors
    const statusColors = {
        upcoming: 'info',
        in_progress: 'warning',
        completed: 'success',
        missed: 'error',
        delayed: 'warning'
    };

    useEffect(() => {
        fetchActivities();
    }, [selectedDate, filters]);

    const fetchActivities = async () => {
        setLoading(true);
        try {
            const response = await timelineService.getActivities({
                startDate: getDateRange().start.toISOString(),
                endDate: getDateRange().end.toISOString(),
                ...filters
            });
            setActivities(response.activities);
            setFilteredActivities(response.activities);
            setStats(response.stats);
        } catch (error) {
            console.error('Error fetching activities:', error);
        } finally {
            setLoading(false);
        }
    };

    const getDateRange = () => {
        const date = selectedDate;
        switch (view) {
            case 'day':
                return {
                    start: new Date(date.getFullYear(), date.getMonth(), date.getDate()),
                    end: new Date(date.getFullYear(), date.getMonth(), date.getDate() + 1)
                };
            case 'week':
                const weekStart = startOfWeek(date, { weekStartsOn: 1 }); // Monday
                const weekEnd = endOfWeek(date, { weekStartsOn: 1 });
                return { start: weekStart, end: weekEnd };
            case 'month':
                return {
                    start: new Date(date.getFullYear(), date.getMonth(), 1),
                    end: new Date(date.getFullYear(), date.getMonth() + 1, 0)
                };
            default:
                return {
                    start: new Date(date.getFullYear(), date.getMonth(), date.getDate() - 7),
                    end: new Date(date.getFullYear(), date.getMonth(), date.getDate() + 7)
                };
        }
    };

    const handleFilterChange = (field, value) => {
        setFilters(prev => ({ ...prev, [field]: value }));
    };

    const handleStartActivity = async (activityId) => {
        try {
            await timelineService.startActivity(activityId);
            fetchActivities();
        } catch (error) {
            console.error('Error starting activity:', error);
        }
    };

    const handleCompleteActivity = async (activityId) => {
        try {
            await timelineService.completeActivity(activityId);
            fetchActivities();
        } catch (error) {
            console.error('Error completing activity:', error);
        }
    };

    const handleDeleteActivity = async (activityId) => {
        if (window.confirm('Are you sure you want to delete this activity?')) {
            try {
                await timelineService.deleteActivity(activityId);
                fetchActivities();
            } catch (error) {
                console.error('Error deleting activity:', error);
            }
        }
    };

    const renderDayView = () => {
        const dayActivities = filteredActivities.filter(activity => {
            const activityDate = new Date(activity.plannedDate);
            return activityDate.toDateString() === selectedDate.toDateString();
        });

        return (
            <Grid container spacing={2}>
                <Grid item xs={12}>
                    <Typography variant="h6" gutterBottom>
                        {format(selectedDate, 'EEEE, MMMM d, yyyy')}
                    </Typography>
                </Grid>
                {dayActivities.length === 0 ? (
                    <Grid item xs={12}>
                        <Card>
                            <CardContent>
                                <Typography color="textSecondary" align="center">
                                    No activities scheduled for today
                                </Typography>
                            </CardContent>
                        </Card>
                    </Grid>
                ) : (
                    dayActivities.map((activity) => (
                        <Grid item xs={12} key={activity._id}>
                            <ActivityCard 
                                activity={activity} 
                                onSelect={() => {
                                    setSelectedActivity(activity);
                                    setDetailsOpen(true);
                                }}
                                onStart={handleStartActivity}
                                onComplete={handleCompleteActivity}
                                onDelete={handleDeleteActivity}
                            />
                        </Grid>
                    ))
                )}
            </Grid>
        );
    };

    const renderWeekView = () => {
        const weekStart = startOfWeek(selectedDate, { weekStartsOn: 1 });
        const weekDays = eachDayOfInterval({
            start: weekStart,
            end: addDays(weekStart, 6)
        });

        return (
            <Grid container spacing={2}>
                {weekDays.map((day, index) => {
                    const dayActivities = filteredActivities.filter(activity => {
                        const activityDate = new Date(activity.plannedDate);
                        return activityDate.toDateString() === day.toDateString();
                    });

                    return (
                        <Grid item xs={12} sm={6} md={4} lg={1.7} key={index}>
                            <Card 
                                variant={isToday(day) ? 'elevation' : 'outlined'} 
                                elevation={isToday(day) ? 3 : 0}
                                sx={{ 
                                    borderColor: isToday(day) ? 'primary.main' : 'divider',
                                    height: '100%'
                                }}
                            >
                                <CardContent>
                                    <Typography 
                                        variant="subtitle2" 
                                        color={isToday(day) ? 'primary' : 'textSecondary'}
                                        gutterBottom
                                    >
                                        {format(day, 'EEE')}
                                    </Typography>
                                    <Typography 
                                        variant="h6" 
                                        color={isToday(day) ? 'primary' : 'textPrimary'}
                                    >
                                        {format(day, 'd')}
                                    </Typography>
                                    
                                    <Box sx={{ mt: 2 }}>
                                        {dayActivities.slice(0, 3).map((activity) => (
                                            <Chip
                                                key={activity._id}
                                                label={activity.title}
                                                size="small"
                                                sx={{ 
                                                    mb: 0.5,
                                                    width: '100%',
                                                    justifyContent: 'flex-start'
                                                }}
                                                icon={activityIcons[activity.type]}
                                                color={statusColors[activity.status] || 'default'}
                                                onClick={() => {
                                                    setSelectedActivity(activity);
                                                    setDetailsOpen(true);
                                                }}
                                            />
                                        ))}
                                        {dayActivities.length > 3 && (
                                            <Typography variant="caption" color="textSecondary">
                                                +{dayActivities.length - 3} more
                                            </Typography>
                                        )}
                                    </Box>
                                </CardContent>
                            </Card>
                        </Grid>
                    );
                })}
            </Grid>
        );
    };

    const renderListView = () => {
        return (
            <List>
                {filteredActivities.map((activity) => (
                    <React.Fragment key={activity._id}>
                        <ListItem 
                            button
                            onClick={() => {
                                setSelectedActivity(activity);
                                setDetailsOpen(true);
                            }}
                        >
                            <ListItemIcon>
                                {activityIcons[activity.type] || <TimelineIcon />}
                            </ListItemIcon>
                            <ListItemText
                                primary={
                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                        <Typography variant="body1">
                                            {activity.title}
                                        </Typography>
                                        <Chip 
                                            label={activity.status} 
                                            size="small" 
                                            color={statusColors[activity.status]}
                                        />
                                        {activity.priority === 'high' && (
                                            <Chip label="High" size="small" color="warning" />
                                        )}
                                        {activity.priority === 'critical' && (
                                            <Chip label="Critical" size="small" color="error" />
                                        )}
                                    </Box>
                                }
                                secondary={
                                    <Box>
                                        <Typography variant="caption" display="block">
                                            {format(new Date(activity.plannedDate), 'MMM d, yyyy h:mm a')}
                                        </Typography>
                                        <Typography variant="caption" color="textSecondary">
                                            {activity.cropName && `Crop: ${activity.cropName}`}
                                            {activity.fieldName && ` â€¢ Field: ${activity.fieldName}`}
                                        </Typography>
                                    </Box>
                                }
                            />
                            <Box>
                                {activity.status === 'upcoming' && (
                                    <IconButton 
                                        size="small" 
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            handleStartActivity(activity._id);
                                        }}
                                    >
                                        <PlayArrow />
                                    </IconButton>
                                )}
                                {activity.status === 'in_progress' && (
                                    <IconButton 
                                        size="small" 
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            handleCompleteActivity(activity._id);
                                        }}
                                    >
                                        <CheckCircle />
                                    </IconButton>
                                )}
                            </Box>
                        </ListItem>
                        <Divider />
                    </React.Fragment>
                ))}
            </List>
        );
    };

    const renderStatsCards = () => {
        return (
            <Grid container spacing={2} sx={{ mb: 3 }}>
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Typography color="textSecondary" variant="caption">
                                Total Activities
                            </Typography>
                            <Typography variant="h5">{stats.total || 0}</Typography>
                        </CardContent>
                    </Card>
                </Grid>
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Typography color="textSecondary" variant="caption">
                                Upcoming
                            </Typography>
                            <Typography variant="h5" color="info.main">
                                {stats.upcoming || 0}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Typography color="textSecondary" variant="caption">
                                In Progress
                            </Typography>
                            <Typography variant="h5" color="warning.main">
                                {stats.inProgress || 0}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Typography color="textSecondary" variant="caption">
                                Overdue
                            </Typography>
                            <Typography variant="h5" color="error.main">
                                {stats.overdue || 0}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
            </Grid>
        );
    };

    return (
        <Container maxWidth="xl" sx={{ mt: 4, mb: 4 }}>
            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h4">
                    Activity Timeline
                </Typography>
                <Button
                    variant="contained"
                    startIcon={<Add />}
                    onClick={() => setShowForm(true)}
                >
                    Add Activity
                </Button>
            </Box>

            {renderStatsCards()}

            {/* Filters & View Controls */}
            <Paper sx={{ p: 2, mb: 3 }}>
                <Grid container spacing={2} alignItems="center">
                    <Grid item xs={12} md={4}>
                        <Box sx={{ display: 'flex', gap: 1 }}>
                            <Button
                                variant={view === 'day' ? 'contained' : 'outlined'}
                                onClick={() => setView('day')}
                                startIcon={<ViewDay />}
                            >
                                Day
                            </Button>
                            <Button
                                variant={view === 'week' ? 'contained' : 'outlined'}
                                onClick={() => setView('week')}
                                startIcon={<ViewWeek />}
                            >
                                Week
                            </Button>
                            <Button
                                variant={view === 'list' ? 'contained' : 'outlined'}
                                onClick={() => setView('list')}
                                startIcon={<ViewAgenda />}
                            >
                                List
                            </Button>
                        </Box>
                    </Grid>
                    
                    <Grid item xs={12} md={4}>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                            <IconButton onClick={() => setSelectedDate(addDays(selectedDate, -1))}>
                                <ArrowBack />
                            </IconButton>
                            <LocalizationProvider dateAdapter={AdapterDateFns}>
                                <DatePicker
                                    label="Select Date"
                                    value={selectedDate}
                                    onChange={(newDate) => setSelectedDate(newDate)}
                                    renderInput={(params) => <TextField {...params} size="small" />}
                                />
                            </LocalizationProvider>
                            <IconButton onClick={() => setSelectedDate(addDays(selectedDate, 1))}>
                                <ArrowForward />
                            </IconButton>
                            {isToday(selectedDate) && (
                                <Button 
                                    variant="outlined" 
                                    size="small"
                                    startIcon={<Today />}
                                    onClick={() => setSelectedDate(new Date())}
                                >
                                    Today
                                </Button>
                            )}
                        </Box>
                    </Grid>

                    <Grid item xs={12} md={4}>
                        <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap' }}>
                            <FormControl size="small" sx={{ minWidth: 120 }}>
                                <InputLabel>Status</InputLabel>
                                <Select
                                    value={filters.status}
                                    label="Status"
                                    onChange={(e) => handleFilterChange('status', e.target.value)}
                                >
                                    <MenuItem value="">All Status</MenuItem>
                                    <MenuItem value="upcoming">Upcoming</MenuItem>
                                    <MenuItem value="in_progress">In Progress</MenuItem>
                                    <MenuItem value="completed">Completed</MenuItem>
                                    <MenuItem value="overdue">Overdue</MenuItem>
                                </Select>
                            </FormControl>
                            
                            <FormControl size="small" sx={{ minWidth: 120 }}>
                                <InputLabel>Type</InputLabel>
                                <Select
                                    value={filters.type}
                                    label="Type"
                                    onChange={(e) => handleFilterChange('type', e.target.value)}
                                >
                                    <MenuItem value="">All Types</MenuItem>
                                    <MenuItem value="sowing">Sowing</MenuItem>
                                    <MenuItem value="irrigation">Irrigation</MenuItem>
                                    <MenuItem value="fertilizer">Fertilizer</MenuItem>
                                    <MenuItem value="pesticide">Pesticide</MenuItem>
                                    <MenuItem value="harvesting">Harvesting</MenuItem>
                                </Select>
                            </FormControl>
                        </Box>
                    </Grid>
                </Grid>
            </Paper>

            {/* Main Content */}
            <Paper sx={{ p: 3, minHeight: 400 }}>
                {loading ? (
                    <LinearProgress />
                ) : (
                    <>
                        {view === 'day' && renderDayView()}
                        {view === 'week' && renderWeekView()}
                        {view === 'list' && renderListView()}
                    </>
                )}
            </Paper>

            {/* Activity Form Dialog */}
            <Dialog 
                open={showForm} 
                onClose={() => setShowForm(false)}
                maxWidth="md"
                fullWidth
            >
                <DialogTitle>
                    {selectedActivity ? 'Edit Activity' : 'Add New Activity'}
                </DialogTitle>
                <DialogContent>
                    <ActivityForm 
                        activity={selectedActivity}
                        onSuccess={() => {
                            setShowForm(false);
                            setSelectedActivity(null);
                            fetchActivities();
                        }}
                        onCancel={() => {
                            setShowForm(false);
                            setSelectedActivity(null);
                        }}
                    />
                </DialogContent>
            </Dialog>

            {/* Activity Details Dialog */}
            <Dialog 
                open={detailsOpen} 
                onClose={() => setDetailsOpen(false)}
                maxWidth="md"
                fullWidth
            >
                {selectedActivity && (
                    <ActivityDetails 
                        activity={selectedActivity}
                        onClose={() => setDetailsOpen(false)}
                        onEdit={() => {
                            setDetailsOpen(false);
                            setShowForm(true);
                        }}
                        onStart={handleStartActivity}
                        onComplete={handleCompleteActivity}
                        onDelete={handleDeleteActivity}
                    />
                )}
            </Dialog>
        </Container>
    );
};

// Activity Card Component
const ActivityCard = ({ activity, onSelect, onStart, onComplete, onDelete }) => {
    const statusLabels = {
        upcoming: 'Upcoming',
        in_progress: 'In Progress',
        completed: 'Completed',
        missed: 'Missed',
        delayed: 'Delayed'
    };

    return (
        <Card variant="outlined">
            <CardContent>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                    <Box sx={{ flexGrow: 1 }}>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                            {/* activityIcons is defined in parent, so we need to pass it or redefine. 
                                Redefining here for simplicity or we can move it outside. */}
                            <TimelineIcon /> 
                            <Typography variant="subtitle1" fontWeight="bold">
                                {activity.title}
                            </Typography>
                            <Chip 
                                label={statusLabels[activity.status]} 
                                size="small" 
                                color={activity.status === 'completed' ? 'success' : 'primary'}
                            />
                            {activity.priority === 'high' && (
                                <Chip label="High Priority" size="small" color="warning" />
                            )}
                        </Box>
                        
                        <Typography variant="body2" color="textSecondary" paragraph>
                            {activity.description}
                        </Typography>
                        
                        <Grid container spacing={1}>
                            <Grid item xs={6}>
                                <Typography variant="caption" display="block" color="textSecondary">
                                    Planned Date
                                </Typography>
                                <Typography variant="body2">
                                    {format(new Date(activity.plannedDate), 'MMM d, yyyy')}
                                </Typography>
                            </Grid>
                            {activity.cropName && (
                                <Grid item xs={6}>
                                    <Typography variant="caption" display="block" color="textSecondary">
                                        Crop
                                    </Typography>
                                    <Typography variant="body2">
                                        {activity.cropName}
                                    </Typography>
                                </Grid>
                            )}
                        </Grid>
                    </Box>
                    
                    <Box>
                        <IconButton size="small" onClick={onSelect}>
                            <MoreVert />
                        </IconButton>
                    </Box>
                </Box>
                
                <Box sx={{ display: 'flex', justifyContent: 'flex-end', gap: 1, mt: 2 }}>
                    {activity.status === 'upcoming' && (
                        <Button 
                            size="small" 
                            variant="outlined"
                            startIcon={<PlayArrow />}
                            onClick={() => onStart(activity._id)}
                        >
                            Start
                        </Button>
                    )}
                    {activity.status === 'in_progress' && (
                        <Button 
                            size="small" 
                            variant="contained"
                            startIcon={<CheckCircle />}
                            onClick={() => onComplete(activity._id)}
                        >
                            Complete
                        </Button>
                    )}
                </Box>
            </CardContent>
        </Card>
    );
};

// Activity Details Component
const ActivityDetails = ({ activity, onClose, onEdit, onStart, onComplete, onDelete }) => {
    const [activeTab, setActiveTab] = useState('details');

    const steps = ['Planned', 'In Progress', 'Completed'];
    const activeStep = activity.status === 'upcoming' ? 0 : 
                      activity.status === 'in_progress' ? 1 : 2;
                      
    const priorityColors = {
        low: 'default',
        medium: 'primary',
        high: 'warning',
        critical: 'error'
    };

    return (
        <>
            <DialogTitle>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                    <Typography variant="h6">
                        {activity.title}
                    </Typography>
                    <Box>
                        <IconButton onClick={onEdit} size="small">
                            <Edit />
                        </IconButton>
                        <IconButton onClick={() => onDelete(activity._id)} size="small" color="error">
                            <Delete />
                        </IconButton>
                    </Box>
                </Box>
            </DialogTitle>
            <DialogContent>
                <Box sx={{ mb: 3 }}>
                    <Stepper activeStep={activeStep} alternativeLabel>
                        {steps.map((label) => (
                            <Step key={label}>
                                <StepLabel>{label}</StepLabel>
                            </Step>
                        ))}
                    </Stepper>
                </Box>

                <Tabs value={activeTab} onChange={(e, newValue) => setActiveTab(newValue)} sx={{ mb: 2 }}>
                    <Tab label="Details" value="details" />
                    <Tab label="Resources" value="resources" />
                    <Tab label="Comments" value="comments" />
                    <Tab label="Attachments" value="attachments" />
                </Tabs>

                {activeTab === 'details' && (
                    <Grid container spacing={2}>
                        <Grid item xs={12} md={6}>
                            <Typography variant="subtitle2" color="textSecondary">
                                Description
                            </Typography>
                            <Typography paragraph>
                                {activity.description || 'No description provided'}
                            </Typography>

                            <Typography variant="subtitle2" color="textSecondary">
                                Status
                            </Typography>
                            <Box sx={{ display: 'flex', gap: 1, mb: 2 }}>
                                <Chip label={activity.status} color="primary" />
                                <Chip label={activity.priority} color={priorityColors[activity.priority]} />
                            </Box>
                        </Grid>

                        <Grid item xs={12} md={6}>
                            <Typography variant="subtitle2" color="textSecondary">
                                Schedule
                            </Typography>
                            <List dense>
                                <ListItem>
                                    <ListItemText 
                                        primary="Planned Date"
                                        secondary={format(new Date(activity.plannedDate), 'PPP')}
                                    />
                                </ListItem>
                                {activity.actualDate && (
                                    <ListItem>
                                        <ListItemText 
                                            primary="Actual Date"
                                            secondary={format(new Date(activity.actualDate), 'PPP')}
                                        />
                                    </ListItem>
                                )}
                                {activity.cropName && (
                                    <ListItem>
                                        <ListItemText 
                                            primary="Crop"
                                            secondary={activity.cropName}
                                        />
                                    </ListItem>
                                )}
                                {activity.fieldName && (
                                    <ListItem>
                                        <ListItemText 
                                            primary="Field"
                                            secondary={activity.fieldName}
                                        />
                                    </ListItem>
                                )}
                            </List>
                        </Grid>
                    </Grid>
                )}

                {activeTab === 'resources' && (
                    <Box>
                        {activity.resources && activity.resources.length > 0 ? (
                            <List>
                                {activity.resources.map((resource, index) => (
                                    <ListItem key={index}>
                                        <ListItemText 
                                            primary={resource.name}
                                            secondary={`${resource.quantity} ${resource.unit} - â‚¹${resource.cost}`}
                                        />
                                    </ListItem>
                                ))}
                            </List>
                        ) : (
                            <Typography color="textSecondary">
                                No resources assigned
                            </Typography>
                        )}
                    </Box>
                )}

                {activeTab === 'comments' && (
                    <Box>
                        {activity.comments && activity.comments.length > 0 ? (
                            <List>
                                {activity.comments.map((comment, index) => (
                                    <ListItem key={index}>
                                        <ListItemIcon>
                                            <Avatar sx={{ width: 32, height: 32 }}>
                                                {comment.userName?.[0]}
                                            </Avatar>
                                        </ListItemIcon>
                                        <ListItemText 
                                            primary={comment.userName}
                                            secondary={
                                                <>
                                                    <Typography variant="body2">
                                                        {comment.text}
                                                    </Typography>
                                                    <Typography variant="caption" color="textSecondary">
                                                        {format(new Date(comment.createdAt), 'PPp')}
                                                    </Typography>
                                                </>
                                            }
                                        />
                                    </ListItem>
                                ))}
                            </List>
                        ) : (
                            <Typography color="textSecondary">
                                No comments yet
                            </Typography>
                        )}
                    </Box>
                )}

                {activeTab === 'attachments' && (
                    <Box>
                        {activity.attachments && activity.attachments.length > 0 ? (
                            <Grid container spacing={2}>
                                {activity.attachments.map((attachment, index) => (
                                    <Grid item xs={6} sm={4} key={index}>
                                        <Card variant="outlined">
                                            <CardContent>
                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                                    {attachment.type === 'photo' ? (
                                                        <Photo />
                                                    ) : (
                                                        <AttachFile />
                                                    )}
                                                    <Typography variant="body2">
                                                        {attachment.filename}
                                                    </Typography>
                                                </Box>
                                            </CardContent>
                                        </Card>
                                    </Grid>
                                ))}
                            </Grid>
                        ) : (
                            <Typography color="textSecondary">
                                No attachments
                            </Typography>
                        )}
                    </Box>
                )}
            </DialogContent>
            <DialogActions>
                {activity.status === 'upcoming' && (
                    <Button 
                        variant="contained" 
                        startIcon={<PlayArrow />}
                        onClick={() => {
                            onStart(activity._id);
                            onClose();
                        }}
                    >
                        Start Activity
                    </Button>
                )}
                {activity.status === 'in_progress' && (
                    <Button 
                        variant="contained" 
                        color="success"
                        startIcon={<CheckCircle />}
                        onClick={() => {
                            onComplete(activity._id);
                            onClose();
                        }}
                    >
                        Mark as Complete
                    </Button>
                )}
                <Button onClick={onClose}>Close</Button>
            </DialogActions>
        </>
    );
};

export default ActivityTimeline;
-e 
===== FILE: ./src/components/ActivityForm.js =====

import React, { useState, useEffect } from 'react';
import {
    Box,
    TextField,
    Select,
    MenuItem,
    FormControl,
    InputLabel,
    Grid,
    Button,
    Chip,
    Autocomplete,
    Typography,
    IconButton,
    Paper,
    Divider
} from '@mui/material';
import { Add, Delete } from '@mui/icons-material';
import { DatePicker } from '@mui/x-date-pickers/DatePicker';
import { TimePicker } from '@mui/x-date-pickers/TimePicker';
import { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';
import { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns';
import { timelineService, cropService, workerService } from '../services/api';

const ACTIVITY_TYPES = [
    { value: 'sowing', label: 'ðŸŒ± Sowing/Transplanting' },
    { value: 'irrigation', label: 'ðŸ’§ Irrigation' },
    { value: 'fertilizer', label: 'ðŸŒ¿ Fertilizer Application' },
    { value: 'pesticide', label: 'ðŸ§ª Pesticide/Herbicide' },
    { value: 'field_preparation', label: 'ðŸšœ Field Preparation' },
    { value: 'harvesting', label: 'ðŸŒ¾ Harvesting' },
    { value: 'weeding', label: 'ðŸ§¹ Weeding' },
    { value: 'maintenance', label: 'ðŸ›  Equipment Maintenance' },
    { value: 'labor', label: 'ðŸ‘· Labor Work' },
    { value: 'payment', label: 'ðŸ’° Payments/Wages' },
    { value: 'issue', label: 'âš ï¸ Issue/Incident' }
];

const ActivityForm = ({ activity, onSuccess, onCancel }) => {
    const [formData, setFormData] = useState({
        title: '',
        type: '',
        description: '',
        plannedDate: new Date(),
        plannedStartTime: '08:00',
        plannedEndTime: '17:00',
        duration: 8,
        status: 'upcoming',
        priority: 'medium',
        crop: '',
        field: '',
        area: '',
        assignedTo: [],
        resources: [],
        costEstimate: 0,
        attachments: [],
        tags: []
    });

    const [crops, setCrops] = useState([]);
    const [workers, setWorkers] = useState([]);
    const [selectedWorkers, setSelectedWorkers] = useState([]);
    const [resourceForm, setResourceForm] = useState({ name: '', quantity: '', unit: 'kg', cost: '' });

    useEffect(() => {
        if (activity) {
            setFormData(activity);
            if (activity.assignedTo) {
                setSelectedWorkers(activity.assignedTo);
            }
        }
        fetchCrops();
        fetchWorkers();
    }, [activity]);

    const fetchCrops = async () => {
        try {
            const response = await cropService.getCrops();
            // Handle if response is array or object with data
            setCrops(Array.isArray(response) ? response : response.data || []);
        } catch (error) {
            console.error('Error fetching crops:', error);
        }
    };

    const fetchWorkers = async () => {
        try {
            const response = await workerService.getWorkers();
            setWorkers(Array.isArray(response) ? response : response.data || []);
        } catch (error) {
            console.error('Error fetching workers:', error);
        }
    };

    const handleChange = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
    };

    const handleAddResource = () => {
        if (resourceForm.name && resourceForm.quantity) {
            const newResource = {
                ...resourceForm,
                quantity: parseFloat(resourceForm.quantity),
                cost: parseFloat(resourceForm.cost) || 0
            };
            
            setFormData(prev => ({
                ...prev,
                resources: [...prev.resources, newResource]
            }));
            
            setResourceForm({ name: '', quantity: '', unit: 'kg', cost: '' });
        }
    };

    const handleRemoveResource = (index) => {
        setFormData(prev => ({
            ...prev,
            resources: prev.resources.filter((_, i) => i !== index)
        }));
    };

    const handleAddWorker = (worker) => {
        if (worker && !selectedWorkers.find(w => w._id === worker._id)) {
            setSelectedWorkers(prev => [...prev, worker]);
            setFormData(prev => ({
                ...prev,
                assignedTo: [...prev.assignedTo, {
                    worker: worker._id,
                    workerName: worker.name,
                    role: 'worker',
                    hoursWorked: 0,
                    wage: 0
                }]
            }));
        }
    };

    const handleRemoveWorker = (workerId) => {
        setSelectedWorkers(prev => prev.filter(w => w._id !== workerId));
        setFormData(prev => ({
            ...prev,
            assignedTo: prev.assignedTo.filter(a => a.worker !== workerId)
        }));
    };

    const handleSubmit = async () => {
        try {
            if (activity) {
                await timelineService.updateActivity(activity._id, formData);
            } else {
                await timelineService.createActivity(formData);
            }
            onSuccess();
        } catch (error) {
            console.error('Error saving activity:', error);
        }
    };

    const totalCost = formData.resources.reduce((sum, r) => sum + (r.cost || 0), 0);

    return (
        <LocalizationProvider dateAdapter={AdapterDateFns}>
            <Box sx={{ mt: 2 }}>
                <Grid container spacing={3}>
                    {/* Basic Information */}
                    <Grid item xs={12}>
                        <Typography variant="h6" gutterBottom>
                            Basic Information
                        </Typography>
                    </Grid>
                    
                    <Grid item xs={12} md={6}>
                        <TextField
                            fullWidth
                            label="Activity Title"
                            value={formData.title}
                            onChange={(e) => handleChange('title', e.target.value)}
                            required
                        />
                    </Grid>
                    
                    <Grid item xs={12} md={6}>
                        <FormControl fullWidth required>
                            <InputLabel>Activity Type</InputLabel>
                            <Select
                                value={formData.type}
                                label="Activity Type"
                                onChange={(e) => handleChange('type', e.target.value)}
                            >
                                {ACTIVITY_TYPES.map(type => (
                                    <MenuItem key={type.value} value={type.value}>
                                        {type.label}
                                    </MenuItem>
                                ))}
                            </Select>
                        </FormControl>
                    </Grid>
                    
                    <Grid item xs={12}>
                        <TextField
                            fullWidth
                            label="Description"
                            multiline
                            rows={3}
                            value={formData.description}
                            onChange={(e) => handleChange('description', e.target.value)}
                        />
                    </Grid>

                    {/* Schedule */}
                    <Grid item xs={12}>
                        <Typography variant="h6" gutterBottom>
                            Schedule
                        </Typography>
                    </Grid>
                    
                    <Grid item xs={12} md={4}>
                        <DatePicker
                            label="Planned Date"
                            value={formData.plannedDate}
                            onChange={(date) => handleChange('plannedDate', date)}
                            renderInput={(params) => <TextField {...params} fullWidth required />}
                        />
                    </Grid>
                    
                    <Grid item xs={12} md={4}>
                        <TextField
                            fullWidth
                            label="Start Time"
                            type="time"
                            value={formData.plannedStartTime}
                            onChange={(e) => handleChange('plannedStartTime', e.target.value)}
                            InputLabelProps={{ shrink: true }}
                        />
                    </Grid>
                    
                    <Grid item xs={12} md={4}>
                        <TextField
                            fullWidth
                            label="Duration (hours)"
                            type="number"
                            value={formData.duration}
                            onChange={(e) => handleChange('duration', e.target.value)}
                        />
                    </Grid>

                    {/* Priority & Status */}
                    <Grid item xs={12} md={6}>
                        <FormControl fullWidth>
                            <InputLabel>Priority</InputLabel>
                            <Select
                                value={formData.priority}
                                label="Priority"
                                onChange={(e) => handleChange('priority', e.target.value)}
                            >
                                <MenuItem value="low">Low</MenuItem>
                                <MenuItem value="medium">Medium</MenuItem>
                                <MenuItem value="high">High</MenuItem>
                                <MenuItem value="critical">Critical</MenuItem>
                            </Select>
                        </FormControl>
                    </Grid>
                    
                    <Grid item xs={12} md={6}>
                        <FormControl fullWidth>
                            <InputLabel>Status</InputLabel>
                            <Select
                                value={formData.status}
                                label="Status"
                                onChange={(e) => handleChange('status', e.target.value)}
                            >
                                <MenuItem value="upcoming">Upcoming</MenuItem>
                                <MenuItem value="in_progress">In Progress</MenuItem>
                                <MenuItem value="completed">Completed</MenuItem>
                            </Select>
                        </FormControl>
                    </Grid>

                    {/* Crop Association */}
                    <Grid item xs={12}>
                        <Typography variant="h6" gutterBottom>
                            Crop & Field Association
                        </Typography>
                    </Grid>
                    
                    <Grid item xs={12} md={6}>
                        <FormControl fullWidth>
                            <InputLabel>Select Crop</InputLabel>
                            <Select
                                value={formData.crop}
                                label="Select Crop"
                                onChange={(e) => handleChange('crop', e.target.value)}
                            >
                                <MenuItem value="">None</MenuItem>
                                {crops.map(crop => (
                                    <MenuItem key={crop._id} value={crop._id}>
                                        {crop.name} ({crop.variety}) - {crop.area} acres
                                    </MenuItem>
                                ))}
                            </Select>
                        </FormControl>
                    </Grid>
                    
                    <Grid item xs={12} md={6}>
                        <TextField
                            fullWidth
                            label="Field/Plot Name"
                            value={formData.field}
                            onChange={(e) => handleChange('field', e.target.value)}
                        />
                    </Grid>

                    {/* Worker Assignment */}
                    <Grid item xs={12}>
                        <Typography variant="h6" gutterBottom>
                            Worker Assignment
                        </Typography>
                        <Autocomplete
                            options={workers}
                            getOptionLabel={(worker) => worker.name}
                            renderInput={(params) => (
                                <TextField {...params} label="Assign Workers" />
                            )}
                            onChange={(event, worker) => worker && handleAddWorker(worker)}
                        />
                        <Box sx={{ mt: 2, display: 'flex', flexWrap: 'wrap', gap: 1 }}>
                            {selectedWorkers.map(worker => (
                                <Chip
                                    key={worker._id}
                                    label={worker.name}
                                    onDelete={() => handleRemoveWorker(worker._id)}
                                />
                            ))}
                        </Box>
                    </Grid>

                    {/* Resource Management */}
                    <Grid item xs={12}>
                        <Typography variant="h6" gutterBottom>
                            Resource Management
                        </Typography>
                        <Paper variant="outlined" sx={{ p: 2, mb: 2 }}>
                            <Grid container spacing={2} alignItems="center">
                                <Grid item xs={12} md={3}>
                                    <TextField
                                        fullWidth
                                        label="Resource Name"
                                        value={resourceForm.name}
                                        onChange={(e) => setResourceForm(prev => ({ ...prev, name: e.target.value }))}
                                        size="small"
                                    />
                                </Grid>
                                <Grid item xs={12} md={2}>
                                    <TextField
                                        fullWidth
                                        label="Quantity"
                                        type="number"
                                        value={resourceForm.quantity}
                                        onChange={(e) => setResourceForm(prev => ({ ...prev, quantity: e.target.value }))}
                                        size="small"
                                    />
                                </Grid>
                                <Grid item xs={12} md={2}>
                                    <TextField
                                        fullWidth
                                        label="Unit"
                                        value={resourceForm.unit}
                                        onChange={(e) => setResourceForm(prev => ({ ...prev, unit: e.target.value }))}
                                        size="small"
                                    />
                                </Grid>
                                <Grid item xs={12} md={3}>
                                    <TextField
                                        fullWidth
                                        label="Cost (â‚¹)"
                                        type="number"
                                        value={resourceForm.cost}
                                        onChange={(e) => setResourceForm(prev => ({ ...prev, cost: e.target.value }))}
                                        size="small"
                                    />
                                </Grid>
                                <Grid item xs={12} md={2}>
                                    <Button
                                        fullWidth
                                        variant="outlined"
                                        startIcon={<Add />}
                                        onClick={handleAddResource}
                                    >
                                        Add
                                    </Button>
                                </Grid>
                            </Grid>
                        </Paper>

                        {formData.resources.length > 0 && (
                            <Box>
                                <Typography variant="subtitle2" gutterBottom>
                                    Added Resources (Total: â‚¹{totalCost})
                                </Typography>
                                <Grid container spacing={1}>
                                    {formData.resources.map((resource, index) => (
                                        <Grid item xs={12} sm={6} md={4} key={index}>
                                            <Paper variant="outlined" sx={{ p: 1.5 }}>
                                                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                    <Box>
                                                        <Typography variant="body2" fontWeight="bold">
                                                            {resource.name}
                                                        </Typography>
                                                        <Typography variant="caption" color="textSecondary">
                                                            {resource.quantity} {resource.unit} â€¢ â‚¹{resource.cost}
                                                        </Typography>
                                                    </Box>
                                                    <IconButton 
                                                        size="small" 
                                                        onClick={() => handleRemoveResource(index)}
                                                        color="error"
                                                    >
                                                        <Delete fontSize="small" />
                                                    </IconButton>
                                                </Box>
                                            </Paper>
                                        </Grid>
                                    ))}
                                </Grid>
                            </Box>
                        )}
                    </Grid>

                    {/* Cost Estimation */}
                    <Grid item xs={12}>
                        <Typography variant="h6" gutterBottom>
                            Cost Estimation
                        </Typography>
                        <TextField
                            fullWidth
                            label="Estimated Cost (â‚¹)"
                            type="number"
                            value={formData.costEstimate}
                            onChange={(e) => handleChange('costEstimate', parseFloat(e.target.value))}
                        />
                    </Grid>

                    {/* Actions */}
                    <Grid item xs={12}>
                        <Divider sx={{ my: 2 }} />
                        <Box sx={{ display: 'flex', justifyContent: 'flex-end', gap: 2 }}>
                            <Button onClick={onCancel}>
                                Cancel
                            </Button>
                            <Button 
                                variant="contained" 
                                onClick={handleSubmit}
                                disabled={!formData.title || !formData.type}
                            >
                                {activity ? 'Update Activity' : 'Create Activity'}
                            </Button>
                        </Box>
                    </Grid>
                </Grid>
            </Box>
        </LocalizationProvider>
    );
};

export default ActivityForm;
-e 
===== FILE: ./src/components/ResourceForm.js =====

import React, { useState, useEffect } from 'react';
import {
    Box,
    TextField,
    Select,
    MenuItem,
    FormControl,
    InputLabel,
    Grid,
    Button,
    Chip,
    Typography,
    FormControlLabel,
    Checkbox,
    Alert,
    Stepper,
    Step,
    StepLabel
} from '@mui/material';
import { DatePicker } from '@mui/x-date-pickers/DatePicker';
import { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';
import { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns';
import { resourcesService } from '../services/api';

const ResourceForm = ({ resource, onSuccess, onCancel }) => {
    const [activeStep, setActiveStep] = useState(0);
    const [formData, setFormData] = useState({
        name: '',
        category: 'seeds',
        description: '',
        brand: '',
        specification: '',
        unit: 'kg',
        totalQuantity: 0,
        minimumThreshold: 0,
        location: 'store_room',
        costPerUnit: 0,
        purchaseDate: new Date(),
        expiryDate: null,
        isEquipment: false,
        equipmentType: '',
        warrantyPeriod: 0,
        safetyInstructions: [],
        isHazardous: false
    });

    const steps = ['Basic Info', 'Inventory', 'Cost & Safety', 'Review'];

    const categories = [
        { value: 'seeds', label: 'ðŸŒ± Seeds' },
        { value: 'fertilizers', label: 'ðŸ§ª Fertilizers' },
        { value: 'pesticides', label: 'ðŸ› Pesticides' },
        { value: 'herbicides', label: 'ðŸŒ¿ Herbicides' },
        { value: 'equipment', label: 'ðŸšœ Equipment' },
        { value: 'machinery', label: 'âš™ï¸ Machinery' },
        { value: 'water', label: 'ðŸ’§ Water' },
        { value: 'fuel', label: 'â›½ Fuel' },
        { value: 'electricity', label: 'âš¡ Electricity' },
        { value: 'storage', label: 'ðŸ“¦ Storage' },
        { value: 'tools', label: 'ðŸ”§ Tools' },
        { value: 'other', label: 'ðŸ“¦ Other' }
    ];

    const units = ['kg', 'g', 'liters', 'ml', 'bags', 'packets', 'units', 'pieces', 'boxes', 'hours'];

    useEffect(() => {
        if (resource) {
            setFormData({
                name: resource.name || '',
                category: resource.category || 'seeds',
                description: resource.description || '',
                brand: resource.brand || '',
                specification: resource.specification || '',
                unit: resource.unit || 'kg',
                totalQuantity: resource.totalQuantity || 0,
                minimumThreshold: resource.minimumThreshold || 0,
                location: resource.location || 'store_room',
                costPerUnit: resource.costPerUnit || 0,
                purchaseDate: resource.purchaseDate ? new Date(resource.purchaseDate) : new Date(),
                expiryDate: resource.expiryDate ? new Date(resource.expiryDate) : null,
                isEquipment: resource.isEquipment || false,
                equipmentType: resource.equipmentType || '',
                warrantyPeriod: resource.warrantyPeriod || 0,
                safetyInstructions: resource.safetyInstructions || [],
                isHazardous: resource.isHazardous || false
            });
        }
    }, [resource]);

    const handleChange = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
    };

    const handleSubmit = async () => {
        try {
            if (resource) {
                await resourcesService.updateResource(resource._id, formData);
            } else {
                await resourcesService.createResource(formData);
            }
            onSuccess();
        } catch (error) {
            console.error('Error saving resource:', error);
        }
    };

    const renderStepContent = (step) => {
        switch (step) {
            case 0:
                return (
                    <Grid container spacing={3}>
                        <Grid item xs={12}>
                            <TextField
                                fullWidth
                                label="Resource Name"
                                value={formData.name}
                                onChange={(e) => handleChange('name', e.target.value)}
                                required
                            />
                        </Grid>
                        
                        <Grid item xs={12} md={6}>
                            <FormControl fullWidth required>
                                <InputLabel>Category</InputLabel>
                                <Select
                                    value={formData.category}
                                    label="Category"
                                    onChange={(e) => handleChange('category', e.target.value)}
                                >
                                    {categories.map(cat => (
                                        <MenuItem key={cat.value} value={cat.value}>
                                            {cat.label}
                                        </MenuItem>
                                    ))}
                                </Select>
                            </FormControl>
                        </Grid>
                        
                        <Grid item xs={12} md={6}>
                            <TextField
                                fullWidth
                                label="Brand"
                                value={formData.brand}
                                onChange={(e) => handleChange('brand', e.target.value)}
                            />
                        </Grid>
                        
                        <Grid item xs={12}>
                            <TextField
                                fullWidth
                                label="Description"
                                multiline
                                rows={3}
                                value={formData.description}
                                onChange={(e) => handleChange('description', e.target.value)}
                            />
                        </Grid>
                        
                        <Grid item xs={12}>
                            <TextField
                                fullWidth
                                label="Specification"
                                value={formData.specification}
                                onChange={(e) => handleChange('specification', e.target.value)}
                                placeholder="e.g., Grade, Composition, Model Number"
                            />
                        </Grid>
                    </Grid>
                );
                
            case 1:
                return (
                    <Grid container spacing={3}>
                        <Grid item xs={12} md={6}>
                            <FormControl fullWidth required>
                                <InputLabel>Unit</InputLabel>
                                <Select
                                    value={formData.unit}
                                    label="Unit"
                                    onChange={(e) => handleChange('unit', e.target.value)}
                                >
                                    {units.map(unit => (
                                        <MenuItem key={unit} value={unit}>
                                            {unit}
                                        </MenuItem>
                                    ))}
                                </Select>
                            </FormControl>
                        </Grid>
                        
                        <Grid item xs={12} md={6}>
                            <TextField
                                fullWidth
                                label="Total Quantity"
                                type="number"
                                value={formData.totalQuantity}
                                onChange={(e) => handleChange('totalQuantity', parseFloat(e.target.value))}
                                InputProps={{ inputProps: { min: 0, step: 0.01 } }}
                                required
                            />
                        </Grid>
                        
                        <Grid item xs={12} md={6}>
                            <TextField
                                fullWidth
                                label="Minimum Threshold"
                                type="number"
                                value={formData.minimumThreshold}
                                onChange={(e) => handleChange('minimumThreshold', parseFloat(e.target.value))}
                                InputProps={{ inputProps: { min: 0, step: 0.01 } }}
                                helperText="Alert when stock goes below this"
                            />
                        </Grid>
                        
                        <Grid item xs={12} md={6}>
                            <FormControl fullWidth>
                                <InputLabel>Location</InputLabel>
                                <Select
                                    value={formData.location}
                                    label="Location"
                                    onChange={(e) => handleChange('location', e.target.value)}
                                >
                                    <MenuItem value="store_room">Store Room</MenuItem>
                                    <MenuItem value="field">Field</MenuItem>
                                    <MenuItem value="godown">Godown</MenuItem>
                                    <MenuItem value="cold_storage">Cold Storage</MenuItem>
                                    <MenuItem value="pump_house">Pump House</MenuItem>
                                    <MenuItem value="shed">Shed</MenuItem>
                                    <MenuItem value="other">Other</MenuItem>
                                </Select>
                            </FormControl>
                        </Grid>
                        
                        <Grid item xs={12}>
                            <FormControlLabel
                                control={
                                    <Checkbox
                                        checked={formData.isEquipment}
                                        onChange={(e) => handleChange('isEquipment', e.target.checked)}
                                    />
                                }
                                label="This is equipment/machinery"
                            />
                        </Grid>
                        
                        {formData.isEquipment && (
                            <Grid item xs={12}>
                                <TextField
                                    fullWidth
                                    label="Equipment Type"
                                    value={formData.equipmentType}
                                    onChange={(e) => handleChange('equipmentType', e.target.value)}
                                    placeholder="e.g., Tractor, Sprayer, Pump"
                                />
                            </Grid>
                        )}
                    </Grid>
                );
                
            case 2:
                return (
                    <Grid container spacing={3}>
                        <Grid item xs={12} md={6}>
                            <TextField
                                fullWidth
                                label="Cost per Unit (â‚¹)"
                                type="number"
                                value={formData.costPerUnit}
                                onChange={(e) => handleChange('costPerUnit', parseFloat(e.target.value))}
                                InputProps={{ inputProps: { min: 0, step: 0.01 } }}
                            />
                        </Grid>
                        
                        <Grid item xs={12} md={6}>
                            <LocalizationProvider dateAdapter={AdapterDateFns}>
                                <DatePicker
                                    label="Purchase Date"
                                    value={formData.purchaseDate}
                                    onChange={(date) => handleChange('purchaseDate', date)}
                                    renderInput={(params) => <TextField {...params} fullWidth />}
                                />
                            </LocalizationProvider>
                        </Grid>
                        
                        <Grid item xs={12} md={6}>
                            <LocalizationProvider dateAdapter={AdapterDateFns}>
                                <DatePicker
                                    label="Expiry Date"
                                    value={formData.expiryDate}
                                    onChange={(date) => handleChange('expiryDate', date)}
                                    renderInput={(params) => <TextField {...params} fullWidth />}
                                />
                            </LocalizationProvider>
                        </Grid>
                        
                        <Grid item xs={12} md={6}>
                            <TextField
                                fullWidth
                                label="Warranty Period (months)"
                                type="number"
                                value={formData.warrantyPeriod}
                                onChange={(e) => handleChange('warrantyPeriod', parseInt(e.target.value))}
                                InputProps={{ inputProps: { min: 0 } }}
                            />
                        </Grid>
                        
                        <Grid item xs={12}>
                            <FormControlLabel
                                control={
                                    <Checkbox
                                        checked={formData.isHazardous}
                                        onChange={(e) => handleChange('isHazardous', e.target.checked)}
                                    />
                                }
                                label="This is a hazardous material"
                            />
                        </Grid>
                        
                        {formData.isHazardous && (
                            <Grid item xs={12}>
                                <Alert severity="warning">
                                    Please ensure proper storage and handling of hazardous materials
                                </Alert>
                            </Grid>
                        )}
                    </Grid>
                );
                
            case 3:
                const totalCost = formData.costPerUnit * formData.totalQuantity;
                
                return (
                    <Box>
                        <Typography variant="h6" gutterBottom>
                            Review Resource Details
                        </Typography>
                        
                        <Grid container spacing={2}>
                            <Grid item xs={12} md={6}>
                                <Typography variant="subtitle2" color="textSecondary">
                                    Basic Information
                                </Typography>
                                <Typography>{formData.name}</Typography>
                                <Typography color="textSecondary">
                                    {formData.category} â€¢ {formData.brand}
                                </Typography>
                            </Grid>
                            
                            <Grid item xs={12} md={6}>
                                <Typography variant="subtitle2" color="textSecondary">
                                    Inventory
                                </Typography>
                                <Typography>
                                    {formData.totalQuantity} {formData.unit}
                                </Typography>
                                <Typography color="textSecondary">
                                    Min threshold: {formData.minimumThreshold} {formData.unit}
                                </Typography>
                            </Grid>
                            
                            <Grid item xs={12} md={6}>
                                <Typography variant="subtitle2" color="textSecondary">
                                    Cost
                                </Typography>
                                <Typography>
                                    â‚¹{formData.costPerUnit} per {formData.unit}
                                </Typography>
                                <Typography color="textSecondary">
                                    Total value: â‚¹{totalCost.toLocaleString()}
                                </Typography>
                            </Grid>
                            
                            <Grid item xs={12} md={6}>
                                <Typography variant="subtitle2" color="textSecondary">
                                    Safety
                                </Typography>
                                <Typography color={formData.isHazardous ? 'warning.main' : 'textSecondary'}>
                                    {formData.isHazardous ? 'Hazardous Material' : 'Safe'}
                                </Typography>
                                {formData.expiryDate && (
                                    <Typography color="textSecondary">
                                        Expires: {new Date(formData.expiryDate).toLocaleDateString()}
                                    </Typography>
                                )}
                            </Grid>
                        </Grid>
                        
                        {formData.description && (
                            <Box sx={{ mt: 2 }}>
                                <Typography variant="subtitle2" color="textSecondary">
                                    Description
                                </Typography>
                                <Typography>{formData.description}</Typography>
                            </Box>
                        )}
                    </Box>
                );
                
            default:
                return null;
        }
    };

    return (
        <LocalizationProvider dateAdapter={AdapterDateFns}>
            <Box sx={{ mt: 2 }}>
                <Stepper activeStep={activeStep} sx={{ mb: 3 }}>
                    {steps.map((label) => (
                        <Step key={label}>
                            <StepLabel>{label}</StepLabel>
                        </Step>
                    ))}
                </Stepper>
                
                {renderStepContent(activeStep)}
                
                <Box sx={{ display: 'flex', justifyContent: 'space-between', mt: 3 }}>
                    <Button
                        disabled={activeStep === 0}
                        onClick={() => setActiveStep(activeStep - 1)}
                    >
                        Back
                    </Button>
                    
                    <Box>
                        {activeStep < steps.length - 1 ? (
                            <Button
                                variant="contained"
                                onClick={() => setActiveStep(activeStep + 1)}
                                disabled={!formData.name || !formData.category}
                            >
                                Next
                            </Button>
                        ) : (
                            <Button
                                variant="contained"
                                onClick={handleSubmit}
                                disabled={!formData.name || !formData.category}
                            >
                                {resource ? 'Update Resource' : 'Create Resource'}
                            </Button>
                        )}
                    </Box>
                </Box>
            </Box>
        </LocalizationProvider>
    );
};

export default ResourceForm;
-e 
===== FILE: ./src/components/ResourceDetails.js =====

import React, { useState } from 'react';
import {
    Dialog,
    DialogTitle,
    DialogContent,
    DialogActions,
    Button,
    Typography,
    Box,
    Grid,
    Chip,
    Divider,
    Tabs,
    Tab,
    Table,
    TableBody,
    TableCell,
    TableContainer,
    TableHead,
    TableRow,
    Alert,
    IconButton
} from '@mui/material';
import {
    Edit,
    Warning,
    CheckCircle,
    Error
} from '@mui/icons-material';
import { format } from 'date-fns';
import { resourcesService } from '../services/api';

const ResourceDetails = ({ open, resource, onClose, onEdit }) => {
    const [activeTab, setActiveTab] = useState('overview');

    if (!resource) return null;

    const getStockStatus = () => {
        if (resource.availableQuantity <= 0) return { status: 'out_of_stock', color: 'error', icon: <Error /> };
        if (resource.availableQuantity <= resource.minimumThreshold) return { status: 'low_stock', color: 'warning', icon: <Warning /> };
        return { status: 'in_stock', color: 'success', icon: <CheckCircle /> };
    };

    const stockStatus = getStockStatus();

    const tabs = [
        { label: 'Overview', value: 'overview' },
        { label: 'Usage History', value: 'usage' },
        { label: 'Alerts', value: 'alerts' },
        { label: 'Linked Crops', value: 'crops' }
    ];

    const renderOverview = () => (
        <Grid container spacing={3}>
            <Grid item xs={12}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                    <Typography variant="h6">
                        {resource.name}
                    </Typography>
                    <Chip 
                        label={stockStatus.status.replace('_', ' ').toUpperCase()} 
                        color={stockStatus.color}
                        icon={stockStatus.icon}
                    />
                </Box>
                {resource.brand && (
                    <Typography color="textSecondary">
                        Brand: {resource.brand}
                    </Typography>
                )}
            </Grid>

            <Grid item xs={12}>
                <Divider />
            </Grid>

            <Grid item xs={12} md={6}>
                <Typography variant="subtitle2" color="textSecondary" gutterBottom>
                    Inventory Details
                </Typography>
                <Grid container spacing={2}>
                    <Grid item xs={6}>
                        <Typography variant="caption">Available</Typography>
                        <Typography variant="h6">
                            {resource.availableQuantity} {resource.unit}
                        </Typography>
                    </Grid>
                    <Grid item xs={6}>
                        <Typography variant="caption">Total</Typography>
                        <Typography>
                            {resource.totalQuantity} {resource.unit}
                        </Typography>
                    </Grid>
                    <Grid item xs={6}>
                        <Typography variant="caption">Used</Typography>
                        <Typography>
                            {resource.usedQuantity} {resource.unit}
                        </Typography>
                    </Grid>
                    <Grid item xs={6}>
                        <Typography variant="caption">Min Threshold</Typography>
                        <Typography>
                            {resource.minimumThreshold} {resource.unit}
                        </Typography>
                    </Grid>
                </Grid>
            </Grid>

            <Grid item xs={12} md={6}>
                <Typography variant="subtitle2" color="textSecondary" gutterBottom>
                    Cost & Location
                </Typography>
                <Grid container spacing={2}>
                    <Grid item xs={6}>
                        <Typography variant="caption">Cost per Unit</Typography>
                        <Typography>
                            â‚¹{resource.costPerUnit || 0}
                        </Typography>
                    </Grid>
                    <Grid item xs={6}>
                        <Typography variant="caption">Total Value</Typography>
                        <Typography variant="h6" color="primary">
                            â‚¹{(resource.totalCost || 0).toLocaleString()}
                        </Typography>
                    </Grid>
                    <Grid item xs={6}>
                        <Typography variant="caption">Location</Typography>
                        <Typography>
                            {resource.location.replace('_', ' ')}
                        </Typography>
                    </Grid>
                    {resource.expiryDate && (
                        <Grid item xs={6}>
                            <Typography variant="caption">Expiry Date</Typography>
                            <Typography color={new Date(resource.expiryDate) < new Date() ? 'error' : 'textPrimary'}>
                                {format(new Date(resource.expiryDate), 'dd MMM yyyy')}
                            </Typography>
                        </Grid>
                    )}
                </Grid>
            </Grid>

            {resource.description && (
                <Grid item xs={12}>
                    <Typography variant="subtitle2" color="textSecondary" gutterBottom>
                        Description
                    </Typography>
                    <Typography>{resource.description}</Typography>
                </Grid>
            )}

            {resource.isEquipment && (
                <Grid item xs={12}>
                    <Alert severity="info">
                        <Typography variant="subtitle2">Equipment Details</Typography>
                        <Typography variant="body2">
                            Status: {resource.equipmentStatus}
                            {resource.nextMaintenanceDate && (
                                <> â€¢ Next Maintenance: {format(new Date(resource.nextMaintenanceDate), 'dd MMM yyyy')}</>
                            )}
                        </Typography>
                    </Alert>
                </Grid>
            )}
        </Grid>
    );

    const renderUsageHistory = () => (
        <Box>
            {resource.usageHistory && resource.usageHistory.length > 0 ? (
                <TableContainer>
                    <Table size="small">
                        <TableHead>
                            <TableRow>
                                <TableCell>Date</TableCell>
                                <TableCell>Activity</TableCell>
                                <TableCell>Quantity</TableCell>
                                <TableCell>Crop</TableCell>
                                <TableCell>Worker</TableCell>
                            </TableRow>
                        </TableHead>
                        <TableBody>
                            {resource.usageHistory.slice(0, 10).map((usage, index) => (
                                <TableRow key={index}>
                                    <TableCell>
                                        {format(new Date(usage.date), 'dd MMM yy')}
                                    </TableCell>
                                    <TableCell>
                                        {usage.activityTitle || 'Manual Entry'}
                                    </TableCell>
                                    <TableCell>
                                        {usage.quantity} {resource.unit}
                                    </TableCell>
                                    <TableCell>
                                        {usage.cropName || '-'}
                                    </TableCell>
                                    <TableCell>
                                        {usage.workerName || '-'}
                                    </TableCell>
                                </TableRow>
                            ))}
                        </TableBody>
                    </Table>
                </TableContainer>
            ) : (
                <Typography color="textSecondary" align="center">
                    No usage history recorded
                </Typography>
            )}
        </Box>
    );

    const renderAlerts = () => (
        <Box>
            {resource.alerts && resource.alerts.filter(a => !a.resolved).length > 0 ? (
                resource.alerts
                    .filter(a => !a.resolved)
                    .map((alert, index) => (
                        <Alert 
                            key={index}
                            severity={alert.severity}
                            sx={{ mb: 1 }}
                            action={
                                <Button 
                                    size="small" 
                                    color="inherit"
                                    onClick={() => resourcesService.resolveAlert(resource._id, alert._id)}
                                >
                                    Resolve
                                </Button>
                            }
                        >
                            {alert.message}
                        </Alert>
                    ))
            ) : (
                <Typography color="textSecondary" align="center">
                    No active alerts
                </Typography>
            )}
        </Box>
    );

    const renderCrops = () => (
        <Box>
            {resource.crops && resource.crops.length > 0 ? (
                <Grid container spacing={2}>
                    {resource.crops.map((cropLink, index) => (
                        <Grid item xs={12} sm={6} key={index}>
                            <Box sx={{ p: 2, border: '1px solid', borderColor: 'divider', borderRadius: 1 }}>
                                <Typography variant="subtitle2">
                                    {cropLink.cropName}
                                </Typography>
                                <Typography variant="caption" color="textSecondary">
                                    Usage Rate: {cropLink.usageRate} {resource.unit} per acre
                                </Typography>
                            </Box>
                        </Grid>
                    ))}
                </Grid>
            ) : (
                <Typography color="textSecondary" align="center">
                    Not linked to any crops
                </Typography>
            )}
        </Box>
    );

    return (
        <Dialog open={open} onClose={onClose} maxWidth="md" fullWidth>
            <DialogTitle>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                    Resource Details
                    <IconButton onClick={onEdit} size="small">
                        <Edit />
                    </IconButton>
                </Box>
            </DialogTitle>
            
            <DialogContent>
                <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 2 }}>
                    <Tabs value={activeTab} onChange={(e, newValue) => setActiveTab(newValue)}>
                        {tabs.map(tab => (
                            <Tab key={tab.value} label={tab.label} value={tab.value} />
                        ))}
                    </Tabs>
                </Box>

                {activeTab === 'overview' && renderOverview()}
                {activeTab === 'usage' && renderUsageHistory()}
                {activeTab === 'alerts' && renderAlerts()}
                {activeTab === 'crops' && renderCrops()}
            </DialogContent>
            
            <DialogActions>
                <Button onClick={onClose}>Close</Button>
            </DialogActions>
        </Dialog>
    );
};

export default ResourceDetails;
-e 
===== FILE: ./src/components/ResourceDialogs.js =====

import React, { useState, useEffect } from 'react';
import {
    Dialog,
    DialogTitle,
    DialogContent,
    DialogActions,
    Button,
    TextField,
    Grid,
    FormControl,
    InputLabel,
    Select,
    MenuItem,
    Autocomplete
} from '@mui/material';
import { DatePicker } from '@mui/x-date-pickers/DatePicker';
import { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';
import { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns';
import { resourcesService, cropService, workerService } from '../services/api';

export const UseResourceDialog = ({ open, resource, onClose, onSuccess }) => {
    const [quantity, setQuantity] = useState('');
    const [notes, setNotes] = useState('');
    const [cropId, setCropId] = useState('');
    const [workerId, setWorkerId] = useState('');
    const [crops, setCrops] = useState([]);
    const [workers, setWorkers] = useState([]);

    useEffect(() => {
        if (open) {
            fetchData();
        }
    }, [open]);

    const fetchData = async () => {
        try {
            const cropsData = await cropService.getCrops();
            setCrops(Array.isArray(cropsData) ? cropsData : []);
            
            const workersData = await workerService.getWorkers();
            setWorkers(Array.isArray(workersData) ? workersData : []);
        } catch (error) {
            console.error('Error fetching data:', error);
        }
    };

    const handleSubmit = async () => {
        try {
            await resourcesService.useResource(resource._id, {
                quantity: parseFloat(quantity),
                cropId,
                workerId,
                notes
            });
            onSuccess();
        } catch (error) {
            console.error('Error using resource:', error);
            // Handle error (show toast/alert)
        }
    };

    return (
        <Dialog open={open} onClose={onClose} maxWidth="sm" fullWidth>
            <DialogTitle>Use Resource: {resource?.name}</DialogTitle>
            <DialogContent>
                <Grid container spacing={2} sx={{ mt: 1 }}>
                    <Grid item xs={12}>
                        <TextField
                            fullWidth
                            label={`Quantity (${resource?.unit})`}
                            type="number"
                            value={quantity}
                            onChange={(e) => setQuantity(e.target.value)}
                            helperText={`Available: ${resource?.availableQuantity} ${resource?.unit}`}
                        />
                    </Grid>
                    <Grid item xs={12}>
                        <FormControl fullWidth>
                            <InputLabel>Crop (Optional)</InputLabel>
                            <Select
                                value={cropId}
                                label="Crop (Optional)"
                                onChange={(e) => setCropId(e.target.value)}
                            >
                                <MenuItem value="">None</MenuItem>
                                {crops.map(crop => (
                                    <MenuItem key={crop._id} value={crop._id}>
                                        {crop.name} - {crop.variety}
                                    </MenuItem>
                                ))}
                            </Select>
                        </FormControl>
                    </Grid>
                    <Grid item xs={12}>
                        <FormControl fullWidth>
                            <InputLabel>Worker (Optional)</InputLabel>
                            <Select
                                value={workerId}
                                label="Worker (Optional)"
                                onChange={(e) => setWorkerId(e.target.value)}
                            >
                                <MenuItem value="">None</MenuItem>
                                {workers.map(worker => (
                                    <MenuItem key={worker._id} value={worker._id}>
                                        {worker.name}
                                    </MenuItem>
                                ))}
                            </Select>
                        </FormControl>
                    </Grid>
                    <Grid item xs={12}>
                        <TextField
                            fullWidth
                            label="Notes"
                            multiline
                            rows={3}
                            value={notes}
                            onChange={(e) => setNotes(e.target.value)}
                        />
                    </Grid>
                </Grid>
            </DialogContent>
            <DialogActions>
                <Button onClick={onClose}>Cancel</Button>
                <Button 
                    onClick={handleSubmit} 
                    variant="contained"
                    disabled={!quantity || parseFloat(quantity) <= 0 || parseFloat(quantity) > (resource?.availableQuantity || 0)}
                >
                    Confirm Usage
                </Button>
            </DialogActions>
        </Dialog>
    );
};

export const AddStockDialog = ({ open, resource, onClose, onSuccess }) => {
    const [quantity, setQuantity] = useState('');
    const [costPerUnit, setCostPerUnit] = useState(resource?.costPerUnit || '');
    const [vendorName, setVendorName] = useState(resource?.vendor?.name || '');
    const [purchaseDate, setPurchaseDate] = useState(new Date());

    const handleSubmit = async () => {
        try {
            await resourcesService.addStock(resource._id, {
                quantity: parseFloat(quantity),
                costPerUnit: parseFloat(costPerUnit),
                vendor: { name: vendorName },
                purchaseDate
            });
            onSuccess();
        } catch (error) {
            console.error('Error adding stock:', error);
        }
    };

    return (
        <LocalizationProvider dateAdapter={AdapterDateFns}>
            <Dialog open={open} onClose={onClose} maxWidth="sm" fullWidth>
                <DialogTitle>Add Stock: {resource?.name}</DialogTitle>
                <DialogContent>
                    <Grid container spacing={2} sx={{ mt: 1 }}>
                        <Grid item xs={12}>
                            <TextField
                                fullWidth
                                label={`Quantity to Add (${resource?.unit})`}
                                type="number"
                                value={quantity}
                                onChange={(e) => setQuantity(e.target.value)}
                            />
                        </Grid>
                        <Grid item xs={12}>
                            <TextField
                                fullWidth
                                label="Cost Per Unit (â‚¹)"
                                type="number"
                                value={costPerUnit}
                                onChange={(e) => setCostPerUnit(e.target.value)}
                            />
                        </Grid>
                        <Grid item xs={12}>
                            <TextField
                                fullWidth
                                label="Vendor Name"
                                value={vendorName}
                                onChange={(e) => setVendorName(e.target.value)}
                            />
                        </Grid>
                        <Grid item xs={12}>
                            <DatePicker
                                label="Purchase Date"
                                value={purchaseDate}
                                onChange={(date) => setPurchaseDate(date)}
                                renderInput={(params) => <TextField {...params} fullWidth />}
                            />
                        </Grid>
                    </Grid>
                </DialogContent>
                <DialogActions>
                    <Button onClick={onClose}>Cancel</Button>
                    <Button 
                        onClick={handleSubmit} 
                        variant="contained"
                        disabled={!quantity || parseFloat(quantity) <= 0}
                    >
                        Add Stock
                    </Button>
                </DialogActions>
            </Dialog>
        </LocalizationProvider>
    );
};
-e 
===== FILE: ./src/components/ResourcesManagement.js =====

import React, { useState, useEffect } from 'react';
import {
    Container,
    Paper,
    Typography,
    Grid,
    Card,
    CardContent,
    Button,
    Chip,
    IconButton,
    Dialog,
    DialogTitle,
    DialogContent,
    TextField,
    Select,
    MenuItem,
    FormControl,
    InputLabel,
    Box,
    Tabs,
    Tab,
    Table,
    TableBody,
    TableCell,
    TableContainer,
    TableHead,
    TableRow,
    Badge,
    LinearProgress,
    Menu,
    List,
    ListItem,
    ListItemText,
    Divider
} from '@mui/material';
import {
    Add,
    Inventory,
    Warning,
    Schedule,
    Download,
    Search,
    MoreVert,
    Science,
    Agriculture,
    Build,
    WaterDrop,
    LocalGasStation,
    Storage,
    AttachMoney,
    CheckCircle
} from '@mui/icons-material';
import { differenceInDays } from 'date-fns';
import { resourcesService } from '../services/api';
import ResourceForm from './ResourceForm';
import ResourceDetails from './ResourceDetails';
import { UseResourceDialog, AddStockDialog } from './ResourceDialogs';
import { PieChart, Pie, Cell, LineChart, Line, CartesianGrid, XAxis, YAxis, Tooltip as RechartsTooltip, Legend, ResponsiveContainer } from 'recharts';

const ResourcesManagement = () => {
    const [resources, setResources] = useState([]);
    const [filteredResources, setFilteredResources] = useState([]);
    const [stats, setStats] = useState({});
    const [loading, setLoading] = useState(true);
    const [activeTab, setActiveTab] = useState('all');
    const [showForm, setShowForm] = useState(false);
    const [selectedResource, setSelectedResource] = useState(null);
    const [detailsOpen, setDetailsOpen] = useState(false);
    const [usageOpen, setUsageOpen] = useState(false);
    const [addStockOpen, setAddStockOpen] = useState(false);
    const [filters, setFilters] = useState({
        category: '',
        location: '',
        lowStock: false,
        expired: false,
        maintenanceDue: false,
        search: ''
    });
    const [analytics, setAnalytics] = useState(null);
    const [menuAnchor, setMenuAnchor] = useState(null);
    const [selectedMenuResource, setSelectedMenuResource] = useState(null);

    // Category icons
    const categoryIcons = {
        seeds: <Agriculture color="success" />,
        fertilizers: <Science color="warning" />,
        pesticides: <Warning color="error" />,
        herbicides: <Warning color="error" />,
        equipment: <Build color="action" />,
        machinery: <Build color="action" />,
        water: <WaterDrop color="info" />,
        fuel: <LocalGasStation color="warning" />,
        electricity: <LocalGasStation color="secondary" />,
        storage: <Storage color="primary" />,
        default: <Inventory color="action" />
    };

    // Category colors
    const categoryColors = {
        seeds: '#4CAF50',
        fertilizers: '#FF9800',
        pesticides: '#F44336',
        herbicides: '#E91E63',
        equipment: '#795548',
        machinery: '#795548',
        water: '#2196F3',
        fuel: '#FF5722',
        electricity: '#9C27B0',
        storage: '#607D8B',
        default: '#757575'
    };

    useEffect(() => {
        fetchResources();
        fetchAnalytics();
    }, []);

    useEffect(() => {
        filterResources();
    }, [resources, filters, activeTab]);

    const fetchResources = async () => {
        setLoading(true);
        try {
            const response = await resourcesService.getResources(filters);
            setResources(response.resources);
            setFilteredResources(response.resources);
            setStats(response.stats);
        } catch (error) {
            console.error('Error fetching resources:', error);
        } finally {
            setLoading(false);
        }
    };

    const fetchAnalytics = async () => {
        try {
            const response = await resourcesService.getAnalytics();
            setAnalytics(response);
        } catch (error) {
            console.error('Error fetching analytics:', error);
        }
    };

    const filterResources = () => {
        let filtered = resources;
        
        // Apply category filter
        if (filters.category) {
            filtered = filtered.filter(r => r.category === filters.category);
        }
        
        // Apply location filter
        if (filters.location) {
            filtered = filtered.filter(r => r.location === filters.location);
        }
        
        // Apply low stock filter
        if (filters.lowStock) {
            filtered = filtered.filter(r => r.availableQuantity <= r.minimumThreshold);
        }
        
        // Apply expired filter
        if (filters.expired) {
            const now = new Date();
            filtered = filtered.filter(r => r.expiryDate && new Date(r.expiryDate) < now);
        }
        
        // Apply maintenance due filter
        if (filters.maintenanceDue) {
            const now = new Date();
            const nextWeek = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            filtered = filtered.filter(r => 
                r.isEquipment && 
                r.nextMaintenanceDate && 
                new Date(r.nextMaintenanceDate) <= nextWeek
            );
        }
        
        // Apply search filter
        if (filters.search) {
            const searchLower = filters.search.toLowerCase();
            filtered = filtered.filter(r => 
                r.name.toLowerCase().includes(searchLower) ||
                r.description?.toLowerCase().includes(searchLower) ||
                r.brand?.toLowerCase().includes(searchLower)
            );
        }
        
        // Apply tab filter
        switch (activeTab) {
            case 'lowStock':
                filtered = filtered.filter(r => r.availableQuantity <= r.minimumThreshold);
                break;
            case 'equipment':
                filtered = filtered.filter(r => r.isEquipment);
                break;
            case 'expired':
                filtered = filtered.filter(r => r.expiryDate && new Date(r.expiryDate) < new Date());
                break;
            case 'alerts':
                filtered = filtered.filter(r => r.alerts?.some(a => !a.resolved));
                break;
            default:
                break;
        }
        
        setFilteredResources(filtered);
    };

    const handleFilterChange = (field, value) => {
        setFilters(prev => ({ ...prev, [field]: value }));
    };

    const handleMenuClick = (event, resource) => {
        setMenuAnchor(event.currentTarget);
        setSelectedMenuResource(resource);
    };

    const handleMenuClose = () => {
        setMenuAnchor(null);
        setSelectedMenuResource(null);
    };

    const handleUseResource = async () => {
        setUsageOpen(true);
        handleMenuClose();
    };

    const handleAddStock = async () => {
        setAddStockOpen(true);
        handleMenuClose();
    };

    const handleDeleteResource = async () => {
        if (selectedMenuResource && window.confirm(`Are you sure you want to archive ${selectedMenuResource.name}?`)) {
            try {
                await resourcesService.deleteResource(selectedMenuResource._id);
                fetchResources();
                fetchAnalytics();
            } catch (error) {
                console.error('Error deleting resource:', error);
            }
        }
        handleMenuClose();
    };

    const getStockStatus = (resource) => {
        if (resource.availableQuantity <= 0) return { status: 'out_of_stock', color: 'error', label: 'Out of Stock' };
        if (resource.availableQuantity <= resource.minimumThreshold) return { status: 'low_stock', color: 'warning', label: 'Low Stock' };
        return { status: 'in_stock', color: 'success', label: 'In Stock' };
    };

    const getExpiryStatus = (resource) => {
        if (!resource.expiryDate) return null;
        
        const expiryDate = new Date(resource.expiryDate);
        const today = new Date();
        const daysToExpiry = differenceInDays(expiryDate, today);
        
        if (daysToExpiry < 0) return { status: 'expired', color: 'error', label: 'Expired', days: Math.abs(daysToExpiry) };
        if (daysToExpiry <= 30) return { status: 'expiring_soon', color: 'warning', label: 'Expiring Soon', days: daysToExpiry };
        return { status: 'valid', color: 'success', label: 'Valid', days: daysToExpiry };
    };

    const renderStatsCards = () => {
        return (
            <Grid container spacing={2} sx={{ mb: 3 }}>
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <Inventory color="primary" />
                                <Typography color="textSecondary" variant="caption">
                                    Total Resources
                                </Typography>
                            </Box>
                            <Typography variant="h5">{stats.totalResources || 0}</Typography>
                        </CardContent>
                    </Card>
                </Grid>
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <AttachMoney color="success" />
                                <Typography color="textSecondary" variant="caption">
                                    Total Value
                                </Typography>
                            </Box>
                            <Typography variant="h5">
                                â‚¹{(stats.totalValue || 0).toLocaleString()}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <Warning color="warning" />
                                <Typography color="textSecondary" variant="caption">
                                    Low Stock
                                </Typography>
                            </Box>
                            <Typography variant="h5" color="warning.main">
                                {stats.lowStockCount || 0}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <Build color="info" />
                                <Typography color="textSecondary" variant="caption">
                                    Equipment
                                </Typography>
                            </Box>
                            <Typography variant="h5" color="info.main">
                                {stats.equipmentCount || 0}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
            </Grid>
        );
    };

    const renderResourceCard = (resource) => {
        const stockStatus = getStockStatus(resource);
        const expiryStatus = getExpiryStatus(resource);
        
        return (
            <Grid item xs={12} sm={6} md={4} lg={3} key={resource._id}>
                <Card 
                    variant="outlined"
                    sx={{ 
                        height: '100%',
                        borderColor: categoryColors[resource.category] || categoryColors.default,
                        borderLeftWidth: 4,
                        borderLeftColor: categoryColors[resource.category] || categoryColors.default,
                        '&:hover': {
                            boxShadow: 2,
                            transform: 'translateY(-2px)',
                            transition: 'all 0.2s'
                        }
                    }}
                >
                    <CardContent>
                        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 2 }}>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                {categoryIcons[resource.category] || categoryIcons.default}
                                <Typography variant="subtitle1" fontWeight="bold">
                                    {resource.name}
                                </Typography>
                            </Box>
                            <IconButton 
                                size="small" 
                                onClick={(e) => handleMenuClick(e, resource)}
                            >
                                <MoreVert />
                            </IconButton>
                        </Box>
                        
                        <Typography variant="body2" color="textSecondary" paragraph>
                            {resource.description || 'No description'}
                        </Typography>
                        
                        <Box sx={{ mb: 2 }}>
                            <Chip 
                                label={resource.category} 
                                size="small" 
                                sx={{ 
                                    bgcolor: `${categoryColors[resource.category] || categoryColors.default}15`,
                                    color: categoryColors[resource.category] || categoryColors.default,
                                    mr: 1 
                                }}
                            />
                            {resource.brand && (
                                <Chip label={resource.brand} size="small" variant="outlined" sx={{ mr: 1 }} />
                            )}
                        </Box>
                        
                        <Grid container spacing={1} sx={{ mb: 2 }}>
                            <Grid item xs={6}>
                                <Typography variant="caption" color="textSecondary" display="block">
                                    Available
                                </Typography>
                                <Typography variant="body2" fontWeight="bold">
                                    {resource.availableQuantity} {resource.unit}
                                </Typography>
                            </Grid>
                            <Grid item xs={6}>
                                <Typography variant="caption" color="textSecondary" display="block">
                                    Total
                                </Typography>
                                <Typography variant="body2">
                                    {resource.totalQuantity} {resource.unit}
                                </Typography>
                            </Grid>
                        </Grid>
                        
                        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <Chip 
                                label={stockStatus.label} 
                                size="small" 
                                color={stockStatus.color}
                                icon={stockStatus.status === 'in_stock' ? <CheckCircle /> : <Warning />}
                            />
                            
                            {expiryStatus && (
                                <Chip 
                                    label={`${expiryStatus.days}d`} 
                                    size="small" 
                                    color={expiryStatus.color}
                                    variant="outlined"
                                />
                            )}
                        </Box>
                    </CardContent>
                </Card>
            </Grid>
        );
    };

    const renderAnalytics = () => {
        if (!analytics) return null;
        
        const categoryData = Object.entries(analytics.valueByCategory || {}).map(([name, value]) => ({
            name,
            value
        }));
        
        const monthlyUsageData = Object.entries(analytics.monthlyUsage || {}).map(([month, data]) => ({
            month: month.slice(5), // Remove year
            quantity: data.quantity,
            cost: data.cost
        })).slice(-6); // Last 6 months
        
        return (
            <Paper sx={{ p: 3, mb: 3 }}>
                <Typography variant="h6" gutterBottom>
                    Resource Analytics
                </Typography>
                
                <Grid container spacing={3}>
                    <Grid item xs={12} md={6}>
                        <Typography variant="subtitle2" gutterBottom>
                            Value by Category
                        </Typography>
                        <Box sx={{ height: 300 }}>
                            <ResponsiveContainer width="100%" height="100%">
                                <PieChart>
                                    <Pie
                                        data={categoryData}
                                        cx="50%"
                                        cy="50%"
                                        labelLine={false}
                                        label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}
                                        outerRadius={80}
                                        fill="#8884d8"
                                        dataKey="value"
                                    >
                                        {categoryData.map((entry, index) => (
                                            <Cell 
                                                key={`cell-${index}`} 
                                                fill={categoryColors[entry.name] || categoryColors.default} 
                                            />
                                        ))}
                                    </Pie>
                                    <RechartsTooltip formatter={(value) => [`â‚¹${value.toLocaleString()}`, 'Value']} />
                                </PieChart>
                            </ResponsiveContainer>
                        </Box>
                    </Grid>
                    
                    <Grid item xs={12} md={6}>
                        <Typography variant="subtitle2" gutterBottom>
                            Monthly Usage Trend
                        </Typography>
                        <Box sx={{ height: 300 }}>
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={monthlyUsageData}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis dataKey="month" />
                                    <YAxis />
                                    <RechartsTooltip formatter={(value, name) => [
                                        name === 'quantity' ? `${value} units` : `â‚¹${value}`,
                                        name === 'quantity' ? 'Quantity' : 'Cost'
                                    ]} />
                                    <Legend />
                                    <Line 
                                        type="monotone" 
                                        dataKey="quantity" 
                                        stroke="#8884d8" 
                                        name="Quantity"
                                        strokeWidth={2}
                                    />
                                    <Line 
                                        type="monotone" 
                                        dataKey="cost" 
                                        stroke="#82ca9d" 
                                        name="Cost"
                                        strokeWidth={2}
                                    />
                                </LineChart>
                            </ResponsiveContainer>
                        </Box>
                    </Grid>
                    
                    <Grid item xs={12}>
                        <Typography variant="subtitle2" gutterBottom>
                            Top Used Resources
                        </Typography>
                        <TableContainer>
                            <Table size="small">
                                <TableHead>
                                    <TableRow>
                                        <TableCell>Resource</TableCell>
                                        <TableCell>Category</TableCell>
                                        <TableCell align="right">Used Quantity</TableCell>
                                        <TableCell align="right">Cost</TableCell>
                                    </TableRow>
                                </TableHead>
                                <TableBody>
                                    {(analytics.topUsed || []).map((item, index) => (
                                        <TableRow key={index}>
                                            <TableCell>{item.name}</TableCell>
                                            <TableCell>
                                                <Chip 
                                                    label={item.category} 
                                                    size="small"
                                                    sx={{ 
                                                        bgcolor: `${categoryColors[item.category] || categoryColors.default}15`,
                                                        color: categoryColors[item.category] || categoryColors.default
                                                    }}
                                                />
                                            </TableCell>
                                            <TableCell align="right">
                                                {item.usedQuantity} {item.unit}
                                            </TableCell>
                                            <TableCell align="right">
                                                â‚¹{item.cost.toLocaleString()}
                                            </TableCell>
                                        </TableRow>
                                    ))}
                                </TableBody>
                            </Table>
                        </TableContainer>
                    </Grid>
                </Grid>
            </Paper>
        );
    };

    return (
        <Container maxWidth="xl" sx={{ mt: 4, mb: 4 }}>
            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h4">
                    Resource Management
                </Typography>
                <Box sx={{ display: 'flex', gap: 1 }}>
                    <Button
                        variant="outlined"
                        startIcon={<Download />}
                        onClick={() => resourcesService.exportToCSV()}
                    >
                        Export
                    </Button>
                    <Button
                        variant="contained"
                        startIcon={<Add />}
                        onClick={() => setShowForm(true)}
                    >
                        Add Resource
                    </Button>
                </Box>
            </Box>

            {renderStatsCards()}
            
            {/* Filters & Tabs */}
            <Paper sx={{ p: 2, mb: 3 }}>
                <Grid container spacing={2} alignItems="center">
                    <Grid item xs={12} md={3}>
                        <TextField
                            fullWidth
                            size="small"
                            placeholder="Search resources..."
                            value={filters.search}
                            onChange={(e) => handleFilterChange('search', e.target.value)}
                            InputProps={{
                                startAdornment: <Search sx={{ mr: 1, color: 'action.active' }} />
                            }}
                        />
                    </Grid>
                    
                    <Grid item xs={12} md={6}>
                        <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap' }}>
                            <FormControl size="small" sx={{ minWidth: 120 }}>
                                <InputLabel>Category</InputLabel>
                                <Select
                                    value={filters.category}
                                    label="Category"
                                    onChange={(e) => handleFilterChange('category', e.target.value)}
                                >
                                    <MenuItem value="">All Categories</MenuItem>
                                    <MenuItem value="seeds">Seeds</MenuItem>
                                    <MenuItem value="fertilizers">Fertilizers</MenuItem>
                                    <MenuItem value="pesticides">Pesticides</MenuItem>
                                    <MenuItem value="equipment">Equipment</MenuItem>
                                    <MenuItem value="water">Water</MenuItem>
                                    <MenuItem value="fuel">Fuel</MenuItem>
                                </Select>
                            </FormControl>
                            
                            <FormControl size="small" sx={{ minWidth: 120 }}>
                                <InputLabel>Location</InputLabel>
                                <Select
                                    value={filters.location}
                                    label="Location"
                                    onChange={(e) => handleFilterChange('location', e.target.value)}
                                >
                                    <MenuItem value="">All Locations</MenuItem>
                                    <MenuItem value="store_room">Store Room</MenuItem>
                                    <MenuItem value="field">Field</MenuItem>
                                    <MenuItem value="godown">Godown</MenuItem>
                                    <MenuItem value="cold_storage">Cold Storage</MenuItem>
                                </Select>
                            </FormControl>
                            
                            <Button
                                variant={filters.lowStock ? "contained" : "outlined"}
                                color="warning"
                                size="small"
                                onClick={() => handleFilterChange('lowStock', !filters.lowStock)}
                                startIcon={<Warning />}
                            >
                                Low Stock
                            </Button>
                            
                            <Button
                                variant={filters.maintenanceDue ? "contained" : "outlined"}
                                color="info"
                                size="small"
                                onClick={() => handleFilterChange('maintenanceDue', !filters.maintenanceDue)}
                                startIcon={<Schedule />}
                            >
                                Maintenance Due
                            </Button>
                        </Box>
                    </Grid>
                    
                    <Grid item xs={12} md={3}>
                        <Tabs 
                            value={activeTab} 
                            onChange={(e, newValue) => setActiveTab(newValue)}
                            variant="scrollable"
                            scrollButtons="auto"
                        >
                            <Tab label="All" value="all" />
                            <Tab 
                                label={
                                    <Badge badgeContent={stats.lowStockCount} color="warning" showZero>
                                        Low Stock
                                    </Badge>
                                } 
                                value="lowStock" 
                            />
                            <Tab label="Equipment" value="equipment" />
                            <Tab label="Expired" value="expired" />
                            <Tab label="Alerts" value="alerts" />
                        </Tabs>
                    </Grid>
                </Grid>
            </Paper>

            {/* Analytics Section */}
            {renderAnalytics()}

            {/* Resources Grid */}
            {loading ? (
                <LinearProgress />
            ) : filteredResources.length === 0 ? (
                <Paper sx={{ p: 4, textAlign: 'center' }}>
                    <Typography color="textSecondary">
                        No resources found. Add your first resource!
                    </Typography>
                    <Button
                        variant="contained"
                        startIcon={<Add />}
                        onClick={() => setShowForm(true)}
                        sx={{ mt: 2 }}
                    >
                        Add Resource
                    </Button>
                </Paper>
            ) : (
                <Grid container spacing={2}>
                    {filteredResources.map(renderResourceCard)}
                </Grid>
            )}

            {/* Resource Form Dialog */}
            <Dialog 
                open={showForm} 
                onClose={() => setShowForm(false)}
                maxWidth="md"
                fullWidth
            >
                <DialogTitle>
                    {selectedResource ? 'Edit Resource' : 'Add New Resource'}
                </DialogTitle>
                <DialogContent>
                    <ResourceForm 
                        resource={selectedResource}
                        onSuccess={() => {
                            setShowForm(false);
                            setSelectedResource(null);
                            fetchResources();
                            fetchAnalytics();
                        }}
                        onCancel={() => {
                            setShowForm(false);
                            setSelectedResource(null);
                        }}
                    />
                </DialogContent>
            </Dialog>

            {/* Context Menu */}
            <Menu
                anchorEl={menuAnchor}
                open={Boolean(menuAnchor)}
                onClose={handleMenuClose}
            >
                <MenuItem onClick={() => {
                    setSelectedResource(selectedMenuResource);
                    setDetailsOpen(true);
                    handleMenuClose();
                }}>
                    <ListItemText primary="View Details" />
                </MenuItem>
                <MenuItem onClick={() => {
                    setSelectedResource(selectedMenuResource);
                    setShowForm(true);
                    handleMenuClose();
                }}>
                    <ListItemText primary="Edit" />
                </MenuItem>
                <MenuItem onClick={handleUseResource}>
                    <ListItemText primary="Use Resource" />
                </MenuItem>
                <MenuItem onClick={handleAddStock}>
                    <ListItemText primary="Add Stock" />
                </MenuItem>
                <Divider />
                <MenuItem onClick={handleDeleteResource} sx={{ color: 'error.main' }}>
                    <ListItemText primary="Archive" />
                </MenuItem>
            </Menu>

            {/* Resource Details Dialog */}
            {selectedResource && (
                <ResourceDetails 
                    open={detailsOpen}
                    resource={selectedResource}
                    onClose={() => setDetailsOpen(false)}
                    onEdit={() => {
                        setDetailsOpen(false);
                        setShowForm(true);
                    }}
                />
            )}

            {/* Use Resource Dialog */}
            {selectedMenuResource && (
                <UseResourceDialog 
                    open={usageOpen}
                    resource={selectedMenuResource}
                    onClose={() => setUsageOpen(false)}
                    onSuccess={() => {
                        setUsageOpen(false);
                        fetchResources();
                        fetchAnalytics();
                    }}
                />
            )}

            {/* Add Stock Dialog */}
            {selectedMenuResource && (
                <AddStockDialog 
                    open={addStockOpen}
                    resource={selectedMenuResource}
                    onClose={() => setAddStockOpen(false)}
                    onSuccess={() => {
                        setAddStockOpen(false);
                        fetchResources();
                        fetchAnalytics();
                    }}
                />
            )}
        </Container>
    );
};

export default ResourcesManagement;
-e 
===== FILE: ./src/components/TransactionForm.js =====

import React, { useState, useEffect } from 'react';
import {
    Box,
    TextField,
    Select,
    MenuItem,
    FormControl,
    InputLabel,
    Grid,
    Button,
    Typography,
    RadioGroup,
    Radio,
    FormControlLabel,
    Alert,
    Stepper,
    Step,
    StepLabel,
    Tabs,
    Tab
} from '@mui/material';
import { DatePicker } from '@mui/x-date-pickers/DatePicker';
import { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';
import { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns';
import { financialService, cropService } from '../services/api';
import { ArrowUpward, ArrowDownward } from '@mui/icons-material';
import { format } from 'date-fns';

const TransactionForm = ({ transaction, onSuccess, onCancel }) => {
    const [activeStep, setActiveStep] = useState(0);
    const [crops, setCrops] = useState([]);
    const [formData, setFormData] = useState({
        type: 'expense',
        description: '',
        amount: 0,
        transactionDate: new Date(),
        category: 'seeds',
        source: 'crop_sale',
        paymentMethod: 'cash',
        paymentStatus: 'pending',
        dueDate: null,
        crop: '',
        party: {
            name: '',
            type: 'vendor'
        },
        notes: ''
    });

    const steps = ['Basic Info', 'Details', 'Review'];
    
    const expenseCategories = [
        { value: 'seeds', label: 'ðŸŒ± Seeds' },
        { value: 'fertilizers', label: 'ðŸ§ª Fertilizers' },
        { value: 'pesticides', label: 'ðŸ› Pesticides' },
        { value: 'labor', label: 'ðŸ‘· Labor' },
        { value: 'equipment_fuel', label: 'â›½ Equipment Fuel' },
        { value: 'equipment_repair', label: 'ðŸ”§ Equipment Repair' },
        { value: 'irrigation', label: 'ðŸ’§ Irrigation' },
        { value: 'electricity', label: 'âš¡ Electricity' },
        { value: 'transport', label: 'ðŸšš Transport' },
        { value: 'other', label: 'ðŸ“¦ Other' }
    ];
    
    const incomeSources = [
        { value: 'crop_sale', label: 'ðŸŒ¾ Crop Sale' },
        { value: 'livestock_sale', label: 'ðŸ„ Livestock Sale' },
        { value: 'dairy', label: 'ðŸ¥› Dairy' },
        { value: 'poultry', label: 'ðŸ“ Poultry' },
        { value: 'government_subsidy', label: 'ðŸ›ï¸ Government Subsidy' },
        { value: 'other', label: 'ðŸ“¦ Other' }
    ];
    
    const paymentMethods = [
        { value: 'cash', label: 'ðŸ’µ Cash' },
        { value: 'upi', label: 'ðŸ“± UPI' },
        { value: 'bank_transfer', label: 'ðŸ¦ Bank Transfer' },
        { value: 'cheque', label: 'ðŸ“ Cheque' },
        { value: 'credit', label: 'ðŸ’³ Credit' }
    ];

    useEffect(() => {
        fetchCrops();
        if (transaction) {
            setFormData({
                type: transaction.type || 'expense',
                description: transaction.description || '',
                amount: transaction.amount || 0,
                transactionDate: transaction.transactionDate ? new Date(transaction.transactionDate) : new Date(),
                category: transaction.category || 'seeds',
                source: transaction.source || 'crop_sale',
                paymentMethod: transaction.paymentMethod || 'cash',
                paymentStatus: transaction.paymentStatus || 'pending',
                dueDate: transaction.dueDate ? new Date(transaction.dueDate) : null,
                crop: transaction.crop?._id || '',
                party: transaction.party || { name: '', type: 'vendor' },
                notes: transaction.notes || ''
            });
        }
    }, [transaction]);

    const fetchCrops = async () => {
        try {
            const response = await cropService.getCrops();
            setCrops(Array.isArray(response) ? response : []);
        } catch (error) {
            console.error('Error fetching crops:', error);
        }
    };

    const handleChange = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
    };

    const handlePartyChange = (field, value) => {
        setFormData(prev => ({
            ...prev,
            party: { ...prev.party, [field]: value }
        }));
    };

    const handleSubmit = async () => {
        try {
            if (transaction) {
                await financialService.updateTransaction(transaction._id, formData);
            } else {
                await financialService.createTransaction(formData);
            }
            onSuccess();
        } catch (error) {
            console.error('Error saving transaction:', error);
        }
    };

    const renderBasicInfo = () => (
        <Grid container spacing={3}>
            <Grid item xs={12}>
                <FormControl component="fieldset">
                    <Typography variant="subtitle2" gutterBottom>
                        Transaction Type
                    </Typography>
                    <RadioGroup
                        row
                        value={formData.type}
                        onChange={(e) => handleChange('type', e.target.value)}
                    >
                        <FormControlLabel 
                            value="income" 
                            control={<Radio />} 
                            label={
                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                    <ArrowUpward color="success" />
                                    Income
                                </Box>
                            } 
                        />
                        <FormControlLabel 
                            value="expense" 
                            control={<Radio />} 
                            label={
                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                    <ArrowDownward color="error" />
                                    Expense
                                </Box>
                            } 
                        />
                    </RadioGroup>
                </FormControl>
            </Grid>
            
            <Grid item xs={12}>
                <TextField
                    fullWidth
                    label="Description"
                    value={formData.description}
                    onChange={(e) => handleChange('description', e.target.value)}
                    required
                />
            </Grid>
            
            <Grid item xs={12} md={6}>
                <TextField
                    fullWidth
                    label="Amount (â‚¹)"
                    type="number"
                    value={formData.amount}
                    onChange={(e) => handleChange('amount', parseFloat(e.target.value))}
                    InputProps={{ inputProps: { min: 0, step: 0.01 } }}
                    required
                />
            </Grid>
            
            <Grid item xs={12} md={6}>
                <LocalizationProvider dateAdapter={AdapterDateFns}>
                    <DatePicker
                        label="Transaction Date"
                        value={formData.transactionDate}
                        onChange={(date) => handleChange('transactionDate', date)}
                        renderInput={(params) => <TextField {...params} fullWidth required />}
                    />
                </LocalizationProvider>
            </Grid>
        </Grid>
    );

    const renderDetails = () => (
        <Grid container spacing={3}>
            <Grid item xs={12} md={6}>
                {formData.type === 'expense' ? (
                    <FormControl fullWidth required>
                        <InputLabel>Expense Category</InputLabel>
                        <Select
                            value={formData.category}
                            label="Expense Category"
                            onChange={(e) => handleChange('category', e.target.value)}
                        >
                            {expenseCategories.map(cat => (
                                <MenuItem key={cat.value} value={cat.value}>
                                    {cat.label}
                                </MenuItem>
                            ))}
                        </Select>
                    </FormControl>
                ) : (
                    <FormControl fullWidth required>
                        <InputLabel>Income Source</InputLabel>
                        <Select
                            value={formData.source}
                            label="Income Source"
                            onChange={(e) => handleChange('source', e.target.value)}
                        >
                            {incomeSources.map(src => (
                                <MenuItem key={src.value} value={src.value}>
                                    {src.label}
                                </MenuItem>
                            ))}
                        </Select>
                    </FormControl>
                )}
            </Grid>
            
            <Grid item xs={12} md={6}>
                <FormControl fullWidth>
                    <InputLabel>Payment Method</InputLabel>
                    <Select
                        value={formData.paymentMethod}
                        label="Payment Method"
                        onChange={(e) => handleChange('paymentMethod', e.target.value)}
                    >
                        {paymentMethods.map(method => (
                            <MenuItem key={method.value} value={method.value}>
                                {method.label}
                            </MenuItem>
                        ))}
                    </Select>
                </FormControl>
            </Grid>
            
            <Grid item xs={12} md={6}>
                <FormControl fullWidth>
                    <InputLabel>Payment Status</InputLabel>
                    <Select
                        value={formData.paymentStatus}
                        label="Payment Status"
                        onChange={(e) => handleChange('paymentStatus', e.target.value)}
                    >
                        <MenuItem value="pending">Pending</MenuItem>
                        <MenuItem value="paid">Paid</MenuItem>
                        <MenuItem value="partial">Partial</MenuItem>
                    </Select>
                </FormControl>
            </Grid>
            
            <Grid item xs={12} md={6}>
                <LocalizationProvider dateAdapter={AdapterDateFns}>
                    <DatePicker
                        label="Due Date (Optional)"
                        value={formData.dueDate}
                        onChange={(date) => handleChange('dueDate', date)}
                        renderInput={(params) => <TextField {...params} fullWidth />}
                    />
                </LocalizationProvider>
            </Grid>
            
            <Grid item xs={12}>
                <FormControl fullWidth>
                    <InputLabel>Linked Crop (Optional)</InputLabel>
                    <Select
                        value={formData.crop}
                        label="Linked Crop (Optional)"
                        onChange={(e) => handleChange('crop', e.target.value)}
                    >
                        <MenuItem value="">None</MenuItem>
                        {crops.map(crop => (
                            <MenuItem key={crop._id} value={crop._id}>
                                {crop.name} ({crop.variety})
                            </MenuItem>
                        ))}
                    </Select>
                </FormControl>
            </Grid>
            
            <Grid item xs={12} md={6}>
                <TextField
                    fullWidth
                    label="Party Name"
                    value={formData.party.name}
                    onChange={(e) => handlePartyChange('name', e.target.value)}
                    placeholder={formData.type === 'income' ? 'Buyer name' : 'Vendor name'}
                />
            </Grid>
            
            <Grid item xs={12} md={6}>
                <FormControl fullWidth>
                    <InputLabel>Party Type</InputLabel>
                    <Select
                        value={formData.party.type}
                        label="Party Type"
                        onChange={(e) => handlePartyChange('type', e.target.value)}
                    >
                        <MenuItem value="buyer">Buyer</MenuItem>
                        <MenuItem value="seller">Seller</MenuItem>
                        <MenuItem value="vendor">Vendor</MenuItem>
                        <MenuItem value="worker">Worker</MenuItem>
                        <MenuItem value="other">Other</MenuItem>
                    </Select>
                </FormControl>
            </Grid>
            
            <Grid item xs={12}>
                <TextField
                    fullWidth
                    label="Notes (Optional)"
                    multiline
                    rows={2}
                    value={formData.notes}
                    onChange={(e) => handleChange('notes', e.target.value)}
                />
            </Grid>
        </Grid>
    );

    const renderReview = () => (
        <Box>
            <Typography variant="h6" gutterBottom>
                Review Transaction
            </Typography>
            
            <Grid container spacing={2} sx={{ mt: 2 }}>
                <Grid item xs={12} md={6}>
                    <Typography variant="subtitle2" color="textSecondary">
                        Basic Information
                    </Typography>
                    <Typography>
                        {formData.description}
                    </Typography>
                    <Typography color="textSecondary">
                        {formData.type === 'income' ? 'Income' : 'Expense'} â€¢ {format(formData.transactionDate, 'dd MMM yyyy')}
                    </Typography>
                </Grid>
                
                <Grid item xs={12} md={6}>
                    <Typography variant="subtitle2" color="textSecondary">
                        Amount
                    </Typography>
                    <Typography variant="h5" color={formData.type === 'income' ? 'success.main' : 'error.main'}>
                        â‚¹{formData.amount.toLocaleString()}
                    </Typography>
                </Grid>
                
                <Grid item xs={12} md={6}>
                    <Typography variant="subtitle2" color="textSecondary">
                        {formData.type === 'income' ? 'Source' : 'Category'}
                    </Typography>
                    <Typography>
                        {formData.type === 'income' 
                            ? incomeSources.find(s => s.value === formData.source)?.label || formData.source
                            : expenseCategories.find(c => c.value === formData.category)?.label || formData.category
                        }
                    </Typography>
                </Grid>
                
                <Grid item xs={12} md={6}>
                    <Typography variant="subtitle2" color="textSecondary">
                        Payment
                    </Typography>
                    <Typography>
                        {paymentMethods.find(m => m.value === formData.paymentMethod)?.label || formData.paymentMethod}
                    </Typography>
                    <Typography color="textSecondary">
                        Status: {formData.paymentStatus}
                    </Typography>
                </Grid>
                
                {formData.party.name && (
                    <Grid item xs={12}>
                        <Typography variant="subtitle2" color="textSecondary">
                            Party Details
                        </Typography>
                        <Typography>
                            {formData.party.name} ({formData.party.type})
                        </Typography>
                    </Grid>
                )}
                
                {formData.crop && (
                    <Grid item xs={12}>
                        <Typography variant="subtitle2" color="textSecondary">
                            Linked Crop
                        </Typography>
                        <Typography>
                            {crops.find(c => c._id === formData.crop)?.name || 'Selected crop'}
                        </Typography>
                    </Grid>
                )}
            </Grid>
        </Box>
    );

    const renderStepContent = (step) => {
        switch (step) {
            case 0:
                return renderBasicInfo();
            case 1:
                return renderDetails();
            case 2:
                return renderReview();
            default:
                return null;
        }
    };

    return (
        <LocalizationProvider dateAdapter={AdapterDateFns}>
            <Box sx={{ mt: 2 }}>
                <Stepper activeStep={activeStep} sx={{ mb: 3 }}>
                    {steps.map((label) => (
                        <Step key={label}>
                            <StepLabel>{label}</StepLabel>
                        </Step>
                    ))}
                </Stepper>
                
                {renderStepContent(activeStep)}
                
                <Box sx={{ display: 'flex', justifyContent: 'space-between', mt: 3 }}>
                    <Button
                        disabled={activeStep === 0}
                        onClick={() => setActiveStep(activeStep - 1)}
                    >
                        Back
                    </Button>
                    
                    <Box>
                        {activeStep < steps.length - 1 ? (
                            <Button
                                variant="contained"
                                onClick={() => setActiveStep(activeStep + 1)}
                                disabled={!formData.description || !formData.amount}
                            >
                                Next
                            </Button>
                        ) : (
                            <Button
                                variant="contained"
                                onClick={handleSubmit}
                                disabled={!formData.description || !formData.amount}
                            >
                                {transaction ? 'Update Transaction' : 'Create Transaction'}
                            </Button>
                        )}
                    </Box>
                </Box>
            </Box>
        </LocalizationProvider>
    );
};

export default TransactionForm;
-e 
===== FILE: ./src/components/TransactionDetails.js =====

import React, { useState } from 'react';
import {
    Dialog,
    DialogTitle,
    DialogContent,
    DialogActions,
    Button,
    Typography,
    Box,
    Grid,
    Chip,
    Divider,
    IconButton
} from '@mui/material';
import {
    Edit,
    CheckCircle,
    Error,
    Warning,
    AttachMoney,
    DateRange,
    Person,
    Label,
    Description
} from '@mui/icons-material';
import { format } from 'date-fns';

const TransactionDetails = ({ open, transaction, onClose, onEdit, onMarkPaid }) => {
    if (!transaction) return null;

    const getStatusColor = (status) => {
        switch (status) {
            case 'paid': return 'success';
            case 'pending': return 'warning';
            case 'overdue': return 'error';
            default: return 'default';
        }
    };

    const getStatusIcon = (status) => {
        switch (status) {
            case 'paid': return <CheckCircle />;
            case 'pending': return <Warning />;
            case 'overdue': return <Error />;
            default: return null;
        }
    };

    return (
        <Dialog open={open} onClose={onClose} maxWidth="md" fullWidth>
            <DialogTitle>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                    Transaction Details
                    <IconButton onClick={onEdit} size="small">
                        <Edit />
                    </IconButton>
                </Box>
            </DialogTitle>
            
            <DialogContent>
                <Grid container spacing={3}>
                    <Grid item xs={12}>
                        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                <Typography variant="h6">
                                    {transaction.description}
                                </Typography>
                                <Chip 
                                    label={transaction.type.toUpperCase()} 
                                    color={transaction.type === 'income' ? 'success' : 'error'}
                                    size="small" 
                                    variant="outlined"
                                />
                            </Box>
                            <Chip 
                                label={transaction.paymentStatus.toUpperCase()} 
                                color={getStatusColor(transaction.paymentStatus)}
                                icon={getStatusIcon(transaction.paymentStatus)}
                            />
                        </Box>
                        <Divider />
                    </Grid>

                    <Grid item xs={12} md={6}>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                            <AttachMoney color="action" />
                            <Typography variant="subtitle2" color="textSecondary">
                                Financials
                            </Typography>
                        </Box>
                        <Typography variant="h4" color={transaction.type === 'income' ? 'success.main' : 'error.main'}>
                            â‚¹{transaction.amount.toLocaleString()}
                        </Typography>
                        {transaction.taxAmount > 0 && (
                            <Typography variant="body2" color="textSecondary">
                                Tax: â‚¹{transaction.taxAmount}
                            </Typography>
                        )}
                        <Typography variant="body2" sx={{ mt: 1 }}>
                            <strong>Method:</strong> {transaction.paymentMethod?.toUpperCase()}
                        </Typography>
                        {transaction.paymentReference && (
                            <Typography variant="body2">
                                <strong>Ref:</strong> {transaction.paymentReference}
                            </Typography>
                        )}
                    </Grid>

                    <Grid item xs={12} md={6}>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                            <DateRange color="action" />
                            <Typography variant="subtitle2" color="textSecondary">
                                Dates
                            </Typography>
                        </Box>
                        <Typography variant="body2">
                            <strong>Date:</strong> {format(new Date(transaction.transactionDate), 'dd MMM yyyy')}
                        </Typography>
                        {transaction.dueDate && (
                            <Typography variant="body2">
                                <strong>Due:</strong> {format(new Date(transaction.dueDate), 'dd MMM yyyy')}
                            </Typography>
                        )}
                        {transaction.paymentDate && (
                            <Typography variant="body2">
                                <strong>Paid:</strong> {format(new Date(transaction.paymentDate), 'dd MMM yyyy')}
                            </Typography>
                        )}
                    </Grid>

                    <Grid item xs={12} md={6}>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                            <Label color="action" />
                            <Typography variant="subtitle2" color="textSecondary">
                                Classification
                            </Typography>
                        </Box>
                        <Typography variant="body2">
                            <strong>Category:</strong> {transaction.type === 'income' ? transaction.source : transaction.category}
                        </Typography>
                        {transaction.cropName && (
                            <Typography variant="body2">
                                <strong>Crop:</strong> {transaction.cropName}
                            </Typography>
                        )}
                    </Grid>

                    <Grid item xs={12} md={6}>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                            <Person color="action" />
                            <Typography variant="subtitle2" color="textSecondary">
                                Party Details
                            </Typography>
                        </Box>
                        {transaction.party?.name ? (
                            <>
                                <Typography variant="body2">
                                    <strong>Name:</strong> {transaction.party.name}
                                </Typography>
                                <Typography variant="body2">
                                    <strong>Type:</strong> {transaction.party.type}
                                </Typography>
                            </>
                        ) : (
                            <Typography variant="body2" color="textSecondary">
                                No party details
                            </Typography>
                        )}
                    </Grid>

                    {transaction.notes && (
                        <Grid item xs={12}>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <Description color="action" />
                                <Typography variant="subtitle2" color="textSecondary">
                                    Notes
                                </Typography>
                            </Box>
                            <Typography variant="body2" sx={{ whiteSpace: 'pre-wrap' }}>
                                {transaction.notes}
                            </Typography>
                        </Grid>
                    )}
                </Grid>
            </DialogContent>
            
            <DialogActions>
                {transaction.paymentStatus !== 'paid' && (
                    <Button 
                        color="success" 
                        variant="contained" 
                        onClick={() => {
                            onMarkPaid();
                            onClose();
                        }}
                    >
                        Mark as Paid
                    </Button>
                )}
                <Button onClick={onClose}>Close</Button>
            </DialogActions>
        </Dialog>
    );
};

export default TransactionDetails;
-e 
===== FILE: ./src/components/FinancialDashboard.js =====

import React, { useState, useEffect } from 'react';
import {
    Container,
    Paper,
    Typography,
    Grid,
    Card,
    CardContent,
    Button,
    Chip,
    IconButton,
    Dialog,
    DialogTitle,
    DialogContent,
    TextField,
    Select,
    MenuItem,
    FormControl,
    InputLabel,
    Box,
    Tabs,
    Tab,
    Table,
    TableBody,
    TableCell,
    TableContainer,
    TableHead,
    TableRow,
    LinearProgress,
    Menu,
    List,
    ListItem,
    ListItemText,
    Divider,
    Alert
} from '@mui/material';
import {
    Add,
    AttachMoney,
    TrendingUp,
    TrendingDown,
    Payment,
    Receipt,
    Download,
    MoreVert,
    CheckCircle,
    ArrowUpward,
    ArrowDownward,
    ShowChart,
    PieChart
} from '@mui/icons-material';
import { DatePicker } from '@mui/x-date-pickers/DatePicker';
import { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';
import { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns';
import { format, startOfYear } from 'date-fns';
import { financialService } from '../services/api';
import TransactionForm from './TransactionForm';
import TransactionDetails from './TransactionDetails';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip as RechartsTooltip, Legend, ResponsiveContainer, PieChart as RePieChart, Pie, Cell } from 'recharts';

const FinancialDashboard = () => {
    const [transactions, setTransactions] = useState([]);
    const [summary, setSummary] = useState({});
    const [loading, setLoading] = useState(true);
    const [activeTab, setActiveTab] = useState('overview');
    const [showForm, setShowForm] = useState(false);
    const [selectedTransaction, setSelectedTransaction] = useState(null);
    const [detailsOpen, setDetailsOpen] = useState(false);
    const [filters, setFilters] = useState({
        startDate: startOfYear(new Date()),
        endDate: new Date(),
        type: '',
        category: '',
        paymentStatus: ''
    });
    const [expenseBreakdown, setExpenseBreakdown] = useState([]);
    const [incomeBreakdown, setIncomeBreakdown] = useState([]);
    const [pendingPayments, setPendingPayments] = useState([]);
    const [cropWiseProfit, setCropWiseProfit] = useState([]);
    const [insights, setInsights] = useState([]);
    const [menuAnchor, setMenuAnchor] = useState(null);
    const [selectedMenuTransaction, setSelectedMenuTransaction] = useState(null);

    // Expense category colors
    const expenseColors = {
        seeds: '#4CAF50',
        fertilizers: '#FF9800',
        pesticides: '#F44336',
        labor: '#2196F3',
        equipment_fuel: '#795548',
        equipment_repair: '#607D8B',
        irrigation: '#00BCD4',
        electricity: '#FFC107',
        transport: '#9C27B0',
        other: '#757575'
    };

    // Income source colors
    const incomeColors = {
        crop_sale: '#4CAF50',
        livestock_sale: '#8BC34A',
        dairy: '#CDDC39',
        poultry: '#FFEB3B',
        government_subsidy: '#2196F3',
        other: '#9E9E9E'
    };

    useEffect(() => {
        fetchFinancialData();
        fetchInsights();
    }, [filters]);

    const fetchFinancialData = async () => {
        setLoading(true);
        try {
            const [transactionsRes, expenseRes, incomeRes, pendingRes, cropRes] = await Promise.all([
                financialService.getTransactions(filters),
                financialService.getExpenseBreakdown(filters),
                financialService.getIncomeBreakdown(filters),
                financialService.getPendingPayments(),
                financialService.getCropWiseProfit()
            ]);

            setTransactions(transactionsRes.transactions);
            setSummary(transactionsRes.summary);
            setExpenseBreakdown(expenseRes.breakdown);
            setIncomeBreakdown(incomeRes.breakdown);
            setPendingPayments(pendingRes.pendingPayments);
            setCropWiseProfit(Array.isArray(cropRes) ? cropRes : []);
        } catch (error) {
            console.error('Error fetching financial data:', error);
        } finally {
            setLoading(false);
        }
    };

    const fetchInsights = async () => {
        try {
            const response = await financialService.getInsights();
            setInsights(response.insights || []);
        } catch (error) {
            console.error('Error fetching insights:', error);
        }
    };

    const handleFilterChange = (field, value) => {
        setFilters(prev => ({ ...prev, [field]: value }));
    };

    const handleMenuClick = (event, transaction) => {
        setMenuAnchor(event.currentTarget);
        setSelectedMenuTransaction(transaction);
    };

    const handleMenuClose = () => {
        setMenuAnchor(null);
        setSelectedMenuTransaction(null);
    };

    const handleMarkPaid = async () => {
        if (selectedMenuTransaction) {
            try {
                await financialService.markPaymentPaid(selectedMenuTransaction._id);
                fetchFinancialData();
            } catch (error) {
                console.error('Error marking payment as paid:', error);
            }
        }
        handleMenuClose();
    };

    const handleDeleteTransaction = async () => {
        if (selectedMenuTransaction && window.confirm('Are you sure you want to delete this transaction?')) {
            try {
                await financialService.deleteTransaction(selectedMenuTransaction._id);
                fetchFinancialData();
            } catch (error) {
                console.error('Error deleting transaction:', error);
            }
        }
        handleMenuClose();
    };

    const handleExportReport = async () => {
        try {
            await financialService.exportToCSV(filters);
        } catch (error) {
            console.error('Error exporting report:', error);
        }
    };

    const renderSummaryCards = () => {
        const profitColor = summary.netProfit >= 0 ? 'success' : 'error';
        const profitIcon = summary.netProfit >= 0 ? <TrendingUp /> : <TrendingDown />;

        return (
            <Grid container spacing={2} sx={{ mb: 3 }}>
                <Grid item xs={12} sm={6} md={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <ArrowUpward color="success" />
                                <Typography color="textSecondary" variant="caption">
                                    Total Income
                                </Typography>
                            </Box>
                            <Typography variant="h5" color="success.main">
                                â‚¹{summary.totalIncome?.toLocaleString() || '0'}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
                
                <Grid item xs={12} sm={6} md={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <ArrowDownward color="error" />
                                <Typography color="textSecondary" variant="caption">
                                    Total Expenses
                                </Typography>
                            </Box>
                            <Typography variant="h5" color="error.main">
                                â‚¹{summary.totalExpense?.toLocaleString() || '0'}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
                
                <Grid item xs={12} sm={6} md={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                {profitIcon}
                                <Typography color="textSecondary" variant="caption">
                                    Net Profit
                                </Typography>
                            </Box>
                            <Typography variant="h5" color={`${profitColor}.main`}>
                                â‚¹{summary.netProfit?.toLocaleString() || '0'}
                            </Typography>
                            {summary.profitMargin !== undefined && (
                                <Typography variant="caption" color="textSecondary">
                                    Margin: {summary.profitMargin.toFixed(1)}%
                                </Typography>
                            )}
                        </CardContent>
                    </Card>
                </Grid>
                
                <Grid item xs={12} sm={6} md={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <Payment color="warning" />
                                <Typography color="textSecondary" variant="caption">
                                    Pending Payments
                                </Typography>
                            </Box>
                            <Typography variant="h5" color="warning.main">
                                {pendingPayments.length}
                            </Typography>
                            <Typography variant="caption" color="textSecondary">
                                {pendingPayments.length > 0 ? 'â‚¹' + pendingPayments.reduce((sum, p) => sum + p.amount, 0).toLocaleString() : 'All clear'}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
            </Grid>
        );
    };

    const renderCharts = () => {
        return (
            <Grid container spacing={3}>
                {/* Expense Breakdown Pie Chart */}
                <Grid item xs={12} md={6}>
                    <Paper sx={{ p: 2, height: '100%' }}>
                        <Typography variant="h6" gutterBottom>
                            Expense Breakdown
                        </Typography>
                        {expenseBreakdown.length > 0 ? (
                            <Box sx={{ height: 300 }}>
                                <ResponsiveContainer width="100%" height="100%">
                                    <RePieChart>
                                        <Pie
                                            data={expenseBreakdown}
                                            cx="50%"
                                            cy="50%"
                                            labelLine={false}
                                            label={({ _id, percentage }) => `${_id}: ${percentage.toFixed(1)}%`}
                                            outerRadius={80}
                                            fill="#8884d8"
                                            dataKey="totalAmount"
                                        >
                                            {expenseBreakdown.map((entry, index) => (
                                                <Cell key={`cell-${index}`} fill={expenseColors[entry._id] || expenseColors.other} />
                                            ))}
                                        </Pie>
                                        <RechartsTooltip formatter={(value) => [`â‚¹${value.toLocaleString()}`, 'Amount']} />
                                    </RePieChart>
                                </ResponsiveContainer>
                            </Box>
                        ) : (
                            <Typography color="textSecondary" align="center" sx={{ mt: 8 }}>
                                No expense data available
                            </Typography>
                        )}
                    </Paper>
                </Grid>

                {/* Income Breakdown Pie Chart */}
                <Grid item xs={12} md={6}>
                    <Paper sx={{ p: 2, height: '100%' }}>
                        <Typography variant="h6" gutterBottom>
                            Income Breakdown
                        </Typography>
                        {incomeBreakdown.length > 0 ? (
                            <Box sx={{ height: 300 }}>
                                <ResponsiveContainer width="100%" height="100%">
                                    <RePieChart>
                                        <Pie
                                            data={incomeBreakdown}
                                            cx="50%"
                                            cy="50%"
                                            labelLine={false}
                                            label={({ _id, percentage }) => `${_id}: ${percentage.toFixed(1)}%`}
                                            outerRadius={80}
                                            fill="#8884d8"
                                            dataKey="totalAmount"
                                        >
                                            {incomeBreakdown.map((entry, index) => (
                                                <Cell key={`cell-${index}`} fill={incomeColors[entry._id] || incomeColors.other} />
                                            ))}
                                        </Pie>
                                        <RechartsTooltip formatter={(value) => [`â‚¹${value.toLocaleString()}`, 'Amount']} />
                                    </RePieChart>
                                </ResponsiveContainer>
                            </Box>
                        ) : (
                            <Typography color="textSecondary" align="center" sx={{ mt: 8 }}>
                                No income data available
                            </Typography>
                        )}
                    </Paper>
                </Grid>

                {/* Crop-wise Profit Bar Chart */}
                <Grid item xs={12}>
                    <Paper sx={{ p: 2 }}>
                        <Typography variant="h6" gutterBottom>
                            Crop-wise Profit Analysis
                        </Typography>
                        {cropWiseProfit.length > 0 ? (
                            <Box sx={{ height: 300 }}>
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={cropWiseProfit}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis dataKey="cropName" />
                                        <YAxis />
                                        <RechartsTooltip formatter={(value, name) => [
                                            `â‚¹${value.toLocaleString()}`,
                                            name === 'netProfit' ? 'Profit' : name === 'totalIncome' ? 'Income' : 'Expense'
                                        ]} />
                                        <Legend />
                                        <Bar dataKey="totalIncome" fill="#4CAF50" name="Income" />
                                        <Bar dataKey="totalExpense" fill="#F44336" name="Expense" />
                                        <Bar dataKey="netProfit" fill="#2196F3" name="Profit" />
                                    </BarChart>
                                </ResponsiveContainer>
                            </Box>
                        ) : (
                            <Typography color="textSecondary" align="center" sx={{ mt: 8 }}>
                                No crop profit data available
                            </Typography>
                        )}
                    </Paper>
                </Grid>
            </Grid>
        );
    };

    const renderTransactionTable = () => {
        return (
            <Paper sx={{ p: 2 }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                    <Typography variant="h6">
                        Recent Transactions
                    </Typography>
                    <Button
                        variant="outlined"
                        startIcon={<Download />}
                        onClick={handleExportReport}
                    >
                        Export Report
                    </Button>
                </Box>
                
                <TableContainer>
                    <Table>
                        <TableHead>
                            <TableRow>
                                <TableCell>Date</TableCell>
                                <TableCell>Type</TableCell>
                                <TableCell>Description</TableCell>
                                <TableCell>Category/Source</TableCell>
                                <TableCell align="right">Amount</TableCell>
                                <TableCell>Status</TableCell>
                                <TableCell>Crop</TableCell>
                                <TableCell>Actions</TableCell>
                            </TableRow>
                        </TableHead>
                        <TableBody>
                            {transactions.slice(0, 10).map((transaction) => (
                                <TableRow 
                                    key={transaction._id}
                                    sx={{ 
                                        '&:hover': { backgroundColor: 'action.hover' },
                                        cursor: 'pointer'
                                    }}
                                    onClick={() => {
                                        setSelectedTransaction(transaction);
                                        setDetailsOpen(true);
                                    }}
                                >
                                    <TableCell>
                                        {format(new Date(transaction.transactionDate), 'dd MMM yy')}
                                    </TableCell>
                                    <TableCell>
                                        <Chip 
                                            label={transaction.type} 
                                            size="small"
                                            color={transaction.type === 'income' ? 'success' : 'error'}
                                            variant="outlined"
                                        />
                                    </TableCell>
                                    <TableCell>
                                        <Typography variant="body2">
                                            {transaction.description}
                                        </Typography>
                                        {transaction.party?.name && (
                                            <Typography variant="caption" color="textSecondary">
                                                {transaction.party.name}
                                            </Typography>
                                        )}
                                    </TableCell>
                                    <TableCell>
                                        {transaction.type === 'income' ? transaction.source : transaction.category}
                                    </TableCell>
                                    <TableCell align="right">
                                        <Typography 
                                            variant="body2" 
                                            fontWeight="bold"
                                            color={transaction.type === 'income' ? 'success.main' : 'error.main'}
                                        >
                                            â‚¹{transaction.amount.toLocaleString()}
                                        </Typography>
                                    </TableCell>
                                    <TableCell>
                                        <Chip 
                                            label={transaction.paymentStatus} 
                                            size="small"
                                            color={
                                                transaction.paymentStatus === 'paid' ? 'success' :
                                                transaction.paymentStatus === 'pending' ? 'warning' :
                                                transaction.paymentStatus === 'overdue' ? 'error' : 'default'
                                            }
                                        />
                                    </TableCell>
                                    <TableCell>
                                        {transaction.cropName || '-'}
                                    </TableCell>
                                    <TableCell>
                                        <IconButton 
                                            size="small" 
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                handleMenuClick(e, transaction);
                                            }}
                                        >
                                            <MoreVert />
                                        </IconButton>
                                    </TableCell>
                                </TableRow>
                            ))}
                        </TableBody>
                    </Table>
                </TableContainer>
                
                {transactions.length > 10 && (
                    <Box sx={{ display: 'flex', justifyContent: 'center', mt: 2 }}>
                        <Button variant="text">
                            View All Transactions ({transactions.length})
                        </Button>
                    </Box>
                )}
            </Paper>
        );
    };

    const renderPendingPayments = () => {
        if (pendingPayments.length === 0) {
            return (
                <Paper sx={{ p: 3, textAlign: 'center' }}>
                    <CheckCircle color="success" sx={{ fontSize: 48, mb: 2 }} />
                    <Typography variant="h6" color="success.main">
                        All Clear!
                    </Typography>
                    <Typography color="textSecondary">
                        No pending payments
                    </Typography>
                </Paper>
            );
        }

        return (
            <Paper sx={{ p: 2 }}>
                <Typography variant="h6" gutterBottom>
                    Pending Payments ({pendingPayments.length})
                </Typography>
                <List>
                    {pendingPayments.slice(0, 5).map((payment) => (
                        <React.Fragment key={payment._id}>
                            <ListItem 
                                secondaryAction={
                                    <Button 
                                        size="small" 
                                        variant="outlined"
                                        onClick={() => {
                                            setSelectedTransaction(payment);
                                            setDetailsOpen(true);
                                        }}
                                    >
                                        View
                                    </Button>
                                }
                            >
                                <ListItemText
                                    primary={
                                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                            <Typography variant="body1">
                                                {payment.description}
                                            </Typography>
                                            <Chip 
                                                label={payment.type === 'income' ? 'To Receive' : 'To Pay'} 
                                                size="small"
                                                color={payment.type === 'income' ? 'success' : 'error'}
                                            />
                                        </Box>
                                    }
                                    secondary={
                                        <Box>
                                            <Typography variant="caption" display="block">
                                                {payment.party?.name || 'N/A'}
                                            </Typography>
                                            <Typography variant="caption" color="textSecondary">
                                                Due: {payment.dueDate ? format(new Date(payment.dueDate), 'dd MMM yyyy') : 'N/A'}
                                            </Typography>
                                        </Box>
                                    }
                                />
                                <Typography 
                                    variant="body1" 
                                    fontWeight="bold"
                                    color={payment.type === 'income' ? 'success.main' : 'error.main'}
                                >
                                    â‚¹{payment.amount.toLocaleString()}
                                </Typography>
                            </ListItem>
                            <Divider />
                        </React.Fragment>
                    ))}
                </List>
                
                {pendingPayments.length > 5 && (
                    <Box sx={{ display: 'flex', justifyContent: 'center', mt: 2 }}>
                        <Button variant="text">
                            View All Pending Payments
                        </Button>
                    </Box>
                )}
            </Paper>
        );
    };

    const renderInsights = () => {
        if (insights.length === 0) return null;

        return (
            <Paper sx={{ p: 2, mb: 3 }}>
                <Typography variant="h6" gutterBottom>
                    Financial Insights
                </Typography>
                <Grid container spacing={1}>
                    {insights.map((insight, index) => (
                        <Grid item xs={12} key={index}>
                            <Alert 
                                severity={insight.type === 'warning' ? 'warning' : 'info'}
                                sx={{ mb: 1 }}
                            >
                                {insight.message}
                            </Alert>
                        </Grid>
                    ))}
                </Grid>
            </Paper>
        );
    };

    return (
        <Container maxWidth="xl" sx={{ mt: 4, mb: 4 }}>
            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h4">
                    Financial Dashboard
                </Typography>
                <Button
                    variant="contained"
                    startIcon={<Add />}
                    onClick={() => setShowForm(true)}
                >
                    Add Transaction
                </Button>
            </Box>

            {/* Date Filters */}
            <Paper sx={{ p: 2, mb: 3 }}>
                <Grid container spacing={2} alignItems="center">
                    <Grid item xs={12} md={4}>
                        <LocalizationProvider dateAdapter={AdapterDateFns}>
                            <DatePicker
                                label="Start Date"
                                value={filters.startDate}
                                onChange={(date) => handleFilterChange('startDate', date)}
                                renderInput={(params) => <TextField {...params} fullWidth size="small" />}
                            />
                        </LocalizationProvider>
                    </Grid>
                    
                    <Grid item xs={12} md={4}>
                        <LocalizationProvider dateAdapter={AdapterDateFns}>
                            <DatePicker
                                label="End Date"
                                value={filters.endDate}
                                onChange={(date) => handleFilterChange('endDate', date)}
                                renderInput={(params) => <TextField {...params} fullWidth size="small" />}
                            />
                        </LocalizationProvider>
                    </Grid>
                    
                    <Grid item xs={12} md={4}>
                        <Box sx={{ display: 'flex', gap: 1 }}>
                            <FormControl size="small" sx={{ minWidth: 120 }}>
                                <InputLabel>Type</InputLabel>
                                <Select
                                    value={filters.type}
                                    label="Type"
                                    onChange={(e) => handleFilterChange('type', e.target.value)}
                                >
                                    <MenuItem value="">All Types</MenuItem>
                                    <MenuItem value="income">Income</MenuItem>
                                    <MenuItem value="expense">Expense</MenuItem>
                                </Select>
                            </FormControl>
                            
                            <FormControl size="small" sx={{ minWidth: 120 }}>
                                <InputLabel>Status</InputLabel>
                                <Select
                                    value={filters.paymentStatus}
                                    label="Status"
                                    onChange={(e) => handleFilterChange('paymentStatus', e.target.value)}
                                >
                                    <MenuItem value="">All Status</MenuItem>
                                    <MenuItem value="pending">Pending</MenuItem>
                                    <MenuItem value="paid">Paid</MenuItem>
                                    <MenuItem value="overdue">Overdue</MenuItem>
                                </Select>
                            </FormControl>
                        </Box>
                    </Grid>
                </Grid>
            </Paper>

            {/* Tabs */}
            <Paper sx={{ mb: 3 }}>
                <Tabs 
                    value={activeTab} 
                    onChange={(e, newValue) => setActiveTab(newValue)}
                    variant="scrollable"
                    scrollButtons="auto"
                >
                    <Tab label="Overview" value="overview" icon={<ShowChart />} />
                    <Tab label="Transactions" value="transactions" icon={<Receipt />} />
                    <Tab label="Pending Payments" value="pending" icon={<Payment />} />
                    <Tab label="Analysis" value="analysis" icon={<PieChart />} />
                </Tabs>
            </Paper>

            {loading ? (
                <LinearProgress />
            ) : (
                <>
                    {renderSummaryCards()}
                    
                    {renderInsights()}
                    
                    {activeTab === 'overview' && (
                        <>
                            {renderCharts()}
                            <Box sx={{ mt: 3 }}>
                                {renderTransactionTable()}
                            </Box>
                        </>
                    )}
                    
                    {activeTab === 'transactions' && (
                        <Box sx={{ mt: 3 }}>
                            {renderTransactionTable()}
                        </Box>
                    )}
                    
                    {activeTab === 'pending' && (
                        <Grid container spacing={3}>
                            <Grid item xs={12} md={8}>
                                {renderPendingPayments()}
                            </Grid>
                            <Grid item xs={12} md={4}>
                                <Paper sx={{ p: 2 }}>
                                    <Typography variant="h6" gutterBottom>
                                        Quick Actions
                                    </Typography>
                                    <List>
                                        <ListItem button onClick={() => {
                                            setSelectedTransaction(null);
                                            setShowForm(true);
                                        }}>
                                            <ListItemText primary="Record Expense" secondary="Add new expense record" />
                                        </ListItem>
                                        <ListItem button onClick={() => {
                                            setSelectedTransaction(null);
                                            setShowForm(true);
                                        }}>
                                            <ListItemText primary="Record Income" secondary="Add new income record" />
                                        </ListItem>
                                        <ListItem button onClick={handleExportReport}>
                                            <ListItemText primary="Export Report" secondary="Download financial report" />
                                        </ListItem>
                                    </List>
                                </Paper>
                            </Grid>
                        </Grid>
                    )}
                    
                    {activeTab === 'analysis' && (
                        <Grid container spacing={3}>
                            <Grid item xs={12}>
                                {renderCharts()}
                            </Grid>
                        </Grid>
                    )}
                </>
            )}

            {/* Transaction Form Dialog */}
            <Dialog 
                open={showForm} 
                onClose={() => setShowForm(false)}
                maxWidth="md"
                fullWidth
            >
                <DialogTitle>
                    {selectedTransaction ? 'Edit Transaction' : 'Add New Transaction'}
                </DialogTitle>
                <DialogContent>
                    <TransactionForm 
                        transaction={selectedTransaction}
                        onSuccess={() => {
                            setShowForm(false);
                            setSelectedTransaction(null);
                            fetchFinancialData();
                        }}
                        onCancel={() => {
                            setShowForm(false);
                            setSelectedTransaction(null);
                        }}
                    />
                </DialogContent>
            </Dialog>

            {/* Context Menu */}
            <Menu
                anchorEl={menuAnchor}
                open={Boolean(menuAnchor)}
                onClose={handleMenuClose}
            >
                <MenuItem onClick={() => {
                    setSelectedTransaction(selectedMenuTransaction);
                    setDetailsOpen(true);
                    handleMenuClose();
                }}>
                    <ListItemText primary="View Details" />
                </MenuItem>
                <MenuItem onClick={() => {
                    setSelectedTransaction(selectedMenuTransaction);
                    setShowForm(true);
                    handleMenuClose();
                }}>
                    <ListItemText primary="Edit" />
                </MenuItem>
                {selectedMenuTransaction?.paymentStatus !== 'paid' && (
                    <MenuItem onClick={handleMarkPaid}>
                        <ListItemText primary="Mark as Paid" />
                    </MenuItem>
                )}
                <Divider />
                <MenuItem onClick={handleDeleteTransaction} sx={{ color: 'error.main' }}>
                    <ListItemText primary="Delete" />
                </MenuItem>
            </Menu>

            {/* Transaction Details Dialog */}
            {selectedTransaction && (
                <TransactionDetails 
                    open={detailsOpen}
                    transaction={selectedTransaction}
                    onClose={() => setDetailsOpen(false)}
                    onEdit={() => {
                        setDetailsOpen(false);
                        setShowForm(true);
                    }}
                    onMarkPaid={handleMarkPaid}
                />
            )}
        </Container>
    );
};

export default FinancialDashboard;
-e 
===== FILE: ./src/components/IssueReportForm.js =====

import React, { useState, useEffect } from 'react';
import {
    Dialog,
    DialogTitle,
    DialogContent,
    DialogActions,
    Button,
    TextField,
    Select,
    MenuItem,
    FormControl,
    InputLabel,
    Grid,
    Box,
    Typography,
    Chip,
    IconButton,
    Stepper,
    Step,
    StepLabel,
    RadioGroup,
    FormControlLabel,
    Radio,
    Slider,
    Alert,
    Card,
    CardContent
} from '@mui/material';
import {
    Close,
    CloudUpload,
    CameraAlt,
    BugReport,
    LocalHospital,
    Science,
    Grass,
    CheckCircle
} from '@mui/icons-material';
import { cropHealthService } from '../services/api';

const IssueReportForm = ({ open, onClose, crop, onSuccess }) => {
    const [activeStep, setActiveStep] = useState(0);
    const [formData, setFormData] = useState({
        type: 'disease',
        name: '',
        symptoms: [],
        severity: 'medium',
        affectedArea: 10,
        description: '',
        images: []
    });
    const [possibleDiseases, setPossibleDiseases] = useState([]);
    const [selectedDisease, setSelectedDisease] = useState(null);
    const [uploading, setUploading] = useState(false);

    const steps = ['Basic Info', 'Symptoms', 'Severity', 'Review'];

    const issueTypes = [
        { value: 'disease', label: 'Disease', icon: <LocalHospital /> },
        { value: 'pest', label: 'Pest', icon: <BugReport /> },
        { value: 'nutrient_deficiency', label: 'Nutrient Deficiency', icon: <Science /> },
        { value: 'weed', label: 'Weed', icon: <Grass /> },
        { value: 'other', label: 'Other', icon: <LocalHospital /> }
    ];

    const commonSymptoms = [
        'Yellowing leaves',
        'Brown spots',
        'Wilting',
        'Stunted growth',
        'Leaf curling',
        'Holes in leaves',
        'White powdery coating',
        'Purple leaves',
        'Fruit drop',
        'Root rot',
        'Leaf discoloration',
        'Leaf drop',
        'Distorted growth',
        'Sticky residue',
        'Webbing'
    ];

    useEffect(() => {
        if (formData.symptoms.length > 0 && crop) {
            searchPossibleDiseases();
        }
    }, [formData.symptoms]);

    const searchPossibleDiseases = async () => {
        try {
            const response = await cropHealthService.searchDiseases(
                formData.symptoms,
                crop.cropName
            );
            setPossibleDiseases(response.slice(0, 3));
        } catch (error) {
            console.error('Error searching diseases:', error);
        }
    };

    const handleChange = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
    };

    const handleSymptomToggle = (symptom) => {
        setFormData(prev => ({
            ...prev,
            symptoms: prev.symptoms.includes(symptom)
                ? prev.symptoms.filter(s => s !== symptom)
                : [...prev.symptoms, symptom]
        }));
    };

    const handleImageUpload = async (event) => {
        const file = event.target.files[0];
        if (!file) return;

        setUploading(true);
        // Simulate upload
        setTimeout(() => {
            setFormData(prev => ({
                ...prev,
                images: [...prev.images, {
                    url: URL.createObjectURL(file),
                    filename: file.name,
                    uploadedAt: new Date()
                }]
            }));
            setUploading(false);
        }, 1000);
    };

    const handleSubmit = async () => {
        try {
            await cropHealthService.reportIssue(crop._id, {
                ...formData,
                name: selectedDisease?.name || formData.name || 'Unknown Issue'
            });
            onSuccess();
        } catch (error) {
            console.error('Error reporting issue:', error);
        }
    };

    const renderStepContent = (step) => {
        switch (step) {
            case 0:
                return (
                    <Grid container spacing={3}>
                        <Grid item xs={12}>
                            <Typography variant="subtitle1" gutterBottom>
                                What type of issue are you reporting?
                            </Typography>
                            <RadioGroup
                                row
                                value={formData.type}
                                onChange={(e) => handleChange('type', e.target.value)}
                            >
                                {issueTypes.map(type => (
                                    <FormControlLabel
                                        key={type.value}
                                        value={type.value}
                                        control={<Radio />}
                                        label={
                                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                                {type.icon}
                                                {type.label}
                                            </Box>
                                        }
                                    />
                                ))}
                            </RadioGroup>
                        </Grid>
                        
                        <Grid item xs={12}>
                            <TextField
                                fullWidth
                                label="Issue Name (Optional)"
                                value={formData.name}
                                onChange={(e) => handleChange('name', e.target.value)}
                                placeholder="e.g., Aphid infestation, Blast disease"
                            />
                        </Grid>
                        
                        <Grid item xs={12}>
                            <TextField
                                fullWidth
                                label="Description"
                                multiline
                                rows={3}
                                value={formData.description}
                                onChange={(e) => handleChange('description', e.target.value)}
                                placeholder="Describe what you're seeing in your crop..."
                            />
                        </Grid>
                    </Grid>
                );
                
            case 1:
                return (
                    <Grid container spacing={3}>
                        <Grid item xs={12}>
                            <Typography variant="subtitle1" gutterBottom>
                                Select observed symptoms
                            </Typography>
                            <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1, mb: 3 }}>
                                {commonSymptoms.map(symptom => (
                                    <Chip
                                        key={symptom}
                                        label={symptom}
                                        clickable
                                        color={formData.symptoms.includes(symptom) ? 'primary' : 'default'}
                                        onClick={() => handleSymptomToggle(symptom)}
                                        variant={formData.symptoms.includes(symptom) ? 'filled' : 'outlined'}
                                    />
                                ))}
                            </Box>
                            
                            <TextField
                                fullWidth
                                label="Additional symptoms (comma separated)"
                                placeholder="Add symptoms not listed above"
                                onChange={(e) => {
                                    const newSymptoms = e.target.value.split(',').map(s => s.trim()).filter(s => s);
                                    handleChange('symptoms', [...new Set([...formData.symptoms, ...newSymptoms])]);
                                }}
                            />
                        </Grid>
                        
                        {possibleDiseases.length > 0 && (
                            <Grid item xs={12}>
                                <Alert severity="info" sx={{ mb: 2 }}>
                                    Based on symptoms, possible issues detected
                                </Alert>
                                <Grid container spacing={2}>
                                    {possibleDiseases.map((disease, index) => (
                                        <Grid item xs={12} sm={6} key={index}>
                                            <Card 
                                                variant="outlined"
                                                sx={{ 
                                                    cursor: 'pointer',
                                                    border: selectedDisease?.name === disease.name ? '2px solid #4CAF50' : '1px solid #e0e0e0'
                                                }}
                                                onClick={() => setSelectedDisease(disease)}
                                            >
                                                <CardContent>
                                                    <Typography variant="subtitle1" gutterBottom>
                                                        {disease.name}
                                                    </Typography>
                                                    <Typography variant="caption" color="textSecondary">
                                                        {disease.type} â€¢ {disease.riskLevel} risk
                                                    </Typography>
                                                </CardContent>
                                            </Card>
                                        </Grid>
                                    ))}
                                </Grid>
                            </Grid>
                        )}
                        
                        <Grid item xs={12}>
                            <Typography variant="subtitle1" gutterBottom>
                                Upload Photos (Optional)
                            </Typography>
                            <Box sx={{ border: '2px dashed #ccc', borderRadius: 2, p: 3, textAlign: 'center' }}>
                                <input
                                    accept="image/*"
                                    style={{ display: 'none' }}
                                    id="image-upload"
                                    type="file"
                                    onChange={handleImageUpload}
                                />
                                <label htmlFor="image-upload">
                                    <IconButton component="span" disabled={uploading}>
                                        <CloudUpload sx={{ fontSize: 48, color: 'primary.main' }} />
                                    </IconButton>
                                </label>
                                <Typography color="textSecondary">
                                    Click to upload or drag and drop
                                </Typography>
                                <Typography variant="caption" color="textSecondary">
                                    JPG, PNG up to 5MB
                                </Typography>
                            </Box>
                            
                            {formData.images.length > 0 && (
                                <Box sx={{ mt: 2, display: 'flex', gap: 1, flexWrap: 'wrap' }}>
                                    {formData.images.map((image, index) => (
                                        <Box key={index} sx={{ position: 'relative' }}>
                                            <img
                                                src={image.url}
                                                alt={image.filename}
                                                style={{ width: 80, height: 80, objectFit: 'cover', borderRadius: 4 }}
                                            />
                                            <IconButton
                                                size="small"
                                                sx={{ position: 'absolute', top: -8, right: -8, bgcolor: 'white' }}
                                                onClick={() => handleChange('images', formData.images.filter((_, i) => i !== index))}
                                            >
                                                <Close fontSize="small" />
                                            </IconButton>
                                        </Box>
                                    ))}
                                </Box>
                            )}
                        </Grid>
                    </Grid>
                );
                
            case 2:
                return (
                    <Grid container spacing={3}>
                        <Grid item xs={12}>
                            <Typography variant="subtitle1" gutterBottom>
                                How severe is the issue?
                            </Typography>
                            <RadioGroup
                                value={formData.severity}
                                onChange={(e) => handleChange('severity', e.target.value)}
                            >
                                <FormControlLabel 
                                    value="low" 
                                    control={<Radio />} 
                                    label={
                                        <Box>
                                            <Typography>Low Severity</Typography>
                                            <Typography variant="caption" color="textSecondary">
                                                Minor issue, affecting less than 10% of crop
                                            </Typography>
                                        </Box>
                                    } 
                                />
                                <FormControlLabel 
                                    value="medium" 
                                    control={<Radio />} 
                                    label={
                                        <Box>
                                            <Typography>Medium Severity</Typography>
                                            <Typography variant="caption" color="textSecondary">
                                                Significant issue, affecting 10-30% of crop
                                            </Typography>
                                        </Box>
                                    } 
                                />
                                <FormControlLabel 
                                    value="high" 
                                    control={<Radio />} 
                                    label={
                                        <Box>
                                            <Typography>High Severity</Typography>
                                            <Typography variant="caption" color="textSecondary">
                                                Serious issue, affecting 30-60% of crop
                                            </Typography>
                                        </Box>
                                    } 
                                />
                                <FormControlLabel 
                                    value="critical" 
                                    control={<Radio />} 
                                    label={
                                        <Box>
                                            <Typography>Critical Severity</Typography>
                                            <Typography variant="caption" color="textSecondary">
                                                Emergency, affecting more than 60% of crop
                                            </Typography>
                                        </Box>
                                    } 
                                />
                            </RadioGroup>
                        </Grid>
                        
                        <Grid item xs={12}>
                            <Typography variant="subtitle1" gutterBottom>
                                Affected Area: {formData.affectedArea}%
                            </Typography>
                            <Slider
                                value={formData.affectedArea}
                                onChange={(e, value) => handleChange('affectedArea', value)}
                                min={1}
                                max={100}
                                valueLabelDisplay="auto"
                                marks={[
                                    { value: 10, label: '10%' },
                                    { value: 30, label: '30%' },
                                    { value: 60, label: '60%' },
                                    { value: 100, label: '100%' }
                                ]}
                            />
                        </Grid>
                    </Grid>
                );
                
            case 3:
                return (
                    <Box>
                        <Typography variant="h6" gutterBottom>
                            Review Issue Report
                        </Typography>
                        
                        <Grid container spacing={2} sx={{ mt: 2 }}>
                            <Grid item xs={12} md={6}>
                                <Typography variant="subtitle2" color="textSecondary">
                                    Basic Information
                                </Typography>
                                <Typography>
                                    {selectedDisease?.name || formData.name || 'Unnamed Issue'}
                                </Typography>
                                <Typography color="textSecondary">
                                    Type: {formData.type} â€¢ Severity: {formData.severity}
                                </Typography>
                            </Grid>
                            
                            <Grid item xs={12} md={6}>
                                <Typography variant="subtitle2" color="textSecondary">
                                    Impact
                                </Typography>
                                <Typography>
                                    Affected Area: {formData.affectedArea}%
                                </Typography>
                                <Typography color="textSecondary">
                                    Symptoms: {formData.symptoms.slice(0, 3).join(', ')}
                                    {formData.symptoms.length > 3 && '...'}
                                </Typography>
                            </Grid>
                            
                            {selectedDisease && (
                                <Grid item xs={12}>
                                    <Alert severity="info">
                                        <Typography variant="subtitle2">
                                            Auto-detected: {selectedDisease.name}
                                        </Typography>
                                        <Typography variant="body2">
                                            Recommended treatment: {selectedDisease.treatments?.[0] || 'Consult agriculture officer'}
                                        </Typography>
                                    </Alert>
                                </Grid>
                            )}
                            
                            {formData.description && (
                                <Grid item xs={12}>
                                    <Typography variant="subtitle2" color="textSecondary">
                                        Description
                                    </Typography>
                                    <Typography>{formData.description}</Typography>
                                </Grid>
                            )}
                        </Grid>
                    </Box>
                );
                
            default:
                return null;
        }
    };

    return (
        <Dialog open={open} onClose={onClose} maxWidth="md" fullWidth>
            <DialogTitle>
                Report Crop Issue
                {crop && (
                    <Typography variant="caption" display="block" color="textSecondary">
                        Crop: {crop.cropName} â€¢ Field: {crop.fieldName || 'Not specified'}
                    </Typography>
                )}
            </DialogTitle>
            
            <DialogContent>
                <Stepper activeStep={activeStep} sx={{ my: 3 }}>
                    {steps.map((label) => (
                        <Step key={label}>
                            <StepLabel>{label}</StepLabel>
                        </Step>
                    ))}
                </Stepper>
                
                {renderStepContent(activeStep)}
            </DialogContent>
            
            <DialogActions sx={{ p: 3 }}>
                <Button
                    disabled={activeStep === 0}
                    onClick={() => setActiveStep(activeStep - 1)}
                >
                    Back
                </Button>
                
                <Box sx={{ flexGrow: 1 }} />
                
                {activeStep < steps.length - 1 ? (
                    <Button
                        variant="contained"
                        onClick={() => setActiveStep(activeStep + 1)}
                        disabled={formData.symptoms.length === 0}
                    >
                        Next
                    </Button>
                ) : (
                    <Button
                        variant="contained"
                        onClick={handleSubmit}
                        startIcon={<CheckCircle />}
                    >
                        Submit Report
                    </Button>
                )}
            </DialogActions>
        </Dialog>
    );
};

export default IssueReportForm;
-e 
===== FILE: ./src/components/CropHealthDashboard.js =====

import React, { useState, useEffect } from 'react';
import {
    Container,
    Paper,
    Typography,
    Grid,
    Card,
    CardContent,
    Button,
    Chip,
    IconButton,
    Dialog,
    DialogTitle,
    DialogContent,
    DialogActions,
    TextField,
    Select,
    MenuItem,
    FormControl,
    InputLabel,
    Box,
    Tabs,
    Tab,
    Table,
    TableBody,
    TableCell,
    TableContainer,
    TableHead,
    TableRow,
    Badge,
    Alert,
    LinearProgress,
    Tooltip,
    Menu,
    List,
    ListItem,
    ListItemText,
    Divider,
    Avatar,
    Stepper,
    Step,
    StepLabel,
    CardActionArea,
    RadioGroup,
    FormControlLabel,
    Radio,
    Checkbox,
    Fab,
    ListItemIcon
} from '@mui/material';
import {
    Add,
    Edit,
    Delete,
    HealthAndSafety,
    Warning,
    CheckCircle,
    Error,
    Science,
    Agriculture,
    BugReport,
    WaterDrop,
    Spa,
    LocalFlorist,
    TrendingUp,
    TrendingDown,
    Visibility,
    PhotoCamera,
    Upload,
    Search,
    FilterList,
    Download,
    MoreVert,
    Info,
    History,
    ShowChart,
    LocalHospital,
    Grass,
    Eco
} from '@mui/icons-material';
import { DatePicker } from '@mui/x-date-pickers/DatePicker';
import { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';
import { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns';
import { format, differenceInDays } from 'date-fns';
import { cropHealthService } from '../services/api';
import IssueReportForm from './IssueReportForm';
import { 
    LineChart, Line, BarChart, Bar, PieChart, Pie, Cell, 
    XAxis, YAxis, CartesianGrid, Tooltip as RechartsTooltip, 
    Legend, ResponsiveContainer, RadarChart, Radar, PolarGrid, 
    PolarAngleAxis, PolarRadiusAxis 
} from 'recharts';

const AIDiagnosisDialog = ({ open, onClose, crop }) => {
    return (
        <Dialog open={open} onClose={onClose}>
            <DialogTitle>AI Diagnosis</DialogTitle>
            <DialogContent>
                <Typography>
                    AI Diagnosis feature coming soon.
                </Typography>
            </DialogContent>
            <DialogActions>
                <Button onClick={onClose}>Close</Button>
            </DialogActions>
        </Dialog>
    );
};

const CropHealthDashboard = () => {
    const [cropHealthRecords, setCropHealthRecords] = useState([]);
    const [stats, setStats] = useState({});
    const [loading, setLoading] = useState(true);
    const [activeTab, setActiveTab] = useState('overview');
    const [selectedCrop, setSelectedCrop] = useState(null);
    const [detailsOpen, setDetailsOpen] = useState(false);
    const [reportIssueOpen, setReportIssueOpen] = useState(false);
    const [aiDiagnosisOpen, setAiDiagnosisOpen] = useState(false);
    const [filters, setFilters] = useState({
        status: '',
        crop: '',
        needsAttention: false
    });
    const [menuAnchor, setMenuAnchor] = useState(null);
    const [selectedMenuRecord, setSelectedMenuRecord] = useState(null);
    const [symptoms, setSymptoms] = useState([]);
    const [aiResult, setAiResult] = useState(null);

    // Health status colors
    const healthColors = {
        healthy: '#4CAF50',
        warning: '#FF9800',
        critical: '#F44336',
        recovering: '#2196F3'
    };

    // Severity colors
    const severityColors = {
        low: '#4CAF50',
        medium: '#FF9800',
        high: '#F44336',
        critical: '#D32F2F'
    };

    // Common symptoms for quick selection
    const commonSymptoms = [
        { label: 'Yellowing leaves', type: 'nutrient' },
        { label: 'Brown spots', type: 'fungal' },
        { label: 'Wilting', type: 'water' },
        { label: 'Stunted growth', type: 'nutrient' },
        { label: 'Leaf curling', type: 'pest' },
        { label: 'Holes in leaves', type: 'pest' },
        { label: 'White powdery coating', type: 'fungal' },
        { label: 'Purple leaves', type: 'nutrient' },
        { label: 'Fruit drop', type: 'physiological' },
        { label: 'Root rot', type: 'fungal' }
    ];

    // Growth stage icons
    const growthStageIcons = {
        sowing: <Grass />,
        germination: <Eco />,
        vegetative: <LocalFlorist />,
        flowering: <Spa />,
        fruiting: <Agriculture />,
        harvesting: <Agriculture />,
        default: <HealthAndSafety />
    };

    useEffect(() => {
        fetchCropHealthData();
    }, [filters]);

    const fetchCropHealthData = async () => {
        setLoading(true);
        try {
            const response = await cropHealthService.getCropHealth(filters);
            setCropHealthRecords(response.cropHealthRecords);
            setStats(response.stats);
        } catch (error) {
            console.error('Error fetching crop health data:', error);
        } finally {
            setLoading(false);
        }
    };

    const handleFilterChange = (field, value) => {
        setFilters(prev => ({ ...prev, [field]: value }));
    };

    const handleMenuClick = (event, record) => {
        setMenuAnchor(event.currentTarget);
        setSelectedMenuRecord(record);
    };

    const handleMenuClose = () => {
        setMenuAnchor(null);
        setSelectedMenuRecord(null);
    };

    const handleReportIssue = () => {
        if (selectedMenuRecord) {
            setSelectedCrop(selectedMenuRecord);
            setReportIssueOpen(true);
        }
        handleMenuClose();
    };

    const handleAIDiagnosis = () => {
        if (selectedMenuRecord) {
            setSelectedCrop(selectedMenuRecord);
            setAiDiagnosisOpen(true);
        }
        handleMenuClose();
    };

    const handleViewDetails = () => {
        if (selectedMenuRecord) {
            setSelectedCrop(selectedMenuRecord);
            setDetailsOpen(true);
        }
        handleMenuClose();
    };

    const getHealthIcon = (status) => {
        switch (status) {
            case 'healthy':
                return <CheckCircle color="success" />;
            case 'warning':
                return <Warning color="warning" />;
            case 'critical':
                return <Error color="error" />;
            default:
                return <HealthAndSafety />;
        }
    };

    const renderStatsCards = () => {
        return (
            <Grid container spacing={2} sx={{ mb: 3 }}>
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <HealthAndSafety color="primary" />
                                <Typography color="textSecondary" variant="caption">
                                    Total Crops
                                </Typography>
                            </Box>
                            <Typography variant="h5">{stats.totalCrops || 0}</Typography>
                        </CardContent>
                    </Card>
                </Grid>
                
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <CheckCircle color="success" />
                                <Typography color="textSecondary" variant="caption">
                                    Healthy
                                </Typography>
                            </Box>
                            <Typography variant="h5" color="success.main">
                                {stats.healthy || 0}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
                
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <Warning color="warning" />
                                <Typography color="textSecondary" variant="caption">
                                    Warning
                                </Typography>
                            </Box>
                            <Typography variant="h5" color="warning.main">
                                {stats.warning || 0}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
                
                <Grid item xs={6} sm={3}>
                    <Card>
                        <CardContent>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                                <Error color="error" />
                                <Typography color="textSecondary" variant="caption">
                                    Critical
                                </Typography>
                            </Box>
                            <Typography variant="h5" color="error.main">
                                {stats.critical || 0}
                            </Typography>
                        </CardContent>
                    </Card>
                </Grid>
            </Grid>
        );
    };

    const renderCropHealthCard = (record) => {
        const activeIssues = record.issues?.filter(i => i.status !== 'resolved') || [];
        const pendingAlerts = record.alerts?.filter(a => !a.acknowledged) || [];
        
        return (
            <Grid item xs={12} sm={6} md={4} key={record._id}>
                <Card 
                    variant="outlined"
                    sx={{ 
                        height: '100%',
                        borderLeft: `4px solid ${healthColors[record.healthStatus]}`,
                        '&:hover': {
                            boxShadow: 2,
                            transform: 'translateY(-2px)',
                            transition: 'all 0.2s'
                        }
                    }}
                >
                    <CardActionArea onClick={() => {
                        setSelectedCrop(record);
                        setDetailsOpen(true);
                    }}>
                        <CardContent>
                            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 2 }}>
                                <Box>
                                    <Typography variant="h6" gutterBottom>
                                        {record.cropName}
                                    </Typography>
                                    <Typography variant="body2" color="textSecondary">
                                        {record.cropVariety} â€¢ {record.area} acres
                                    </Typography>
                                </Box>
                                
                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                    {getHealthIcon(record.healthStatus)}
                                    <Typography 
                                        variant="caption" 
                                        fontWeight="bold"
                                        color={healthColors[record.healthStatus]}
                                    >
                                        {record.healthStatus.toUpperCase()}
                                    </Typography>
                                </Box>
                            </Box>
                            
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 2 }}>
                                {growthStageIcons[record.growthStage] || growthStageIcons.default}
                                <Typography variant="body2" color="textSecondary">
                                    {record.growthStage} â€¢ Score: {record.healthScore}
                                </Typography>
                            </Box>
                            
                            {/* Active Issues */}
                            {activeIssues.length > 0 && (
                                <Box sx={{ mb: 2 }}>
                                    <Typography variant="subtitle2" color="textSecondary" gutterBottom>
                                        Active Issues:
                                    </Typography>
                                    <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}>
                                        {activeIssues.slice(0, 3).map((issue, index) => (
                                            <Chip
                                                key={index}
                                                label={issue.name}
                                                size="small"
                                                color={severityColors[issue.severity]}
                                                variant="outlined"
                                            />
                                        ))}
                                        {activeIssues.length > 3 && (
                                            <Chip
                                                label={`+${activeIssues.length - 3}`}
                                                size="small"
                                            />
                                        )}
                                    </Box>
                                </Box>
                            )}
                            
                            {/* Pending Alerts */}
                            {pendingAlerts.length > 0 && (
                                <Alert severity="warning" sx={{ mb: 2, py: 0 }}>
                                    <Typography variant="caption">
                                        {pendingAlerts.length} pending alert{pendingAlerts.length > 1 ? 's' : ''}
                                    </Typography>
                                </Alert>
                            )}
                            
                            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                <Typography variant="caption" color="textSecondary">
                                    Last checked: {format(new Date(record.lastChecked), 'dd MMM')}
                                </Typography>
                                
                                <IconButton 
                                    size="small" 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        handleMenuClick(e, record);
                                    }}
                                >
                                    <MoreVert />
                                </IconButton>
                            </Box>
                        </CardContent>
                    </CardActionArea>
                </Card>
            </Grid>
        );
    };

    const renderHealthOverview = () => {
        const healthData = [
            { status: 'Healthy', count: stats.healthy || 0, color: '#4CAF50' },
            { status: 'Warning', count: stats.warning || 0, color: '#FF9800' },
            { status: 'Critical', count: stats.critical || 0, color: '#F44336' }
        ].filter(item => item.count > 0);

        const issueData = cropHealthRecords.flatMap(record => 
            record.issues?.filter(i => i.status !== 'resolved') || []
        ).reduce((acc, issue) => {
            acc[issue.type] = (acc[issue.type] || 0) + 1;
            return acc;
        }, {});

        const issueChartData = Object.entries(issueData).map(([type, count]) => ({
            type,
            count,
            color: type === 'disease' ? '#F44336' : 
                   type === 'pest' ? '#FF9800' : 
                   type === 'nutrient_deficiency' ? '#2196F3' : '#757575'
        }));

        return (
            <Grid container spacing={3}>
                {/* Health Distribution */}
                <Grid item xs={12} md={6}>
                    <Paper sx={{ p: 2, height: '100%' }}>
                        <Typography variant="h6" gutterBottom>
                            Health Distribution
                        </Typography>
                        {healthData.length > 0 ? (
                            <Box sx={{ height: 300 }}>
                                <ResponsiveContainer width="100%" height="100%">
                                    <PieChart>
                                        <Pie
                                            data={healthData}
                                            cx="50%"
                                            cy="50%"
                                            labelLine={false}
                                            label={({ status, percent }) => `${status}: ${(percent * 100).toFixed(0)}%`}
                                            outerRadius={80}
                                            fill="#8884d8"
                                            dataKey="count"
                                        >
                                            {healthData.map((entry, index) => (
                                                <Cell key={`cell-${index}`} fill={entry.color} />
                                            ))}
                                        </Pie>
                                        <RechartsTooltip formatter={(value) => [value, 'Crops']} />
                                    </PieChart>
                                </ResponsiveContainer>
                            </Box>
                        ) : (
                            <Typography color="textSecondary" align="center" sx={{ mt: 8 }}>
                                No health data available
                            </Typography>
                        )}
                    </Paper>
                </Grid>

                {/* Issue Types */}
                <Grid item xs={12} md={6}>
                    <Paper sx={{ p: 2, height: '100%' }}>
                        <Typography variant="h6" gutterBottom>
                            Active Issue Types
                        </Typography>
                        {issueChartData.length > 0 ? (
                            <Box sx={{ height: 300 }}>
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={issueChartData}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis dataKey="type" />
                                        <YAxis />
                                        <RechartsTooltip />
                                        <Bar dataKey="count" fill="#8884d8">
                                            {issueChartData.map((entry, index) => (
                                                <Cell key={`cell-${index}`} fill={entry.color} />
                                            ))}
                                        </Bar>
                                    </BarChart>
                                </ResponsiveContainer>
                            </Box>
                        ) : (
                            <Typography color="textSecondary" align="center" sx={{ mt: 8 }}>
                                No active issues
                            </Typography>
                        )}
                    </Paper>
                </Grid>

                {/* Crops Needing Attention */}
                <Grid item xs={12}>
                    <Paper sx={{ p: 2 }}>
                        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                            <Typography variant="h6">
                                Crops Needing Attention
                            </Typography>
                            <Badge badgeContent={stats.activeIssues || 0} color="error">
                                <Warning color="action" />
                            </Badge>
                        </Box>
                        
                        {cropHealthRecords.filter(r => r.healthStatus !== 'healthy').length > 0 ? (
                            <TableContainer>
                                <Table size="small">
                                    <TableHead>
                                        <TableRow>
                                            <TableCell>Crop</TableCell>
                                            <TableCell>Health Status</TableCell>
                                            <TableCell>Active Issues</TableCell>
                                            <TableCell>Growth Stage</TableCell>
                                            <TableCell>Last Checked</TableCell>
                                            <TableCell>Actions</TableCell>
                                        </TableRow>
                                    </TableHead>
                                    <TableBody>
                                        {cropHealthRecords
                                            .filter(r => r.healthStatus !== 'healthy')
                                            .slice(0, 5)
                                            .map((record) => (
                                                <TableRow key={record._id}>
                                                    <TableCell>
                                                        <Typography fontWeight="bold">
                                                            {record.cropName}
                                                        </Typography>
                                                        <Typography variant="caption" color="textSecondary">
                                                            {record.fieldName || 'No field'}
                                                        </Typography>
                                                    </TableCell>
                                                    <TableCell>
                                                        <Chip 
                                                            label={record.healthStatus} 
                                                            size="small"
                                                            sx={{ 
                                                                bgcolor: `${healthColors[record.healthStatus]}15`,
                                                                color: healthColors[record.healthStatus]
                                                            }}
                                                        />
                                                    </TableCell>
                                                    <TableCell>
                                                        {record.issues?.filter(i => i.status !== 'resolved').length || 0}
                                                    </TableCell>
                                                    <TableCell>
                                                        {record.growthStage}
                                                    </TableCell>
                                                    <TableCell>
                                                        {format(new Date(record.lastChecked), 'dd MMM')}
                                                    </TableCell>
                                                    <TableCell>
                                                        <Button 
                                                            size="small" 
                                                            variant="outlined"
                                                            onClick={() => {
                                                                setSelectedCrop(record);
                                                                setDetailsOpen(true);
                                                            }}
                                                        >
                                                            View
                                                        </Button>
                                                    </TableCell>
                                                </TableRow>
                                            ))}
                                    </TableBody>
                                </Table>
                            </TableContainer>
                        ) : (
                            <Alert severity="success">
                                All crops are healthy! No attention needed.
                            </Alert>
                        )}
                    </Paper>
                </Grid>
            </Grid>
        );
    };

    const renderCropDetails = () => {
        if (!selectedCrop) return null;

        const activeIssues = selectedCrop.issues?.filter(i => i.status !== 'resolved') || [];
        const resolvedIssues = selectedCrop.issues?.filter(i => i.status === 'resolved') || [];
        const pendingAlerts = selectedCrop.alerts?.filter(a => !a.acknowledged) || [];

        return (
            <Dialog open={detailsOpen} onClose={() => setDetailsOpen(false)} maxWidth="lg" fullWidth>
                <DialogTitle>
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                        <Typography variant="h5">
                            {selectedCrop.cropName} - Health Details
                        </Typography>
                        <Box>
                            <IconButton onClick={() => {
                                setDetailsOpen(false);
                                setReportIssueOpen(true);
                            }}>
                                <Add />
                            </IconButton>
                        </Box>
                    </Box>
                </DialogTitle>
                
                <DialogContent>
                    <Tabs value={activeTab} onChange={(e, newValue) => setActiveTab(newValue)} sx={{ mb: 3 }}>
                        <Tab label="Overview" value="overview" />
                        <Tab label="Issues" value="issues" />
                        <Tab label="Nutrients" value="nutrients" />
                        <Tab label="Alerts" value="alerts" />
                        <Tab label="History" value="history" />
                    </Tabs>

                    {activeTab === 'overview' && (
                        <Grid container spacing={3}>
                            <Grid item xs={12} md={4}>
                                <Card>
                                    <CardContent>
                                        <Typography variant="h6" gutterBottom>
                                            Health Summary
                                        </Typography>
                                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 3 }}>
                                            <Box sx={{ 
                                                width: 80, 
                                                height: 80, 
                                                borderRadius: '50%',
                                                bgcolor: `${healthColors[selectedCrop.healthStatus]}15`,
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center'
                                            }}>
                                                <Typography variant="h4" color={healthColors[selectedCrop.healthStatus]}>
                                                    {selectedCrop.healthScore}
                                                </Typography>
                                            </Box>
                                            <Box>
                                                <Typography variant="h6">
                                                    {selectedCrop.healthStatus.toUpperCase()}
                                                </Typography>
                                                <Typography color="textSecondary">
                                                    Growth: {selectedCrop.growthStage}
                                                </Typography>
                                                <Typography color="textSecondary">
                                                    Last checked: {format(new Date(selectedCrop.lastChecked), 'PP')}
                                                </Typography>
                                            </Box>
                                        </Box>

                                        <Divider sx={{ my: 2 }} />

                                        <Typography variant="subtitle2" gutterBottom>
                                            Quick Stats
                                        </Typography>
                                        <Grid container spacing={1}>
                                            <Grid item xs={6}>
                                                <Typography variant="caption" color="textSecondary">
                                                    Active Issues
                                                </Typography>
                                                <Typography variant="h6" color="error.main">
                                                    {activeIssues.length}
                                                </Typography>
                                            </Grid>
                                            <Grid item xs={6}>
                                                <Typography variant="caption" color="textSecondary">
                                                    Pending Alerts
                                                </Typography>
                                                <Typography variant="h6" color="warning.main">
                                                    {pendingAlerts.length}
                                                </Typography>
                                            </Grid>
                                        </Grid>
                                    </CardContent>
                                </Card>
                            </Grid>

                            <Grid item xs={12} md={8}>
                                <Paper sx={{ p: 2 }}>
                                    <Typography variant="h6" gutterBottom>
                                        Active Issues
                                    </Typography>
                                    {activeIssues.length > 0 ? (
                                        <List>
                                            {activeIssues.map((issue, index) => (
                                                <React.Fragment key={index}>
                                                    <ListItem
                                                        secondaryAction={
                                                            <Button 
                                                                size="small" 
                                                                variant="outlined"
                                                                onClick={() => {
                                                                    // View treatment options
                                                                }}
                                                            >
                                                                Treat
                                                            </Button>
                                                        }
                                                    >
                                                        <ListItemIcon>
                                                            {issue.type === 'disease' ? <LocalHospital /> :
                                                             issue.type === 'pest' ? <BugReport /> :
                                                             <Science />}
                                                        </ListItemIcon>
                                                        <ListItemText
                                                            primary={
                                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                                                    <Typography variant="body1" fontWeight="bold">
                                                                        {issue.name}
                                                                    </Typography>
                                                                    <Chip 
                                                                        label={issue.severity} 
                                                                        size="small"
                                                                        color={severityColors[issue.severity]}
                                                                    />
                                                                </Box>
                                                            }
                                                            secondary={
                                                                <Box>
                                                                    <Typography variant="caption" display="block">
                                                                        Detected: {format(new Date(issue.detectedDate), 'dd MMM yyyy')}
                                                                    </Typography>
                                                                    <Typography variant="caption" color="textSecondary">
                                                                        Affected area: {issue.affectedArea}%
                                                                    </Typography>
                                                                </Box>
                                                            }
                                                        />
                                                    </ListItem>
                                                    <Divider />
                                                </React.Fragment>
                                            ))}
                                        </List>
                                    ) : (
                                        <Alert severity="success">
                                            No active issues. Crop is healthy!
                                        </Alert>
                                    )}
                                </Paper>
                            </Grid>
                        </Grid>
                    )}

                    {activeTab === 'issues' && (
                        <Box>
                            <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 2 }}>
                                <Typography variant="h6">
                                    All Issues ({selectedCrop.issues?.length || 0})
                                </Typography>
                                <Button
                                    variant="contained"
                                    startIcon={<Add />}
                                    onClick={() => {
                                        setDetailsOpen(false);
                                        setReportIssueOpen(true);
                                    }}
                                >
                                    Report New Issue
                                </Button>
                            </Box>
                            
                            {selectedCrop.issues && selectedCrop.issues.length > 0 ? (
                                <TableContainer>
                                    <Table>
                                        <TableHead>
                                            <TableRow>
                                                <TableCell>Issue</TableCell>
                                                <TableCell>Type</TableCell>
                                                <TableCell>Severity</TableCell>
                                                <TableCell>Detected</TableCell>
                                                <TableCell>Status</TableCell>
                                                <TableCell>Actions</TableCell>
                                            </TableRow>
                                        </TableHead>
                                        <TableBody>
                                            {selectedCrop.issues.map((issue, index) => (
                                                <TableRow key={index}>
                                                    <TableCell>
                                                        <Typography fontWeight="bold">
                                                            {issue.name}
                                                        </Typography>
                                                        <Typography variant="caption" color="textSecondary">
                                                            {issue.symptoms?.slice(0, 2).join(', ')}
                                                        </Typography>
                                                    </TableCell>
                                                    <TableCell>
                                                        <Chip 
                                                            label={issue.type} 
                                                            size="small"
                                                            variant="outlined"
                                                        />
                                                    </TableCell>
                                                    <TableCell>
                                                        <Chip 
                                                            label={issue.severity} 
                                                            size="small"
                                                            sx={{ 
                                                                bgcolor: `${severityColors[issue.severity]}15`,
                                                                color: severityColors[issue.severity]
                                                            }}
                                                        />
                                                    </TableCell>
                                                    <TableCell>
                                                        {format(new Date(issue.detectedDate), 'dd MMM yy')}
                                                    </TableCell>
                                                    <TableCell>
                                                        <Chip 
                                                            label={issue.status} 
                                                            size="small"
                                                            color={issue.status === 'resolved' ? 'success' : 'warning'}
                                                        />
                                                    </TableCell>
                                                    <TableCell>
                                                        <Button size="small">View</Button>
                                                    </TableCell>
                                                </TableRow>
                                            ))}
                                        </TableBody>
                                    </Table>
                                </TableContainer>
                            ) : (
                                <Paper sx={{ p: 4, textAlign: 'center' }}>
                                    <HealthAndSafety sx={{ fontSize: 48, color: 'success.main', mb: 2 }} />
                                    <Typography variant="h6" color="success.main">
                                        No Issues Reported
                                    </Typography>
                                    <Typography color="textSecondary" sx={{ mb: 2 }}>
                                        Your crop is healthy and free from issues
                                    </Typography>
                                    <Button
                                        variant="contained"
                                        startIcon={<Add />}
                                        onClick={() => {
                                            setDetailsOpen(false);
                                            setReportIssueOpen(true);
                                        }}
                                    >
                                        Report First Issue
                                    </Button>
                                </Paper>
                            )}
                        </Box>
                    )}

                    {activeTab === 'nutrients' && (
                        <Paper sx={{ p: 2 }}>
                            <Typography variant="h6" gutterBottom>
                                Nutrient Status
                            </Typography>
                            <Grid container spacing={2}>
                                {Object.entries(selectedCrop.nutrientStatus || {}).map(([nutrient, data]) => (
                                    <Grid item xs={12} sm={6} md={4} key={nutrient}>
                                        <Card variant="outlined">
                                            <CardContent>
                                                <Typography variant="subtitle1" gutterBottom>
                                                    {nutrient.charAt(0).toUpperCase() + nutrient.slice(1)}
                                                </Typography>
                                                <Chip 
                                                    label={data.level} 
                                                    size="small"
                                                    color={
                                                        data.level === 'deficient' ? 'error' :
                                                        data.level === 'low' ? 'warning' :
                                                        data.level === 'adequate' ? 'success' : 'default'
                                                    }
                                                    sx={{ mb: 1 }}
                                                />
                                                {data.recommendedFertilizer && (
                                                    <Typography variant="body2" color="textSecondary">
                                                        {data.recommendedFertilizer}: {data.dosage}
                                                    </Typography>
                                                )}
                                                {data.lastTested && (
                                                    <Typography variant="caption" color="textSecondary">
                                                        Tested: {format(new Date(data.lastTested), 'dd MMM yy')}
                                                    </Typography>
                                                )}
                                            </CardContent>
                                        </Card>
                                    </Grid>
                                ))}
                            </Grid>
                            
                            <Box sx={{ mt: 3 }}>
                                <Typography variant="subtitle1" gutterBottom>
                                    Check for Nutrient Deficiency
                                </Typography>
                                <Alert severity="info">
                                    Select symptoms to check for possible nutrient deficiencies
                                </Alert>
                                {/* Add symptom selection UI here */}
                            </Box>
                        </Paper>
                    )}
                </DialogContent>
                
                <DialogActions>
                    <Button onClick={() => setDetailsOpen(false)}>Close</Button>
                </DialogActions>
            </Dialog>
        );
    };

    return (
        <Container maxWidth="xl" sx={{ mt: 4, mb: 4 }}>
            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h4">
                    Crop Health Management
                </Typography>
                <Box sx={{ display: 'flex', gap: 1 }}>
                    <Button
                        variant="outlined"
                        startIcon={<Upload />}
                        onClick={() => setAiDiagnosisOpen(true)}
                    >
                        AI Diagnosis
                    </Button>
                    <Button
                        variant="contained"
                        startIcon={<Add />}
                        onClick={() => setReportIssueOpen(true)}
                    >
                        Report Issue
                    </Button>
                </Box>
            </Box>

            {renderStatsCards()}

            {/* Filters */}
            <Paper sx={{ p: 2, mb: 3 }}>
                <Grid container spacing={2} alignItems="center">
                    <Grid item xs={12} md={4}>
                        <FormControl size="small" fullWidth>
                            <InputLabel>Health Status</InputLabel>
                            <Select
                                value={filters.status}
                                label="Health Status"
                                onChange={(e) => handleFilterChange('status', e.target.value)}
                            >
                                <MenuItem value="">All Status</MenuItem>
                                <MenuItem value="healthy">Healthy</MenuItem>
                                <MenuItem value="warning">Warning</MenuItem>
                                <MenuItem value="critical">Critical</MenuItem>
                            </Select>
                        </FormControl>
                    </Grid>
                    
                    <Grid item xs={12} md={4}>
                        <FormControlLabel
                            control={
                                <Checkbox
                                    checked={filters.needsAttention}
                                    onChange={(e) => handleFilterChange('needsAttention', e.target.checked)}
                                />
                            }
                            label="Show only crops needing attention"
                        />
                    </Grid>
                    
                    <Grid item xs={12} md={4}>
                        <Tabs 
                            value={activeTab} 
                            onChange={(e, newValue) => setActiveTab(newValue)}
                            variant="scrollable"
                            scrollButtons="auto"
                        >
                            <Tab label="Overview" value="overview" />
                            <Tab label="All Crops" value="all" />
                            <Tab label="Critical" value="critical" />
                            <Tab label="History" value="history" />
                        </Tabs>
                    </Grid>
                </Grid>
            </Paper>

            {loading ? (
                <LinearProgress />
            ) : activeTab === 'overview' ? (
                renderHealthOverview()
            ) : (
                <Grid container spacing={2}>
                    {cropHealthRecords.map(renderCropHealthCard)}
                    
                    {cropHealthRecords.length === 0 && (
                        <Grid item xs={12}>
                            <Paper sx={{ p: 4, textAlign: 'center' }}>
                                <HealthAndSafety sx={{ fontSize: 48, color: 'primary.main', mb: 2 }} />
                                <Typography variant="h6" color="primary.main">
                                    No Crop Health Records Found
                                </Typography>
                                <Typography color="textSecondary" sx={{ mb: 3 }}>
                                    Start by reporting the health status of your crops
                                </Typography>
                                <Button
                                    variant="contained"
                                    startIcon={<Add />}
                                    onClick={() => setReportIssueOpen(true)}
                                >
                                    Create First Record
                                </Button>
                            </Paper>
                        </Grid>
                    )}
                </Grid>
            )}

            {/* Context Menu */}
            <Menu
                anchorEl={menuAnchor}
                open={Boolean(menuAnchor)}
                onClose={handleMenuClose}
            >
                <MenuItem onClick={handleViewDetails}>
                    <ListItemText primary="View Details" />
                </MenuItem>
                <MenuItem onClick={handleReportIssue}>
                    <ListItemText primary="Report Issue" />
                </MenuItem>
                <MenuItem onClick={handleAIDiagnosis}>
                    <ListItemText primary="AI Diagnosis" />
                </MenuItem>
                <Divider />
                <MenuItem>
                    <ListItemText primary="Health History" />
                </MenuItem>
                <MenuItem>
                    <ListItemText primary="Export Report" />
                </MenuItem>
            </Menu>

            {/* Issue Report Dialog */}
            <IssueReportForm
                open={reportIssueOpen}
                onClose={() => setReportIssueOpen(false)}
                crop={selectedCrop}
                onSuccess={() => {
                    setReportIssueOpen(false);
                    fetchCropHealthData();
                }}
            />

            {/* AI Diagnosis Dialog */}
            <AIDiagnosisDialog
                open={aiDiagnosisOpen}
                onClose={() => setAiDiagnosisOpen(false)}
                crop={selectedCrop}
            />

            {/* Crop Details Dialog */}
            {renderCropDetails()}

            {/* Floating Action Button for quick reporting */}
            <Fab
                color="primary"
                sx={{ position: 'fixed', bottom: 16, right: 16 }}
                onClick={() => setReportIssueOpen(true)}
            >
                <Add />
            </Fab>
        </Container>
    );
};

export default CropHealthDashboard;
-e 
===== FILE: ./src/services/api.js =====

import axios from 'axios';

const API_URL = 'http://localhost:5000/api';

const api = axios.create({
    baseURL: API_URL,
    headers: {
        'Content-Type': 'application/json'
    }
});

// Add a request interceptor to include the auth token
api.interceptors.request.use(
    (config) => {
        const token = localStorage.getItem('token');
        if (token) {
            config.headers.Authorization = `Bearer ${token}`;
        }
        return config;
    },
    (error) => Promise.reject(error)
);

export const timelineService = {
    // Get activities with filters
    getActivities: (filters = {}) => {
        const params = new URLSearchParams();
        Object.keys(filters).forEach(key => {
            if (filters[key]) params.append(key, filters[key]);
        });
        return api.get(`/timeline?${params.toString()}`).then(res => res.data);
    },

    // Get activity by ID
    getActivity: (id) => api.get(`/timeline/${id}`).then(res => res.data),

    // Create activity
    createActivity: (data) => api.post('/timeline', data).then(res => res.data),

    // Update activity
    updateActivity: (id, data) => api.put(`/timeline/${id}`, data).then(res => res.data),

    // Delete activity
    deleteActivity: (id) => api.delete(`/timeline/${id}`).then(res => res.data),

    // Start activity
    startActivity: (id) => api.post(`/timeline/${id}/start`).then(res => res.data),

    // Complete activity
    completeActivity: (id, data) => api.post(`/timeline/${id}/complete`, data).then(res => res.data),

    // Add comment
    addComment: (id, comment) => api.post(`/timeline/${id}/comments`, comment).then(res => res.data),

    // Upload attachment
    uploadAttachment: (id, attachment) => api.post(`/timeline/${id}/attachments`, attachment).then(res => res.data),

    // Get analytics
    getAnalytics: (params) => {
        const queryParams = new URLSearchParams(params).toString();
        return api.get(`/timeline/analytics/overview${queryParams ? '?' + queryParams : ''}`).then(res => res.data);
    },

    // Generate from crop plan
    generateFromCropPlan: (cropId, startDate) => 
        api.post('/timeline/generate-from-plan', { cropId, startDate }).then(res => res.data)
};

export const resourcesService = {
    getResources: (filters = {}) => {
        const params = new URLSearchParams();
        Object.keys(filters).forEach(key => {
            if (filters[key] !== undefined && filters[key] !== '') {
                params.append(key, filters[key]);
            }
        });
        return api.get(`/resources?${params.toString()}`).then(res => res.data);
    },
    getResource: (id) => api.get(`/resources/${id}`).then(res => res.data),
    createResource: (data) => api.post('/resources', data).then(res => res.data),
    updateResource: (id, data) => api.put(`/resources/${id}`, data).then(res => res.data),
    deleteResource: (id) => api.delete(`/resources/${id}`).then(res => res.data),
    useResource: (id, data) => api.post(`/resources/${id}/use`, data).then(res => res.data),
    addStock: (id, data) => api.post(`/resources/${id}/add-stock`, data).then(res => res.data),
    resolveAlert: (resourceId, alertId) => api.post(`/resources/${resourceId}/alerts/${alertId}/resolve`).then(res => res.data),
    getAnalytics: () => api.get('/resources/analytics/overview').then(res => res.data),
    exportToCSV: () => {
        return api.get('/resources/export/csv', { responseType: 'blob' }).then(response => {
            const url = window.URL.createObjectURL(new Blob([response.data]));
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', 'resources-export.csv');
            document.body.appendChild(link);
            link.click();
        });
    }
};

export const financialService = {
    getTransactions: (filters = {}) => {
        const params = new URLSearchParams();
        Object.keys(filters).forEach(key => {
            if (filters[key]) {
                if (filters[key] instanceof Date) {
                    params.append(key, filters[key].toISOString());
                } else {
                    params.append(key, filters[key]);
                }
            }
        });
        return api.get(`/financial/transactions?${params.toString()}`).then(res => res.data);
    },
    getTransaction: (id) => api.get(`/financial/transactions/${id}`).then(res => res.data),
    createTransaction: (data) => api.post('/financial/transactions', data).then(res => res.data),
    updateTransaction: (id, data) => api.put(`/financial/transactions/${id}`, data).then(res => res.data),
    deleteTransaction: (id) => api.delete(`/financial/transactions/${id}`).then(res => res.data),
    markPaymentPaid: (id, data) => api.post(`/financial/transactions/${id}/mark-paid`, data).then(res => res.data),
    getProfitLoss: (params) => {
        const queryParams = new URLSearchParams(params).toString();
        return api.get(`/financial/profit-loss?${queryParams}`).then(res => res.data);
    },
    getPendingPayments: () => api.get('/financial/pending-payments').then(res => res.data),
    getExpenseBreakdown: (params) => {
        const queryParams = new URLSearchParams(params).toString();
        return api.get(`/financial/expense-breakdown?${queryParams}`).then(res => res.data);
    },
    getIncomeBreakdown: (params) => {
        const queryParams = new URLSearchParams(params).toString();
        return api.get(`/financial/income-breakdown?${queryParams}`).then(res => res.data);
    },
    getCropWiseProfit: () => api.get('/financial/report').then(res => res.data.cropWiseProfit), // Assuming report endpoint returns cropWiseProfit as part of it or use a specific endpoint if exists. 
    // Actually backend route /financial/report returns cropWiseProfit. Also /financial/profit-loss returns cropWiseProfit.
    // The FinancialDashboard calls `financialService.getCropWiseProfit()` which was expected to be a direct call.
    // In backend/routes/financial.js, `router.get('/profit-loss'...)` returns `cropWiseProfit`.
    // So getProfitLoss returns it. But FinancialDashboard calls both.
    // Let's check FinancialDashboard code provided:
    // `const [transactionsRes, expenseRes, incomeRes, pendingRes, cropRes] = await Promise.all([..., financialService.getCropWiseProfit()])`
    // So I should probably add a specific method or reuse.
    // Backend `router.get('/profit-loss')` returns `{..., cropWiseProfit, ...}`.
    // But there is NO specific endpoint just for cropWiseProfit. 
    // However, `router.get('/report')` returns it too.
    // I will implement getCropWiseProfit to call profit-loss and extract it or just return the profit-loss response.
    // Wait, looking at the backend code provided in prompt 2 step 2:
    // `FinancialTransaction.getCropWiseProfit` is a static method.
    // It is used in `/profit-loss` and `/report`.
    // I will simulate it by calling profit-loss and extracting cropWiseProfit to match the dashboard's expectation if it expects an array directly.
    
    getInsights: () => api.get('/financial/insights').then(res => res.data),
    exportToCSV: (filters = {}) => {
        const params = new URLSearchParams();
        Object.keys(filters).forEach(key => {
            if (filters[key]) {
                if (filters[key] instanceof Date) {
                    params.append(key, filters[key].toISOString());
                } else {
                    params.append(key, filters[key]);
                }
            }
        });
        return api.get(`/financial/export/csv?${params.toString()}`, { responseType: 'blob' }).then(response => {
            const url = window.URL.createObjectURL(new Blob([response.data]));
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', 'financial-report.csv');
            document.body.appendChild(link);
            link.click();
        });
    }
};

export const cropHealthService = {
    getCropHealth: (filters = {}) => {
        const params = new URLSearchParams();
        Object.keys(filters).forEach(key => {
            if (filters[key]) params.append(key, filters[key]);
        });
        return api.get(`/crop-health?${params.toString()}`).then(res => res.data);
    },
    getCropHealthById: (id) => api.get(`/crop-health/${id}`).then(res => res.data),
    createCropHealth: (data) => api.post('/crop-health', data).then(res => res.data),
    reportIssue: (id, data) => api.post(`/crop-health/${id}/issues`, data).then(res => res.data),
    aiDiagnosis: (data) => api.post('/crop-health/ai-diagnosis', data).then(res => res.data),
    getTreatments: (id, issueId) => api.get(`/crop-health/${id}/issues/${issueId}/treatments`).then(res => res.data),
    applyTreatment: (id, issueId, data) => api.post(`/crop-health/${id}/issues/${issueId}/treatments/apply`, data).then(res => res.data),
    resolveIssue: (id, issueId, data) => api.post(`/crop-health/${id}/issues/${issueId}/resolve`, data).then(res => res.data),
    getAlerts: (id) => api.get(`/crop-health/${id}/alerts`).then(res => res.data),
    acknowledgeAlert: (id, alertId) => api.post(`/crop-health/${id}/alerts/${alertId}/acknowledge`).then(res => res.data),
    nutrientAnalysis: (id, data) => api.post(`/crop-health/${id}/nutrient-analysis`, data).then(res => res.data),
    getGrowthGuidance: (id) => api.get(`/crop-health/${id}/growth-guidance`).then(res => res.data),
    getHistory: (id) => api.get(`/crop-health/${id}/history`).then(res => res.data),
    getReport: (id) => api.get(`/crop-health/${id}/report`).then(res => res.data),
    searchDiseases: (symptoms, cropName) => api.post('/crop-health/search-diseases', { symptoms, cropName }).then(res => res.data)
};

export const cropService = {
    getCrops: () => api.get('/crops').then(res => res.data),
    getCropPlan: (season, landType) => api.get(`/crops/plan`, { params: { season, landType } }).then(res => res.data),
};

export const workerService = {
    getWorkers: () => api.get('/farmer/workers').then(res => res.data),
};

export default api;
-e 
===== FILE: ./.gitignore =====

# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

# production
/build

# misc
.DS_Store
.env.local
.env.development.local
.env.test.local
.env.production.local

npm-debug.log*
yarn-debug.log*
yarn-error.log*
